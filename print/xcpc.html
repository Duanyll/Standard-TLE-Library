<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>Standard-TLE-Library Offline for XCPC</title>
        <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

/* From extension vscode.markdown-math */
@font-face{font-family:KaTeX_AMS;font-style:normal;font-weight:400;src:url(fonts/KaTeX_AMS-Regular.woff2) format("woff2"),url(fonts/KaTeX_AMS-Regular.woff) format("woff"),url(fonts/KaTeX_AMS-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Caligraphic;font-style:normal;font-weight:700;src:url(fonts/KaTeX_Caligraphic-Bold.woff2) format("woff2"),url(fonts/KaTeX_Caligraphic-Bold.woff) format("woff"),url(fonts/KaTeX_Caligraphic-Bold.ttf) format("truetype")}@font-face{font-family:KaTeX_Caligraphic;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Caligraphic-Regular.woff2) format("woff2"),url(fonts/KaTeX_Caligraphic-Regular.woff) format("woff"),url(fonts/KaTeX_Caligraphic-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Fraktur;font-style:normal;font-weight:700;src:url(fonts/KaTeX_Fraktur-Bold.woff2) format("woff2"),url(fonts/KaTeX_Fraktur-Bold.woff) format("woff"),url(fonts/KaTeX_Fraktur-Bold.ttf) format("truetype")}@font-face{font-family:KaTeX_Fraktur;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Fraktur-Regular.woff2) format("woff2"),url(fonts/KaTeX_Fraktur-Regular.woff) format("woff"),url(fonts/KaTeX_Fraktur-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:normal;font-weight:700;src:url(fonts/KaTeX_Main-Bold.woff2) format("woff2"),url(fonts/KaTeX_Main-Bold.woff) format("woff"),url(fonts/KaTeX_Main-Bold.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:italic;font-weight:700;src:url(fonts/KaTeX_Main-BoldItalic.woff2) format("woff2"),url(fonts/KaTeX_Main-BoldItalic.woff) format("woff"),url(fonts/KaTeX_Main-BoldItalic.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:italic;font-weight:400;src:url(fonts/KaTeX_Main-Italic.woff2) format("woff2"),url(fonts/KaTeX_Main-Italic.woff) format("woff"),url(fonts/KaTeX_Main-Italic.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Main-Regular.woff2) format("woff2"),url(fonts/KaTeX_Main-Regular.woff) format("woff"),url(fonts/KaTeX_Main-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Math;font-style:italic;font-weight:700;src:url(fonts/KaTeX_Math-BoldItalic.woff2) format("woff2"),url(fonts/KaTeX_Math-BoldItalic.woff) format("woff"),url(fonts/KaTeX_Math-BoldItalic.ttf) format("truetype")}@font-face{font-family:KaTeX_Math;font-style:italic;font-weight:400;src:url(fonts/KaTeX_Math-Italic.woff2) format("woff2"),url(fonts/KaTeX_Math-Italic.woff) format("woff"),url(fonts/KaTeX_Math-Italic.ttf) format("truetype")}@font-face{font-family:"KaTeX_SansSerif";font-style:normal;font-weight:700;src:url(fonts/KaTeX_SansSerif-Bold.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Bold.woff) format("woff"),url(fonts/KaTeX_SansSerif-Bold.ttf) format("truetype")}@font-face{font-family:"KaTeX_SansSerif";font-style:italic;font-weight:400;src:url(fonts/KaTeX_SansSerif-Italic.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Italic.woff) format("woff"),url(fonts/KaTeX_SansSerif-Italic.ttf) format("truetype")}@font-face{font-family:"KaTeX_SansSerif";font-style:normal;font-weight:400;src:url(fonts/KaTeX_SansSerif-Regular.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Regular.woff) format("woff"),url(fonts/KaTeX_SansSerif-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Script;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Script-Regular.woff2) format("woff2"),url(fonts/KaTeX_Script-Regular.woff) format("woff"),url(fonts/KaTeX_Script-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size1;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size1-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size1-Regular.woff) format("woff"),url(fonts/KaTeX_Size1-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size2;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size2-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size2-Regular.woff) format("woff"),url(fonts/KaTeX_Size2-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size3;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size3-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size3-Regular.woff) format("woff"),url(fonts/KaTeX_Size3-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size4;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size4-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size4-Regular.woff) format("woff"),url(fonts/KaTeX_Size4-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Typewriter;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Typewriter-Regular.woff2) format("woff2"),url(fonts/KaTeX_Typewriter-Regular.woff) format("woff"),url(fonts/KaTeX_Typewriter-Regular.ttf) format("truetype")}.katex{text-rendering:auto;font:normal 1.21em KaTeX_Main,Times New Roman,serif;line-height:1.2;text-indent:0}.katex *{-ms-high-contrast-adjust:none!important;border-color:currentColor}.katex .katex-version:after{content:"0.13.24"}.katex .katex-mathml{clip:rect(1px,1px,1px,1px);border:0;height:1px;overflow:hidden;padding:0;position:absolute;width:1px}.katex .katex-html>.newline{display:block}.katex .base{position:relative;white-space:nowrap;width:-webkit-min-content;width:-moz-min-content;width:min-content}.katex .base,.katex .strut{display:inline-block}.katex .textbf{font-weight:700}.katex .textit{font-style:italic}.katex .textrm{font-family:KaTeX_Main}.katex .textsf{font-family:KaTeX_SansSerif}.katex .texttt{font-family:KaTeX_Typewriter}.katex .mathnormal{font-family:KaTeX_Math;font-style:italic}.katex .mathit{font-family:KaTeX_Main;font-style:italic}.katex .mathrm{font-style:normal}.katex .mathbf{font-family:KaTeX_Main;font-weight:700}.katex .boldsymbol{font-family:KaTeX_Math;font-style:italic;font-weight:700}.katex .amsrm,.katex .mathbb,.katex .textbb{font-family:KaTeX_AMS}.katex .mathcal{font-family:KaTeX_Caligraphic}.katex .mathfrak,.katex .textfrak{font-family:KaTeX_Fraktur}.katex .mathtt{font-family:KaTeX_Typewriter}.katex .mathscr,.katex .textscr{font-family:KaTeX_Script}.katex .mathsf,.katex .textsf{font-family:KaTeX_SansSerif}.katex .mathboldsf,.katex .textboldsf{font-family:KaTeX_SansSerif;font-weight:700}.katex .mathitsf,.katex .textitsf{font-family:KaTeX_SansSerif;font-style:italic}.katex .mainrm{font-family:KaTeX_Main;font-style:normal}.katex .vlist-t{border-collapse:collapse;display:inline-table;table-layout:fixed}.katex .vlist-r{display:table-row}.katex .vlist{display:table-cell;position:relative;vertical-align:bottom}.katex .vlist>span{display:block;height:0;position:relative}.katex .vlist>span>span{display:inline-block}.katex .vlist>span>.pstrut{overflow:hidden;width:0}.katex .vlist-t2{margin-right:-2px}.katex .vlist-s{display:table-cell;font-size:1px;min-width:2px;vertical-align:bottom;width:2px}.katex .vbox{align-items:baseline;display:inline-flex;flex-direction:column}.katex .hbox{width:100%}.katex .hbox,.katex .thinbox{display:inline-flex;flex-direction:row}.katex .thinbox{max-width:0;width:0}.katex .msupsub{text-align:left}.katex .mfrac>span>span{text-align:center}.katex .mfrac .frac-line{border-bottom-style:solid;display:inline-block;width:100%}.katex .hdashline,.katex .hline,.katex .mfrac .frac-line,.katex .overline .overline-line,.katex .rule,.katex .underline .underline-line{min-height:1px}.katex .mspace{display:inline-block}.katex .clap,.katex .llap,.katex .rlap{position:relative;width:0}.katex .clap>.inner,.katex .llap>.inner,.katex .rlap>.inner{position:absolute}.katex .clap>.fix,.katex .llap>.fix,.katex .rlap>.fix{display:inline-block}.katex .llap>.inner{right:0}.katex .clap>.inner,.katex .rlap>.inner{left:0}.katex .clap>.inner>span{margin-left:-50%;margin-right:50%}.katex .rule{border:0 solid;display:inline-block;position:relative}.katex .hline,.katex .overline .overline-line,.katex .underline .underline-line{border-bottom-style:solid;display:inline-block;width:100%}.katex .hdashline{border-bottom-style:dashed;display:inline-block;width:100%}.katex .sqrt>.root{margin-left:.27777778em;margin-right:-.55555556em}.katex .fontsize-ensurer.reset-size1.size1,.katex .sizing.reset-size1.size1{font-size:1em}.katex .fontsize-ensurer.reset-size1.size2,.katex .sizing.reset-size1.size2{font-size:1.2em}.katex .fontsize-ensurer.reset-size1.size3,.katex .sizing.reset-size1.size3{font-size:1.4em}.katex .fontsize-ensurer.reset-size1.size4,.katex .sizing.reset-size1.size4{font-size:1.6em}.katex .fontsize-ensurer.reset-size1.size5,.katex .sizing.reset-size1.size5{font-size:1.8em}.katex .fontsize-ensurer.reset-size1.size6,.katex .sizing.reset-size1.size6{font-size:2em}.katex .fontsize-ensurer.reset-size1.size7,.katex .sizing.reset-size1.size7{font-size:2.4em}.katex .fontsize-ensurer.reset-size1.size8,.katex .sizing.reset-size1.size8{font-size:2.88em}.katex .fontsize-ensurer.reset-size1.size9,.katex .sizing.reset-size1.size9{font-size:3.456em}.katex .fontsize-ensurer.reset-size1.size10,.katex .sizing.reset-size1.size10{font-size:4.148em}.katex .fontsize-ensurer.reset-size1.size11,.katex .sizing.reset-size1.size11{font-size:4.976em}.katex .fontsize-ensurer.reset-size2.size1,.katex .sizing.reset-size2.size1{font-size:.83333333em}.katex .fontsize-ensurer.reset-size2.size2,.katex .sizing.reset-size2.size2{font-size:1em}.katex .fontsize-ensurer.reset-size2.size3,.katex .sizing.reset-size2.size3{font-size:1.16666667em}.katex .fontsize-ensurer.reset-size2.size4,.katex .sizing.reset-size2.size4{font-size:1.33333333em}.katex .fontsize-ensurer.reset-size2.size5,.katex .sizing.reset-size2.size5{font-size:1.5em}.katex .fontsize-ensurer.reset-size2.size6,.katex .sizing.reset-size2.size6{font-size:1.66666667em}.katex .fontsize-ensurer.reset-size2.size7,.katex .sizing.reset-size2.size7{font-size:2em}.katex .fontsize-ensurer.reset-size2.size8,.katex .sizing.reset-size2.size8{font-size:2.4em}.katex .fontsize-ensurer.reset-size2.size9,.katex .sizing.reset-size2.size9{font-size:2.88em}.katex .fontsize-ensurer.reset-size2.size10,.katex .sizing.reset-size2.size10{font-size:3.45666667em}.katex .fontsize-ensurer.reset-size2.size11,.katex .sizing.reset-size2.size11{font-size:4.14666667em}.katex .fontsize-ensurer.reset-size3.size1,.katex .sizing.reset-size3.size1{font-size:.71428571em}.katex .fontsize-ensurer.reset-size3.size2,.katex .sizing.reset-size3.size2{font-size:.85714286em}.katex .fontsize-ensurer.reset-size3.size3,.katex .sizing.reset-size3.size3{font-size:1em}.katex .fontsize-ensurer.reset-size3.size4,.katex .sizing.reset-size3.size4{font-size:1.14285714em}.katex .fontsize-ensurer.reset-size3.size5,.katex .sizing.reset-size3.size5{font-size:1.28571429em}.katex .fontsize-ensurer.reset-size3.size6,.katex .sizing.reset-size3.size6{font-size:1.42857143em}.katex .fontsize-ensurer.reset-size3.size7,.katex .sizing.reset-size3.size7{font-size:1.71428571em}.katex .fontsize-ensurer.reset-size3.size8,.katex .sizing.reset-size3.size8{font-size:2.05714286em}.katex .fontsize-ensurer.reset-size3.size9,.katex .sizing.reset-size3.size9{font-size:2.46857143em}.katex .fontsize-ensurer.reset-size3.size10,.katex .sizing.reset-size3.size10{font-size:2.96285714em}.katex .fontsize-ensurer.reset-size3.size11,.katex .sizing.reset-size3.size11{font-size:3.55428571em}.katex .fontsize-ensurer.reset-size4.size1,.katex .sizing.reset-size4.size1{font-size:.625em}.katex .fontsize-ensurer.reset-size4.size2,.katex .sizing.reset-size4.size2{font-size:.75em}.katex .fontsize-ensurer.reset-size4.size3,.katex .sizing.reset-size4.size3{font-size:.875em}.katex .fontsize-ensurer.reset-size4.size4,.katex .sizing.reset-size4.size4{font-size:1em}.katex .fontsize-ensurer.reset-size4.size5,.katex .sizing.reset-size4.size5{font-size:1.125em}.katex .fontsize-ensurer.reset-size4.size6,.katex .sizing.reset-size4.size6{font-size:1.25em}.katex .fontsize-ensurer.reset-size4.size7,.katex .sizing.reset-size4.size7{font-size:1.5em}.katex .fontsize-ensurer.reset-size4.size8,.katex .sizing.reset-size4.size8{font-size:1.8em}.katex .fontsize-ensurer.reset-size4.size9,.katex .sizing.reset-size4.size9{font-size:2.16em}.katex .fontsize-ensurer.reset-size4.size10,.katex .sizing.reset-size4.size10{font-size:2.5925em}.katex .fontsize-ensurer.reset-size4.size11,.katex .sizing.reset-size4.size11{font-size:3.11em}.katex .fontsize-ensurer.reset-size5.size1,.katex .sizing.reset-size5.size1{font-size:.55555556em}.katex .fontsize-ensurer.reset-size5.size2,.katex .sizing.reset-size5.size2{font-size:.66666667em}.katex .fontsize-ensurer.reset-size5.size3,.katex .sizing.reset-size5.size3{font-size:.77777778em}.katex .fontsize-ensurer.reset-size5.size4,.katex .sizing.reset-size5.size4{font-size:.88888889em}.katex .fontsize-ensurer.reset-size5.size5,.katex .sizing.reset-size5.size5{font-size:1em}.katex .fontsize-ensurer.reset-size5.size6,.katex .sizing.reset-size5.size6{font-size:1.11111111em}.katex .fontsize-ensurer.reset-size5.size7,.katex .sizing.reset-size5.size7{font-size:1.33333333em}.katex .fontsize-ensurer.reset-size5.size8,.katex .sizing.reset-size5.size8{font-size:1.6em}.katex .fontsize-ensurer.reset-size5.size9,.katex .sizing.reset-size5.size9{font-size:1.92em}.katex .fontsize-ensurer.reset-size5.size10,.katex .sizing.reset-size5.size10{font-size:2.30444444em}.katex .fontsize-ensurer.reset-size5.size11,.katex .sizing.reset-size5.size11{font-size:2.76444444em}.katex .fontsize-ensurer.reset-size6.size1,.katex .sizing.reset-size6.size1{font-size:.5em}.katex .fontsize-ensurer.reset-size6.size2,.katex .sizing.reset-size6.size2{font-size:.6em}.katex .fontsize-ensurer.reset-size6.size3,.katex .sizing.reset-size6.size3{font-size:.7em}.katex .fontsize-ensurer.reset-size6.size4,.katex .sizing.reset-size6.size4{font-size:.8em}.katex .fontsize-ensurer.reset-size6.size5,.katex .sizing.reset-size6.size5{font-size:.9em}.katex .fontsize-ensurer.reset-size6.size6,.katex .sizing.reset-size6.size6{font-size:1em}.katex .fontsize-ensurer.reset-size6.size7,.katex .sizing.reset-size6.size7{font-size:1.2em}.katex .fontsize-ensurer.reset-size6.size8,.katex .sizing.reset-size6.size8{font-size:1.44em}.katex .fontsize-ensurer.reset-size6.size9,.katex .sizing.reset-size6.size9{font-size:1.728em}.katex .fontsize-ensurer.reset-size6.size10,.katex .sizing.reset-size6.size10{font-size:2.074em}.katex .fontsize-ensurer.reset-size6.size11,.katex .sizing.reset-size6.size11{font-size:2.488em}.katex .fontsize-ensurer.reset-size7.size1,.katex .sizing.reset-size7.size1{font-size:.41666667em}.katex .fontsize-ensurer.reset-size7.size2,.katex .sizing.reset-size7.size2{font-size:.5em}.katex .fontsize-ensurer.reset-size7.size3,.katex .sizing.reset-size7.size3{font-size:.58333333em}.katex .fontsize-ensurer.reset-size7.size4,.katex .sizing.reset-size7.size4{font-size:.66666667em}.katex .fontsize-ensurer.reset-size7.size5,.katex .sizing.reset-size7.size5{font-size:.75em}.katex .fontsize-ensurer.reset-size7.size6,.katex .sizing.reset-size7.size6{font-size:.83333333em}.katex .fontsize-ensurer.reset-size7.size7,.katex .sizing.reset-size7.size7{font-size:1em}.katex .fontsize-ensurer.reset-size7.size8,.katex .sizing.reset-size7.size8{font-size:1.2em}.katex .fontsize-ensurer.reset-size7.size9,.katex .sizing.reset-size7.size9{font-size:1.44em}.katex .fontsize-ensurer.reset-size7.size10,.katex .sizing.reset-size7.size10{font-size:1.72833333em}.katex .fontsize-ensurer.reset-size7.size11,.katex .sizing.reset-size7.size11{font-size:2.07333333em}.katex .fontsize-ensurer.reset-size8.size1,.katex .sizing.reset-size8.size1{font-size:.34722222em}.katex .fontsize-ensurer.reset-size8.size2,.katex .sizing.reset-size8.size2{font-size:.41666667em}.katex .fontsize-ensurer.reset-size8.size3,.katex .sizing.reset-size8.size3{font-size:.48611111em}.katex .fontsize-ensurer.reset-size8.size4,.katex .sizing.reset-size8.size4{font-size:.55555556em}.katex .fontsize-ensurer.reset-size8.size5,.katex .sizing.reset-size8.size5{font-size:.625em}.katex .fontsize-ensurer.reset-size8.size6,.katex .sizing.reset-size8.size6{font-size:.69444444em}.katex .fontsize-ensurer.reset-size8.size7,.katex .sizing.reset-size8.size7{font-size:.83333333em}.katex .fontsize-ensurer.reset-size8.size8,.katex .sizing.reset-size8.size8{font-size:1em}.katex .fontsize-ensurer.reset-size8.size9,.katex .sizing.reset-size8.size9{font-size:1.2em}.katex .fontsize-ensurer.reset-size8.size10,.katex .sizing.reset-size8.size10{font-size:1.44027778em}.katex .fontsize-ensurer.reset-size8.size11,.katex .sizing.reset-size8.size11{font-size:1.72777778em}.katex .fontsize-ensurer.reset-size9.size1,.katex .sizing.reset-size9.size1{font-size:.28935185em}.katex .fontsize-ensurer.reset-size9.size2,.katex .sizing.reset-size9.size2{font-size:.34722222em}.katex .fontsize-ensurer.reset-size9.size3,.katex .sizing.reset-size9.size3{font-size:.40509259em}.katex .fontsize-ensurer.reset-size9.size4,.katex .sizing.reset-size9.size4{font-size:.46296296em}.katex .fontsize-ensurer.reset-size9.size5,.katex .sizing.reset-size9.size5{font-size:.52083333em}.katex .fontsize-ensurer.reset-size9.size6,.katex .sizing.reset-size9.size6{font-size:.5787037em}.katex .fontsize-ensurer.reset-size9.size7,.katex .sizing.reset-size9.size7{font-size:.69444444em}.katex .fontsize-ensurer.reset-size9.size8,.katex .sizing.reset-size9.size8{font-size:.83333333em}.katex .fontsize-ensurer.reset-size9.size9,.katex .sizing.reset-size9.size9{font-size:1em}.katex .fontsize-ensurer.reset-size9.size10,.katex .sizing.reset-size9.size10{font-size:1.20023148em}.katex .fontsize-ensurer.reset-size9.size11,.katex .sizing.reset-size9.size11{font-size:1.43981481em}.katex .fontsize-ensurer.reset-size10.size1,.katex .sizing.reset-size10.size1{font-size:.24108004em}.katex .fontsize-ensurer.reset-size10.size2,.katex .sizing.reset-size10.size2{font-size:.28929605em}.katex .fontsize-ensurer.reset-size10.size3,.katex .sizing.reset-size10.size3{font-size:.33751205em}.katex .fontsize-ensurer.reset-size10.size4,.katex .sizing.reset-size10.size4{font-size:.38572806em}.katex .fontsize-ensurer.reset-size10.size5,.katex .sizing.reset-size10.size5{font-size:.43394407em}.katex .fontsize-ensurer.reset-size10.size6,.katex .sizing.reset-size10.size6{font-size:.48216008em}.katex .fontsize-ensurer.reset-size10.size7,.katex .sizing.reset-size10.size7{font-size:.57859209em}.katex .fontsize-ensurer.reset-size10.size8,.katex .sizing.reset-size10.size8{font-size:.69431051em}.katex .fontsize-ensurer.reset-size10.size9,.katex .sizing.reset-size10.size9{font-size:.83317261em}.katex .fontsize-ensurer.reset-size10.size10,.katex .sizing.reset-size10.size10{font-size:1em}.katex .fontsize-ensurer.reset-size10.size11,.katex .sizing.reset-size10.size11{font-size:1.19961427em}.katex .fontsize-ensurer.reset-size11.size1,.katex .sizing.reset-size11.size1{font-size:.20096463em}.katex .fontsize-ensurer.reset-size11.size2,.katex .sizing.reset-size11.size2{font-size:.24115756em}.katex .fontsize-ensurer.reset-size11.size3,.katex .sizing.reset-size11.size3{font-size:.28135048em}.katex .fontsize-ensurer.reset-size11.size4,.katex .sizing.reset-size11.size4{font-size:.32154341em}.katex .fontsize-ensurer.reset-size11.size5,.katex .sizing.reset-size11.size5{font-size:.36173633em}.katex .fontsize-ensurer.reset-size11.size6,.katex .sizing.reset-size11.size6{font-size:.40192926em}.katex .fontsize-ensurer.reset-size11.size7,.katex .sizing.reset-size11.size7{font-size:.48231511em}.katex .fontsize-ensurer.reset-size11.size8,.katex .sizing.reset-size11.size8{font-size:.57877814em}.katex .fontsize-ensurer.reset-size11.size9,.katex .sizing.reset-size11.size9{font-size:.69453376em}.katex .fontsize-ensurer.reset-size11.size10,.katex .sizing.reset-size11.size10{font-size:.83360129em}.katex .fontsize-ensurer.reset-size11.size11,.katex .sizing.reset-size11.size11{font-size:1em}.katex .delimsizing.size1{font-family:KaTeX_Size1}.katex .delimsizing.size2{font-family:KaTeX_Size2}.katex .delimsizing.size3{font-family:KaTeX_Size3}.katex .delimsizing.size4{font-family:KaTeX_Size4}.katex .delimsizing.mult .delim-size1>span{font-family:KaTeX_Size1}.katex .delimsizing.mult .delim-size4>span{font-family:KaTeX_Size4}.katex .nulldelimiter{display:inline-block;width:.12em}.katex .delimcenter,.katex .op-symbol{position:relative}.katex .op-symbol.small-op{font-family:KaTeX_Size1}.katex .op-symbol.large-op{font-family:KaTeX_Size2}.katex .accent>.vlist-t,.katex .op-limits>.vlist-t{text-align:center}.katex .accent .accent-body{position:relative}.katex .accent .accent-body:not(.accent-full){width:0}.katex .overlay{display:block}.katex .mtable .vertical-separator{display:inline-block;min-width:1px}.katex .mtable .arraycolsep{display:inline-block}.katex .mtable .col-align-c>.vlist-t{text-align:center}.katex .mtable .col-align-l>.vlist-t{text-align:left}.katex .mtable .col-align-r>.vlist-t{text-align:right}.katex .svg-align{text-align:left}.katex svg{fill:currentColor;stroke:currentColor;fill-rule:nonzero;fill-opacity:1;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;display:block;height:inherit;position:absolute;width:100%}.katex svg path{stroke:none}.katex img{border-style:none;max-height:none;max-width:none;min-height:0;min-width:0}.katex .stretchy{display:block;overflow:hidden;position:relative;width:100%}.katex .stretchy:after,.katex .stretchy:before{content:""}.katex .hide-tail{overflow:hidden;position:relative;width:100%}.katex .halfarrow-left{left:0;overflow:hidden;position:absolute;width:50.2%}.katex .halfarrow-right{overflow:hidden;position:absolute;right:0;width:50.2%}.katex .brace-left{left:0;overflow:hidden;position:absolute;width:25.1%}.katex .brace-center{left:25%;overflow:hidden;position:absolute;width:50%}.katex .brace-right{overflow:hidden;position:absolute;right:0;width:25.1%}.katex .x-arrow-pad{padding:0 .5em}.katex .cd-arrow-pad{padding:0 .55556em 0 .27778em}.katex .mover,.katex .munder,.katex .x-arrow{text-align:center}.katex .boxpad{padding:0 .3em}.katex .fbox,.katex .fcolorbox{border:.04em solid;box-sizing:border-box}.katex .cancel-pad{padding:0 .2em}.katex .cancel-lap{margin-left:-.2em;margin-right:-.2em}.katex .sout{border-bottom-style:solid;border-bottom-width:.08em}.katex .angl{border-right:.049em solid;border-top:.049em solid;box-sizing:border-box;margin-right:.03889em}.katex .anglpad{padding:0 .03889em}.katex .eqn-num:before{content:"(" counter(katexEqnNo) ")";counter-increment:katexEqnNo}.katex .mml-eqn-num:before{content:"(" counter(mmlEqnNo) ")";counter-increment:mmlEqnNo}.katex .mtr-glue{width:50%}.katex .cd-vert-arrow{display:inline-block;position:relative}.katex .cd-label-left{display:inline-block;position:absolute;right:calc(50% + .3em);text-align:left}.katex .cd-label-right{display:inline-block;left:calc(50% + .3em);position:absolute;text-align:right}.katex-display{display:block;margin:1em 0;text-align:center}.katex-display>.katex{display:block;text-align:center;white-space:nowrap}.katex-display>.katex>.katex-html{display:block;position:relative}.katex-display>.katex>.katex-html>.tag{position:absolute;right:0}.katex-display.leqno>.katex>.katex-html>.tag{left:0;right:auto}.katex-display.fleqn>.katex{padding-left:2em;text-align:left}body{counter-reset:katexEqnNo mmlEqnNo}

/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.katex-error {
	color: var(--vscode-editorError-foreground);
}

</style>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
</style>
        
    </head>
    <body class="vscode-body vscode-light">
        <h1 id="standard-tle-library-offline-for-xcpc">Standard-TLE-Library Offline for XCPC</h1>
<ul>
<li><a href="#standard-tle-library-offline-for-xcpc">Standard-TLE-Library Offline for XCPC</a>
<ul>
<li><a href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">数据结构</a>
<ul>
<li><a href="#%E7%AC%9B%E5%8D%A1%E5%B0%94%E6%A0%91">笛卡尔树</a></li>
<li><a href="#dlx">DLX</a></li>
<li><a href="#%E6%A0%91%E7%8A%B6%E6%95%B0%E7%BB%84">树状数组</a>
<ul>
<li><a href="#%E4%BA%BA%E4%BA%BA%E9%83%BD%E4%BC%9A%E7%9A%84">人人都会的</a></li>
<li><a href="#%E5%8C%BA%E9%97%B4%E4%BF%AE%E6%94%B9-%E5%8C%BA%E9%97%B4%E6%9F%A5%E8%AF%A2">区间修改, 区间查询</a></li>
<li><a href="#%E4%BA%8C%E7%BB%B4%E5%89%8D%E7%BC%80%E5%92%8C">二维前缀和</a></li>
<li><a href="#%E4%BA%8C%E7%BB%B4%E7%9F%A9%E9%98%B5%E4%BF%AE%E6%94%B9-%E7%9F%A9%E9%98%B5%E6%9F%A5%E8%AF%A2">二维矩阵修改, 矩阵查询</a></li>
</ul>
</li>
<li><a href="#lct">LCT</a></li>
<li><a href="#%E7%BA%BF%E6%AE%B5%E6%A0%91">线段树</a>
<ul>
<li><a href="#%E5%85%88%E8%BF%9B%E7%9A%84%E6%A8%A1%E6%9D%BF%E5%8C%96%E7%BA%BF%E6%AE%B5%E6%A0%91">先进的模板化线段树</a></li>
</ul>
</li>
<li><a href="#%E4%B8%8D%E9%82%A3%E4%B9%88%E5%85%88%E8%BF%9B%E7%9A%84%E7%BA%BF%E6%AE%B5%E6%A0%91">不那么先进的线段树</a></li>
<li><a href="#st-%E8%A1%A8">ST 表</a></li>
<li><a href="#splay">Splay</a></li>
<li><a href="#%E6%A0%91%E9%93%BE%E5%89%96%E5%88%86">树链剖分</a></li>
<li><a href="#treap">Treap</a></li>
</ul>
</li>
<li><a href="#%E5%9B%BE%E8%AE%BA">图论</a>
<ul>
<li><a href="#%E8%BE%B9%E5%8F%8C%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F%E4%B8%8E%E6%9F%93%E8%89%B2">边双连通分量与染色</a></li>
<li><a href="#%E7%82%B9%E5%8F%8C%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F%E5%92%8C%E5%89%B2%E7%82%B9">点双连通分量和割点</a></li>
<li><a href="#dinic-%E7%BD%91%E7%BB%9C%E6%B5%81">Dinic 网络流</a></li>
<li><a href="#ek-%E7%BD%91%E7%BB%9C%E6%B5%81">EK 网络流</a></li>
<li><a href="#kruscal-%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91">Kruscal 最小生成树</a></li>
<li><a href="#%E5%80%8D%E5%A2%9E-lca">倍增 LCA</a></li>
<li><a href="#%E9%93%BE%E5%BC%8F%E5%89%8D%E5%90%91%E6%98%9F">链式前向星</a></li>
<li><a href="#%E6%9C%80%E5%B0%8F%E8%B4%B9%E7%94%A8%E6%9C%80%E5%A4%A7%E6%B5%81">最小费用最大流</a></li>
<li><a href="#%E7%BD%91%E7%BB%9C%E6%B5%81%E5%9F%BA%E7%B1%BB">网络流基类</a></li>
<li><a href="#%E6%9C%89%E5%90%91%E5%9B%BE%E5%BC%BA%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F">有向图强连通分量</a></li>
<li><a href="#%E6%9C%80%E7%9F%AD%E8%B7%AF">最短路</a>
<ul>
<li><a href="#dijkstra">Dijkstra</a></li>
<li><a href="#spfa">SPFA</a></li>
</ul>
</li>
<li><a href="#%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F">拓扑排序</a></li>
<li><a href="#%E7%9F%A9%E9%98%B5%E6%A0%91%E5%AE%9A%E7%90%86">矩阵树定理</a></li>
<li><a href="#%E6%9C%80%E5%B0%8F%E6%A0%91%E5%BD%A2%E5%9B%BE">最小树形图</a></li>
<li><a href="#%E5%85%A8%E5%B1%80%E6%9C%80%E5%B0%8F%E5%89%B2">全局最小割</a></li>
</ul>
</li>
<li><a href="#%E6%95%B0%E5%AD%A6">数学</a>
<ul>
<li><a href="#%E7%BB%84%E5%90%88%E6%95%B0">组合数</a>
<ul>
<li><a href="#%E7%BB%84%E5%90%88%E6%95%B0%E9%80%92%E6%8E%A8">组合数递推</a></li>
<li><a href="#%E5%8D%A2%E5%8D%A1%E6%96%AF%E5%AE%9A%E7%90%86">卢卡斯定理</a></li>
</ul>
</li>
<li><a href="#exgcd">Exgcd</a></li>
<li><a href="#%E9%AB%98%E6%96%AF%E6%B6%88%E5%85%83%E7%9B%B8%E5%85%B3">高斯消元相关</a>
<ul>
<li><a href="#%E8%A7%A3%E7%BA%BF%E6%80%A7%E6%96%B9%E7%A8%8B%E7%BB%84">解线性方程组</a></li>
<li><a href="#%E8%A1%8C%E5%88%97%E5%BC%8F">行列式</a></li>
</ul>
</li>
<li><a href="#%E5%A4%9A%E9%A1%B9%E5%BC%8F">多项式</a></li>
<li><a href="#%E8%B4%A8%E6%95%B0">质数</a>
<ul>
<li><a href="#%E7%BA%BF%E6%80%A7%E7%AD%9B">线性筛</a></li>
<li><a href="#%E6%AC%A7%E6%8B%89-phi-%E5%87%BD%E6%95%B0">欧拉 Phi 函数</a></li>
<li><a href="#mr-%E7%B4%A0%E6%95%B0%E6%B5%8B%E8%AF%95">MR 素数测试</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E5%85%B6%E4%BB%96">其他</a>
<ul>
<li><a href="#ac-%E8%87%AA%E5%8A%A8%E6%9C%BA">AC 自动机</a></li>
<li><a href="#io-%E4%BC%98%E5%8C%96">IO 优化</a></li>
<li><a href="#kmp">KMP</a>
<ul>
<li><a href="#exkmp">EXKMP</a></li>
</ul>
</li>
<li><a href="#%E9%A9%AC%E6%8B%89%E8%BD%A6">马拉车</a></li>
<li><a href="#%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F">归并排序</a></li>
<li><a href="#%E8%8E%AB%E9%98%9F">莫队</a>
<ul>
<li><a href="#%E6%99%AE%E9%80%9A%E8%8E%AB%E9%98%9F">普通莫队</a></li>
<li><a href="#%E4%B8%8D%E5%88%A0%E9%99%A4%E8%8E%AB%E9%98%9F">不删除莫队</a></li>
<li><a href="#%E6%A0%91%E4%B8%8A%E8%8E%AB%E9%98%9F">树上莫队</a></li>
</ul>
</li>
<li><a href="#%E6%A8%A1%E6%8B%9F%E9%80%80%E7%81%AB">模拟退火</a></li>
<li><a href="#%E5%90%8E%E7%BC%80%E8%87%AA%E5%8A%A8%E6%9C%BA">后缀自动机</a></li>
<li><a href="#%E5%90%8E%E7%BC%80%E6%95%B0%E7%BB%84">后缀数组</a></li>
</ul>
</li>
<li><a href="#%E5%AF%B9%E6%8B%8D">对拍</a>
<ul>
<li><a href="#shell">Shell</a></li>
<li><a href="#powershell">PowerShell</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="数据结构">数据结构</h2>
<h3 id="笛卡尔树">笛卡尔树</h3>
<p>给定一个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>∼</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">1 \sim n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 的排列 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span>，构建其笛卡尔树。</p>
<p>即构建一棵二叉树，满足：</p>
<ol>
<li>每个节点的编号满足二叉搜索树的性质。</li>
<li>节点 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 的权值为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">p_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，每个节点的权值满足小根堆的性质。</li>
</ol>
<pre><code class="language-cpp"><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">cartesian_tree</span> {</span>
   <span class="hljs-keyword">protected</span>:
    <span class="hljs-keyword">int</span> lson[MAXN], rson[MAXN], rt;
    <span class="hljs-keyword">int</span> s[<span class="hljs-number">1000</span>], top;
    <span class="hljs-keyword">int</span>* a;

   <span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">cartesian_tree</span>(<span class="hljs-keyword">int</span> n, <span class="hljs-keyword">int</span>* a) {
        <span class="hljs-built_in">memset</span>(lson, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> lson);
        <span class="hljs-built_in">memset</span>(rson, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> rson);
        top = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">this</span>-&gt;a = a;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) {
            <span class="hljs-keyword">while</span> (top &amp;&amp; a[s[top]] &lt;= a[i]) {
                lson[i] = s[top--];
            }
            rson[s[top]] = i;
            s[++top] = i;
        }
        rt = s[<span class="hljs-number">1</span>];
    }

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r)</span> </span>{
        <span class="hljs-keyword">int</span> x = rt;
        <span class="hljs-keyword">do</span> {
            <span class="hljs-keyword">if</span> (l &lt;= x &amp;&amp; x &lt;= r) {
                <span class="hljs-keyword">return</span> a[x];
            }
        } <span class="hljs-keyword">while</span> (x = (r &lt; x ? lson : rson)[x]);
    }
};
</div></code></pre>
<h3 id="dlx">DLX</h3>
<p>精确覆盖问题: 选择特定的行使得所有的列有且只含有一个 1.</p>
<pre><code class="language-cpp"><div><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">4</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> SIZE = N * N;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> ROW = SIZE * SIZE * SIZE + <span class="hljs-number">10</span>;  <span class="hljs-comment">//</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> COL = SIZE * SIZE * N + <span class="hljs-number">10</span>;     <span class="hljs-comment">// 这三个常数是必须的</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> POINT = ROW * <span class="hljs-number">4</span> + COL;          <span class="hljs-comment">//</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">dlx</span> {</span>
   <span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">int</span> n, m;
    <span class="hljs-keyword">int</span> pcnt;
    <span class="hljs-keyword">int</span> ansc, ans[ROW];

    <span class="hljs-built_in">dlx</span>(<span class="hljs-keyword">int</span> N, <span class="hljs-keyword">int</span> M) : <span class="hljs-built_in">n</span>(N), <span class="hljs-built_in">m</span>(M) {
        pcnt = <span class="hljs-number">0</span>;
        ansc = <span class="hljs-number">0</span>;
        <span class="hljs-built_in">memset</span>(ans, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> ans);
        <span class="hljs-built_in">memset</span>(p, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> p);
        <span class="hljs-built_in">memset</span>(row, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> row);
        <span class="hljs-built_in">memset</span>(col, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> col);

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt;= m; i++) {
            col[i] = <span class="hljs-number">0</span>;
            p[i].u = p[i].d = i;
            p[i].l = i - <span class="hljs-number">1</span>;
            p[i].r = i + <span class="hljs-number">1</span>;
        }
        p[<span class="hljs-number">0</span>].l = m;
        p[m].r = <span class="hljs-number">0</span>;
        pcnt = m;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) {
            row[i] = <span class="hljs-number">-1</span>;
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insert</span><span class="hljs-params">(<span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> c)</span> </span>{
        pcnt++;
        p[pcnt].col = c;
        col[c]++;
        p[pcnt].row = r;
        p[pcnt].d = p[c].d;
        p[p[c].d].u = pcnt;
        p[pcnt].u = c;
        p[c].d = pcnt;

        <span class="hljs-keyword">if</span> (row[r] == <span class="hljs-number">-1</span>) {
            row[r] = p[pcnt].l = p[pcnt].r = pcnt;
        } <span class="hljs-keyword">else</span> {
            p[pcnt].r = p[row[r]].r;
            p[p[row[r]].r].l = pcnt;
            p[pcnt].l = row[r];
            p[row[r]].r = pcnt;
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">search</span><span class="hljs-params">(<span class="hljs-keyword">int</span> d)</span> </span>{
        <span class="hljs-comment">// clog &lt;&lt; &quot;enter&quot; &lt;&lt; d &lt;&lt; endl;</span>
        <span class="hljs-keyword">if</span> (p[<span class="hljs-number">0</span>].r == <span class="hljs-number">0</span>) {
            ansc = d;
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">int</span> c = p[<span class="hljs-number">0</span>].r;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = p[<span class="hljs-number">0</span>].r; i != <span class="hljs-number">0</span>; i = p[i].r) {
            <span class="hljs-keyword">if</span> (col[i] &lt; col[c]) {
                c = i;
            }
        }
        <span class="hljs-built_in">remove</span>(c);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = p[c].d; i != c; i = p[i].d) {
            ans[d] = p[i].row;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = p[i].r; j != i; j = p[j].r) {
                <span class="hljs-built_in">remove</span>(p[j].col);
            }
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">search</span>(d + <span class="hljs-number">1</span>)) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = p[i].l; j != i; j = p[j].l) {
                <span class="hljs-built_in">resume</span>(p[j].col);
            }
        }
        <span class="hljs-built_in">resume</span>(c);
        <span class="hljs-comment">// clog &lt;&lt; &quot;exit &quot; &lt;&lt; d &lt;&lt; endl;</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

   <span class="hljs-keyword">protected</span>:
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span> {</span>
        <span class="hljs-keyword">int</span> u, d, l, r;
        <span class="hljs-keyword">int</span> row, col;
    } p[POINT];
    <span class="hljs-keyword">int</span> row[ROW];
    <span class="hljs-keyword">int</span> col[COL];

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">remove</span><span class="hljs-params">(<span class="hljs-keyword">int</span> c)</span> </span>{
        <span class="hljs-comment">// clog &lt;&lt; &quot;remove &quot; &lt;&lt; c &lt;&lt; endl;</span>
        p[p[c].r].l = p[c].l;
        p[p[c].l].r = p[c].r;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = p[c].d; i != c; i = p[i].d) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = p[i].r; j != i; j = p[j].r) {
                p[p[j].d].u = p[j].u;
                p[p[j].u].d = p[j].d;
                col[p[j].col]--;
            }
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">resume</span><span class="hljs-params">(<span class="hljs-keyword">int</span> c)</span> </span>{
        <span class="hljs-comment">// clog &lt;&lt; &quot;resume &quot; &lt;&lt; c &lt;&lt; endl;</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = p[c].u; i != c; i = p[i].u) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = p[i].l; j != i; j = p[j].l) {
                p[p[j].d].u = p[p[j].u].d = j;
                col[p[j].col]++;
            }
        }
        p[p[c].r].l = p[p[c].l].r = c;
    }
};

</div></code></pre>
<h3 id="树状数组">树状数组</h3>
<pre><code class="language-cpp"><div><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> <span class="hljs-keyword">value_t</span>&gt;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">fenwick</span> {</span>
   <span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">fenwick</span>(<span class="hljs-keyword">int</span> n) : <span class="hljs-built_in">n</span>(n), <span class="hljs-built_in">c</span>(n + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>) {}

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i, <span class="hljs-keyword">value_t</span> x)</span> </span>{
        <span class="hljs-keyword">while</span> (i &lt;= n) {
            c[i] += x;
            i += <span class="hljs-built_in">lowbit</span>(i);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">value_t</span> <span class="hljs-title">sum</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>{
        <span class="hljs-keyword">value_t</span> sum = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (x &gt; <span class="hljs-number">0</span>) {
            sum += c[x];
            x -= <span class="hljs-built_in">lowbit</span>(x);
        }
        <span class="hljs-keyword">return</span> sum;
    }

    <span class="hljs-function"><span class="hljs-keyword">value_t</span> <span class="hljs-title">sum</span><span class="hljs-params">(<span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r)</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span>(r) - <span class="hljs-built_in">sum</span>(l - <span class="hljs-number">1</span>); }

   <span class="hljs-keyword">private</span>:
    vector&lt;<span class="hljs-keyword">value_t</span>&gt; c;
    <span class="hljs-keyword">int</span> n;

    <span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">int</span> <span class="hljs-title">lowbit</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>{ <span class="hljs-keyword">return</span> x &amp; (-x); }
};
</div></code></pre>
<p>树状数组是一种能够<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>在线维护前缀和的数据结构, 其写法简单常数小... 不具体介绍了, 看看一些奇妙的操作吧.</p>
<h4 id="人人都会的">人人都会的</h4>
<ul>
<li>单点修改, 区间查询: 基本维护前缀和</li>
<li>区间修改, 单点查询: 维护差分</li>
</ul>
<h4 id="区间修改-区间查询">区间修改, 区间查询</h4>
<p>引入数组<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">d_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>表示区间<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>i</mi><mo separator="true">,</mo><mi>n</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[i, n]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">]</span></span></span></span>中需要加值的差分, 进行区间加法时, 就直接对<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span>操作, 对<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mi>l</mi></msub></mrow><annotation encoding="application/x-tex">d_l</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>加上<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>, 对<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mrow><mi>r</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">d_{r+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9028em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span>减去<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>. 查询前缀和时, 设<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>u</mi><msub><mi>m</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">sum_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>为区间<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>1</mn><mo separator="true">,</mo><mi>i</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[1,i]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">i</span><span class="mclose">]</span></span></span></span>的元素和, 易得</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>s</mi><mi>u</mi><msub><mi>m</mi><mi>i</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>i</mi></munderover><mo stretchy="false">(</mo><msub><mi>a</mi><mi>j</mi></msub><mo stretchy="false">)</mo><mo>+</mo><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>i</mi></munderover><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>j</mi></munderover><mo stretchy="false">(</mo><msub><mi>d</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>i</mi></munderover><mo stretchy="false">(</mo><msub><mi>a</mi><mi>j</mi></msub><mo stretchy="false">)</mo><mo>+</mo><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>i</mi></munderover><mo stretchy="false">(</mo><msub><mi>d</mi><mi>j</mi></msub><mo>×</mo><mo stretchy="false">(</mo><mi>i</mi><mo>−</mo><mi>j</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>i</mi></munderover><mo stretchy="false">(</mo><msub><mi>a</mi><mi>j</mi></msub><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>i</mi></munderover><mo stretchy="false">(</mo><msub><mi>d</mi><mi>j</mi></msub><mo stretchy="false">)</mo><mo>+</mo><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>i</mi></munderover><mo stretchy="false">(</mo><msub><mi>d</mi><mi>j</mi></msub><mo>∗</mo><mi>j</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}
    sum_i &amp;= \sum_{j=1}^i(a_j) + \sum_{j=1}^i\sum_{k=1}^j(d_k) \\
          &amp;= \sum_{j=1}^i(a_j) + \sum_{j=1}^i(d_j\times(i-j+1)) \\
          &amp;= \sum_{j=1}^i(a_j) + (i+1)\sum_{j=1}^i(d_j) + \sum_{j=1}^i(d_j*j) 
\end{aligned}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:10.6234em;vertical-align:-5.0617em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:5.5617em;"><span style="top:-7.5617em;"><span class="pstrut" style="height:3.8588em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-4.0363em;"><span class="pstrut" style="height:3.8588em;"></span><span class="mord"></span></span><span style="top:-0.5108em;"><span class="pstrut" style="height:3.8588em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:5.0617em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:5.5617em;"><span style="top:-7.5617em;"><span class="pstrut" style="height:3.8588em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8117em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8117em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8588em;"><span style="top:-1.8479em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3471em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3021em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-4.0363em;"><span class="pstrut" style="height:3.8588em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8117em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8117em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">))</span></span></span><span style="top:-0.5108em;"><span class="pstrut" style="height:3.8588em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8117em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8117em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8117em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:5.0617em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>发现我们需要维护<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">a_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">d_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mi>i</mi></msub><mo>×</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">d_i\times i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span>的前缀和. 代码可以这样写:</p>
<pre><code class="language-cpp"><div><span class="hljs-keyword">int</span> suma[MAXN], sumd[MAXN], sumdi[MAXN];

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-keyword">int</span>* c, <span class="hljs-keyword">int</span> pos, <span class="hljs-keyword">int</span> x)</span> </span>{
    <span class="hljs-keyword">while</span> (pos &lt;= n) {
        c[pos] += x;
        pos += <span class="hljs-built_in">lowbit</span>(pos);
    }
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sum</span><span class="hljs-params">(<span class="hljs-keyword">int</span>* c, <span class="hljs-keyword">int</span> pos)</span> </span>{
    <span class="hljs-keyword">int</span> res = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">while</span> (pos &gt;= <span class="hljs-number">1</span>) {
        res += c[pos];
        pos -= <span class="hljs-built_in">lowbit</span>(pos);
    }
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> x)</span> </span>{
    <span class="hljs-built_in">update</span>(sumd, l, x);
    <span class="hljs-built_in">update</span>(sumd, r + <span class="hljs-number">1</span>, -x);
    <span class="hljs-built_in">update</span>(sumdi, l, l * x);
    <span class="hljs-built_in">update</span>(sumdi, r + <span class="hljs-number">1</span>, -(r + <span class="hljs-number">1</span>) * x);
}

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r)</span> </span>{
    <span class="hljs-keyword">return</span> suma[r] + r * <span class="hljs-built_in">sum</span>(sumd, r) + <span class="hljs-built_in">sum</span>(sumdi, r)
           - (suma[l - <span class="hljs-number">1</span>] + (l - <span class="hljs-number">1</span>) * <span class="hljs-built_in">sum</span>(sumd, l - <span class="hljs-number">1</span>) + <span class="hljs-built_in">sum</span>(sumdi, l));
}
</div></code></pre>
<h4 id="二维前缀和">二维前缀和</h4>
<p>首先, 由二维前缀和求矩阵<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo>→</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(x_1, y_1)\rightarrow(x_2,y_2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>的操作方法:</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>s</mi><mi>u</mi><mi>m</mi><mo>=</mo><mi>s</mi><mi>u</mi><mi>m</mi><mo stretchy="false">[</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy="false">]</mo><mo stretchy="false">[</mo><msub><mi>y</mi><mn>2</mn></msub><mo stretchy="false">]</mo><mo>−</mo><mi>s</mi><mi>u</mi><mi>m</mi><mo stretchy="false">[</mo><msub><mi>x</mi><mn>1</mn></msub><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><msub><mi>y</mi><mn>2</mn></msub><mo stretchy="false">]</mo><mo>−</mo><mi>s</mi><mi>u</mi><mi>m</mi><mo stretchy="false">[</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy="false">]</mo><mo stretchy="false">[</mo><msub><mi>y</mi><mn>1</mn></msub><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>+</mo><mi>s</mi><mi>u</mi><mi>m</mi><mo stretchy="false">[</mo><msub><mi>x</mi><mn>1</mn></msub><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><msub><mi>x</mi><mn>2</mn></msub><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">sum=sum[x_2][y_2]-sum[x_1-1][y_2]-sum[x_2][y_1-1]+sum[x_1-1][x_2-1]
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span></span></p>
<p>用树状数组维护二维前缀和的方法:</p>
<pre><code class="language-cpp"><div><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y, <span class="hljs-keyword">int</span> val)</span> </span>{
    <span class="hljs-keyword">while</span> (x &lt;= n) {
        <span class="hljs-keyword">int</span> t = y;
        <span class="hljs-keyword">while</span> (t &lt;= m) {
            c[x][t] += val;
            t += <span class="hljs-built_in">lowbit</span>(t);
        }
        x += <span class="hljs-built_in">lowbit</span>(x);
    }
}

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>{
    <span class="hljs-keyword">int</span> res = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">while</span> (x &gt;= <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">int</span> t = y;
        <span class="hljs-keyword">while</span> (t &gt;= <span class="hljs-number">1</span>) {
            res += c[x][t]
            t -= <span class="hljs-built_in">lowbit</span>(t);
        }
        x -= <span class="hljs-built_in">lowbit</span>(x);
    }
    <span class="hljs-keyword">return</span> res;
}
</div></code></pre>
<p>因此不难做到二维单点修改, 矩阵查询.</p>
<h4 id="二维矩阵修改-矩阵查询">二维矩阵修改, 矩阵查询</h4>
<p>首先说明一下二维差分怎么写. 由二维前缀和的形式, 定义</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>d</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo>=</mo><mi>a</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo>−</mo><mi>a</mi><mo stretchy="false">[</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo>−</mo><mi>a</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo>+</mo><mi>a</mi><mo stretchy="false">[</mo><mi>i</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">d[i][j] = a[i][j] - a[i-1][j] - a[i][j-1] + a[i-1][j-1]
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">a</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">a</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">a</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">a</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span></span></p>
<p>因此</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>a</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo>=</mo><munderover><mo>∑</mo><mrow><mi>n</mi><mo>=</mo><mn>1</mn></mrow><mi>i</mi></munderover><munderover><mo>∑</mo><mrow><mi>m</mi><mo>=</mo><mn>1</mn></mrow><mi>j</mi></munderover><mo stretchy="false">(</mo><mi>d</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>m</mi><mo stretchy="false">]</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">a[i][j] = \sum_{n=1}^i\sum_{m=1}^j(d[n][m])
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">a</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3.1259em;vertical-align:-1.2671em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8117em;"><span style="top:-1.8829em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2671em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8588em;"><span style="top:-1.8829em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3471em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2671em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">d</span><span class="mopen">[</span><span class="mord mathnormal">n</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal">m</span><span class="mclose">])</span></span></span></span></span></p>
<p>即可用二维树状数组维护差分.</p>
<p>比如给一个<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn><mo>×</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">5\times5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">5</span></span></span></span>的矩阵中间<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn><mo>×</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">3\times3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span></span></span></span>的部分加上<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>, 可以这么修改差分数组:</p>
<pre><code><code><div> 0  0  0  0  0
 0 +x  0  0 -x
 0  0  0  0  0
 0  0  0  0  0
 0 -x  0  0 +x
</div></code></code></pre>
<p>所以矩阵修改操作的写法:</p>
<pre><code class="language-cpp"><div><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x1, <span class="hljs-keyword">int</span> y1, <span class="hljs-keyword">int</span> x2, <span class="hljs-keyword">int</span> y2, <span class="hljs-keyword">int</span> x)</span> </span>{
    <span class="hljs-built_in">update</span>(x1, y1, x);
    <span class="hljs-built_in">update</span>(x1, y2 + <span class="hljs-number">1</span>, -x);
    <span class="hljs-built_in">update</span>(x2 + <span class="hljs-number">1</span>, y1, -x);
    <span class="hljs-built_in">update</span>(x2 + <span class="hljs-number">1</span>, y2 + <span class="hljs-number">1</span>, x);
} 
</div></code></pre>
<p>为了实现二维区间修改和查询的操作, 我们可以类比一维的情况, 用差分来表示前缀和.</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>s</mi><mi>u</mi><mi>m</mi><mo stretchy="false">[</mo><mi>x</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>y</mi><mo stretchy="false">]</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>x</mi></munderover><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>y</mi></munderover><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>x</mi></munderover><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>y</mi></munderover><munderover><mo>∑</mo><mrow><mi>n</mi><mo>=</mo><mn>1</mn></mrow><mi>i</mi></munderover><munderover><mo>∑</mo><mrow><mi>m</mi><mo>=</mo><mn>1</mn></mrow><mi>j</mi></munderover><mo stretchy="false">(</mo><mi>d</mi><mo stretchy="false">[</mo><mi>n</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>m</mi><mo stretchy="false">]</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}    
sum[x][y] &amp;= \sum_{i=1}^x\sum_{j=1}^y(a[i][j]) \\
          &amp;= \sum_{i=1}^x\sum_{j=1}^y\sum_{n=1}^i\sum_{m=1}^j(d[n][m])
\end{aligned}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:6.9848em;vertical-align:-3.2424em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.7424em;"><span style="top:-5.9027em;"><span class="pstrut" style="height:3.8588em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mopen">[</span><span class="mord mathnormal">x</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">]</span></span></span><span style="top:-2.3301em;"><span class="pstrut" style="height:3.8588em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.2424em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.7424em;"><span style="top:-5.9027em;"><span class="pstrut" style="height:3.8588em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6985em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3471em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">])</span></span></span><span style="top:-2.3301em;"><span class="pstrut" style="height:3.8588em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6985em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3471em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8117em;"><span style="top:-1.8829em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2671em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8588em;"><span style="top:-1.8829em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3471em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2671em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">d</span><span class="mopen">[</span><span class="mord mathnormal">n</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal">m</span><span class="mclose">])</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.2424em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>根据前面的套路, 我们统计每一个<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">d[i][j]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span></span>的出现次数, 可以展开两层<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Σ</mi></mrow><annotation encoding="application/x-tex">\Sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Σ</span></span></span></span>:</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>s</mi><mi>u</mi><mi>m</mi><mo stretchy="false">[</mo><mi>x</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>y</mi><mo stretchy="false">]</mo><mo>=</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>x</mi></munderover><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>y</mi></munderover><mi>d</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo>∗</mo><mo stretchy="false">(</mo><mi>x</mi><mo>−</mo><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>∗</mo><mo stretchy="false">(</mo><mi>y</mi><mo>−</mo><mi>j</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo stretchy="false">(</mo><mi>x</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>∗</mo><mo stretchy="false">(</mo><mi>y</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>x</mi></munderover><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>y</mi></munderover><mi>d</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>−</mo><mo stretchy="false">(</mo><mi>y</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>x</mi></munderover><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>y</mi></munderover><mi>d</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo>∗</mo><mi>i</mi><mo>−</mo><mo stretchy="false">(</mo><mi>x</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>x</mi></munderover><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>y</mi></munderover><mi>d</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo>∗</mo><mi>j</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>x</mi></munderover><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>y</mi></munderover><mi>d</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo>∗</mo><mi>i</mi><mo>∗</mo><mi>j</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}    
sum[x][y] =&amp; \sum_{i=1}^x\sum_{j=1}^yd[i][j] * (x-i+1) * (y-j+1) \\
          =&amp; (x+1)*(y+1)\sum_{i=1}^x\sum_{j=1}^yd[i][j] \\
           &amp; -(y+1)\sum_{i=1}^x\sum_{j=1}^yd[i][j]*i-(x+1)\sum_{i=1}^x\sum_{j=1}^yd[i][j]*j \\
           &amp; +\sum_{i=1}^x\sum_{j=1}^yd[i][j]*i*j
\end{aligned}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:13.6491em;vertical-align:-6.5746em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:7.0746em;"><span style="top:-9.0746em;"><span class="pstrut" style="height:3.6985em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mopen">[</span><span class="mord mathnormal">x</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span></span></span><span style="top:-5.6623em;"><span class="pstrut" style="height:3.6985em;"></span><span class="mord"><span class="mrel">=</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.6985em;"></span><span class="mord"></span></span><span style="top:1.1623em;"><span class="pstrut" style="height:3.6985em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:6.5746em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:7.0746em;"><span style="top:-9.0746em;"><span class="pstrut" style="height:3.6985em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6985em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3471em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">d</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span style="top:-5.6623em;"><span class="pstrut" style="height:3.6985em;"></span><span class="mord"><span class="mord"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6985em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3471em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">d</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.6985em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6985em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3471em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">d</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6985em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3471em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">d</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span><span style="top:1.1623em;"><span class="pstrut" style="height:3.6985em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6985em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3471em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">d</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:6.5746em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>也就是说, 我们需要维护</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>x</mi></msubsup><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>y</mi></msubsup><mi>d</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\sum_{i=1}^x\sum_{j=1}^yd[i][j]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2401em;vertical-align:-0.4358em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">d</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>x</mi></msubsup><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>y</mi></msubsup><mi>d</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo>∗</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">\sum_{i=1}^x\sum_{j=1}^yd[i][j]*i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2401em;vertical-align:-0.4358em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">d</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>x</mi></msubsup><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>y</mi></msubsup><mi>d</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo>∗</mo><mi>j</mi></mrow><annotation encoding="application/x-tex">\sum_{i=1}^x\sum_{j=1}^yd[i][j]*j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2401em;vertical-align:-0.4358em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">d</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>x</mi></msubsup><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>y</mi></msubsup><mi>d</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo>∗</mo><mi>i</mi><mo>∗</mo><mi>j</mi></mrow><annotation encoding="application/x-tex">\sum_{i=1}^x\sum_{j=1}^yd[i][j]*i*j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2401em;vertical-align:-0.4358em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">d</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span></li>
</ul>
<p>开四个树状数组即可. 这样用树状数组写, 常数会比线段树小一些.</p>
<h3 id="lct">LCT</h3>
<pre><code class="language-cpp"><div><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> <span class="hljs-keyword">value_t</span>&gt;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">lct</span> {</span>
   <span class="hljs-keyword">protected</span>:
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span> {</span>
        node* ch[<span class="hljs-number">2</span>];  <span class="hljs-comment">// 左儿子在原树中深度更浅, 右儿子更深</span>
        node* fa;     <span class="hljs-comment">// splay链上的父指针</span>
        node* top;  <span class="hljs-comment">// splay根的虚边指针, 若不是splay的根则为nullptr</span>
        <span class="hljs-keyword">value_t</span> val, sum;
        <span class="hljs-keyword">int</span> id;
        <span class="hljs-keyword">bool</span> flip = <span class="hljs-literal">false</span>;
        <span class="hljs-built_in">node</span>(<span class="hljs-keyword">value_t</span> v, <span class="hljs-keyword">int</span> i, node* def = <span class="hljs-literal">nullptr</span>) : <span class="hljs-built_in">val</span>(v), <span class="hljs-built_in">sum</span>(v), <span class="hljs-built_in">id</span>(i) {
            ch[<span class="hljs-number">0</span>] = ch[<span class="hljs-number">1</span>] = fa = top = def;
        }
        <span class="hljs-comment">// 这个节点是不是某一个splay的根</span>
        <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">is_splay_root</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> top != <span class="hljs-literal">nullptr</span>; }
        <span class="hljs-comment">// 更新sum信息</span>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">push_up</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-comment">// clog &lt;&lt; id &lt;&lt; &#x27; &#x27; &lt;&lt; val &lt;&lt; &#x27;+&#x27;</span>
            <span class="hljs-comment">//      &lt;&lt; ((ch[0] == nullptr) ? 0 : ch[0]-&gt;val) &lt;&lt; &#x27;+&#x27;</span>
            <span class="hljs-comment">//      &lt;&lt; ((ch[1] == nullptr) ? 0 : ch[1]-&gt;val);</span>
            sum = val;
            <span class="hljs-keyword">if</span> (ch[<span class="hljs-number">0</span>] != <span class="hljs-literal">nullptr</span>) sum ^= ch[<span class="hljs-number">0</span>]-&gt;sum;
            <span class="hljs-keyword">if</span> (ch[<span class="hljs-number">1</span>] != <span class="hljs-literal">nullptr</span>) sum ^= ch[<span class="hljs-number">1</span>]-&gt;sum;
            <span class="hljs-comment">// clog &lt;&lt; &quot; = &quot; &lt;&lt; sum &lt;&lt; endl;</span>
        }
        <span class="hljs-comment">// 下传翻转信息</span>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">push_down</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">if</span> (flip) {
                <span class="hljs-built_in">swap</span>(ch[<span class="hljs-number">0</span>], ch[<span class="hljs-number">1</span>]);
                <span class="hljs-keyword">if</span> (ch[<span class="hljs-number">0</span>] != <span class="hljs-literal">nullptr</span>) ch[<span class="hljs-number">0</span>]-&gt;flip ^= <span class="hljs-number">1</span>;
                <span class="hljs-keyword">if</span> (ch[<span class="hljs-number">1</span>] != <span class="hljs-literal">nullptr</span>) ch[<span class="hljs-number">1</span>]-&gt;flip ^= <span class="hljs-number">1</span>;
                flip = <span class="hljs-literal">false</span>;
            }
        }
        <span class="hljs-comment">// 使fa成为自己的左/右儿子. 在splay树中升高rt</span>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">rotate</span><span class="hljs-params">(<span class="hljs-keyword">int</span> d)</span> </span>{
            <span class="hljs-comment">// 方便起见, 下列代码保留this</span>
            node* cur = <span class="hljs-keyword">this</span>-&gt;fa;
            <span class="hljs-keyword">this</span>-&gt;fa = cur-&gt;fa;
            <span class="hljs-keyword">if</span> (cur-&gt;fa != <span class="hljs-literal">nullptr</span>) {
                <span class="hljs-keyword">if</span> (cur-&gt;fa-&gt;ch[<span class="hljs-number">0</span>] == cur)
                    cur-&gt;fa-&gt;ch[<span class="hljs-number">0</span>] = <span class="hljs-keyword">this</span>;
                <span class="hljs-keyword">else</span>
                    cur-&gt;fa-&gt;ch[<span class="hljs-number">1</span>] = <span class="hljs-keyword">this</span>;
            }
            cur-&gt;ch[d ^ <span class="hljs-number">1</span>] = <span class="hljs-keyword">this</span>-&gt;ch[d];
            <span class="hljs-keyword">if</span> (cur-&gt;ch[d ^ <span class="hljs-number">1</span>] != <span class="hljs-literal">nullptr</span>) cur-&gt;ch[d ^ <span class="hljs-number">1</span>]-&gt;fa = cur;
            <span class="hljs-keyword">this</span>-&gt;ch[d] = cur;
            cur-&gt;fa = <span class="hljs-keyword">this</span>;
            cur-&gt;<span class="hljs-built_in">push_up</span>();
            <span class="hljs-keyword">this</span>-&gt;<span class="hljs-built_in">push_up</span>();
            <span class="hljs-comment">// 旋转使this升高, 应转移top指针</span>
            <span class="hljs-keyword">this</span>-&gt;top = cur-&gt;top;
            cur-&gt;top = <span class="hljs-literal">nullptr</span>;
        }

        <span class="hljs-comment">// 使rt成为rt所在splay树中的根节点</span>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">splay</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">while</span> (fa != <span class="hljs-literal">nullptr</span>) {
                node* cur = fa;
                cur-&gt;<span class="hljs-built_in">push_down</span>();
                <span class="hljs-keyword">if</span> (cur-&gt;ch[<span class="hljs-number">0</span>] != <span class="hljs-literal">nullptr</span>) cur-&gt;ch[<span class="hljs-number">0</span>]-&gt;<span class="hljs-built_in">push_down</span>();
                <span class="hljs-keyword">if</span> (cur-&gt;ch[<span class="hljs-number">1</span>] != <span class="hljs-literal">nullptr</span>) cur-&gt;ch[<span class="hljs-number">1</span>]-&gt;<span class="hljs-built_in">push_down</span>();
                <span class="hljs-comment">// rt作为cur的孩子之一已经pushdown了</span>
                <span class="hljs-comment">// cur作为rt的孩子时在反方向</span>
                <span class="hljs-keyword">if</span> (cur-&gt;ch[<span class="hljs-number">0</span>] == <span class="hljs-keyword">this</span>)
                    <span class="hljs-built_in">rotate</span>(<span class="hljs-number">1</span>);
                <span class="hljs-keyword">else</span>
                    <span class="hljs-built_in">rotate</span>(<span class="hljs-number">0</span>);
            }
        }

        <span class="hljs-comment">// 改变点权</span>
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">change_value</span><span class="hljs-params">(<span class="hljs-keyword">value_t</span> v)</span> </span>{
            <span class="hljs-built_in">splay</span>();
            <span class="hljs-built_in">push_down</span>();
            val = v;
            <span class="hljs-built_in">push_up</span>();
        }

        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">display</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-built_in">push_down</span>();
            clog &lt;&lt; <span class="hljs-string">&#x27;(&#x27;</span>;
            <span class="hljs-keyword">if</span> (ch[<span class="hljs-number">0</span>] != <span class="hljs-literal">nullptr</span>) {
                ch[<span class="hljs-number">0</span>]-&gt;<span class="hljs-built_in">display</span>();
                clog &lt;&lt; <span class="hljs-string">&quot;, &quot;</span>;
            }
            clog &lt;&lt; id;
            <span class="hljs-keyword">if</span> (ch[<span class="hljs-number">1</span>] != <span class="hljs-literal">nullptr</span>) {
                clog &lt;&lt; <span class="hljs-string">&quot;, &quot;</span>;
                ch[<span class="hljs-number">1</span>]-&gt;<span class="hljs-built_in">display</span>();
            }
            clog &lt;&lt; <span class="hljs-string">&#x27;)&#x27;</span>;
        }
    };

    vector&lt;node*&gt; pool;  <span class="hljs-comment">// 指向编号为id的点, 下标从1开始, 垫一个nullptr</span>

    <span class="hljs-comment">// 使rt和rt所在子树的根节点位于一条重链的两端</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">access</span><span class="hljs-params">(node* x)</span> </span>{
        <span class="hljs-keyword">if</span> (x == <span class="hljs-literal">nullptr</span>) <span class="hljs-keyword">return</span>;
        x-&gt;<span class="hljs-built_in">splay</span>();

        <span class="hljs-comment">// 断开x的右儿子</span>
        x-&gt;<span class="hljs-built_in">push_down</span>();
        <span class="hljs-keyword">if</span> (x-&gt;ch[<span class="hljs-number">1</span>] != <span class="hljs-literal">nullptr</span>) {
            x-&gt;ch[<span class="hljs-number">1</span>]-&gt;fa = <span class="hljs-literal">nullptr</span>;
            x-&gt;ch[<span class="hljs-number">1</span>]-&gt;top = x;
            x-&gt;ch[<span class="hljs-number">1</span>] = <span class="hljs-literal">nullptr</span>;
        }
        x-&gt;<span class="hljs-built_in">push_up</span>();

        <span class="hljs-comment">// 依次转移路径上的重链</span>
        <span class="hljs-keyword">while</span> (x-&gt;top != <span class="hljs-literal">nullptr</span>) {
            node* cur = x-&gt;top;
            cur-&gt;<span class="hljs-built_in">splay</span>();
            <span class="hljs-comment">// 先断开原有重链</span>
            cur-&gt;<span class="hljs-built_in">push_down</span>();
            <span class="hljs-keyword">if</span> (cur-&gt;ch[<span class="hljs-number">1</span>] != <span class="hljs-literal">nullptr</span>) {
                cur-&gt;ch[<span class="hljs-number">1</span>]-&gt;fa = <span class="hljs-literal">nullptr</span>;
                cur-&gt;ch[<span class="hljs-number">1</span>]-&gt;top = cur;
                cur-&gt;ch[<span class="hljs-number">1</span>] = <span class="hljs-literal">nullptr</span>;
            }
            <span class="hljs-comment">// 再连上新的重链</span>
            cur-&gt;ch[<span class="hljs-number">1</span>] = x;
            x-&gt;fa = cur;
            x-&gt;top = <span class="hljs-literal">nullptr</span>;
            cur-&gt;<span class="hljs-built_in">push_up</span>();
            x = cur;
        }
        x-&gt;<span class="hljs-built_in">splay</span>();  <span class="hljs-comment">// 保证复杂度</span>
    }

    <span class="hljs-comment">// 找到原树中的树根</span>
    <span class="hljs-function">node* <span class="hljs-title">find_root</span><span class="hljs-params">(node* x)</span> </span>{
        <span class="hljs-keyword">if</span> (x == <span class="hljs-literal">nullptr</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;
        <span class="hljs-built_in">access</span>(x);
        x-&gt;<span class="hljs-built_in">splay</span>();
        x-&gt;<span class="hljs-built_in">push_down</span>();
        <span class="hljs-keyword">while</span> (x-&gt;ch[<span class="hljs-number">0</span>] != <span class="hljs-literal">nullptr</span>) x = x-&gt;ch[<span class="hljs-number">0</span>];  <span class="hljs-comment">// splay过程中已经pushdown了</span>
        x-&gt;<span class="hljs-built_in">splay</span>();                                <span class="hljs-comment">// 保证复杂度</span>
        <span class="hljs-keyword">return</span> x;
    }

    <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">is_connected</span><span class="hljs-params">(node* a, node* b)</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-built_in">find_root</span>(a) == <span class="hljs-built_in">find_root</span>(b); }

    <span class="hljs-comment">// 重设原树中的树根</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">make_root</span><span class="hljs-params">(node* x)</span> </span>{
        <span class="hljs-keyword">if</span> (x == <span class="hljs-literal">nullptr</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-built_in">access</span>(x);
        x-&gt;<span class="hljs-built_in">splay</span>();
        x-&gt;flip ^= <span class="hljs-number">1</span>;
        x-&gt;<span class="hljs-built_in">push_down</span>();
    }

    <span class="hljs-comment">// 如果a, b之间可以连边, 就连一条虚边</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">link</span><span class="hljs-params">(node* a, node* b)</span> </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">is_connected</span>(a, b)) <span class="hljs-keyword">return</span>;
        <span class="hljs-comment">// a是根, b连到a上</span>
        <span class="hljs-built_in">make_root</span>(a);
        a-&gt;<span class="hljs-built_in">splay</span>();
        a-&gt;<span class="hljs-built_in">push_down</span>();
        <span class="hljs-built_in">access</span>(b);
        b-&gt;<span class="hljs-built_in">splay</span>();
        b-&gt;<span class="hljs-built_in">push_down</span>();

        a-&gt;ch[<span class="hljs-number">0</span>] = b;
        b-&gt;fa = a;
        b-&gt;top = <span class="hljs-literal">nullptr</span>;
        a-&gt;<span class="hljs-built_in">push_up</span>();
    }

    <span class="hljs-comment">// 如果a, b之间恰好有一条边, 就断开它</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">cut</span><span class="hljs-params">(node* a, node* b)</span> </span>{
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">is_connected</span>(a, b)) <span class="hljs-keyword">return</span>;
        <span class="hljs-built_in">make_root</span>(a);
        <span class="hljs-built_in">access</span>(b);
        b-&gt;<span class="hljs-built_in">splay</span>();
        b-&gt;<span class="hljs-built_in">push_down</span>();
        <span class="hljs-comment">// 判断边是否存在并删除(看a, b在排序二叉树上是否相邻)</span>
        <span class="hljs-keyword">if</span> (b-&gt;ch[<span class="hljs-number">0</span>] == a &amp;&amp; b-&gt;ch[<span class="hljs-number">0</span>]-&gt;ch[<span class="hljs-number">1</span>] == <span class="hljs-literal">nullptr</span>) {
            <span class="hljs-comment">// 直接双向断开</span>
            a-&gt;fa = a-&gt;top = <span class="hljs-literal">nullptr</span>;
            b-&gt;ch[<span class="hljs-number">0</span>] = <span class="hljs-literal">nullptr</span>;
        }
        b-&gt;<span class="hljs-built_in">push_up</span>();
    }

    <span class="hljs-comment">// 查询a到b的路径</span>
    <span class="hljs-function"><span class="hljs-keyword">value_t</span> <span class="hljs-title">query</span><span class="hljs-params">(node* a, node* b)</span> </span>{
        <span class="hljs-comment">// assert(is_connected(a, b));</span>
        <span class="hljs-built_in">make_root</span>(a);
        a-&gt;<span class="hljs-built_in">splay</span>();
        a-&gt;<span class="hljs-built_in">push_down</span>();
        <span class="hljs-built_in">access</span>(b);
        b-&gt;<span class="hljs-built_in">splay</span>();
        b-&gt;<span class="hljs-built_in">push_down</span>();
        <span class="hljs-keyword">return</span> b-&gt;sum;
    }

   <span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 创建一个空的lct</span>
    <span class="hljs-built_in">lct</span>() { pool.<span class="hljs-built_in">push_back</span>(<span class="hljs-literal">nullptr</span>); }
    ~<span class="hljs-built_in">lct</span>() {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> i : pool)
            <span class="hljs-keyword">if</span> (i != <span class="hljs-literal">nullptr</span>) <span class="hljs-keyword">delete</span> i;
    }
    <span class="hljs-comment">// 返回lct中节点数量</span>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">size</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> pool.<span class="hljs-built_in">size</span>() - <span class="hljs-number">1</span>; }

    <span class="hljs-comment">// 新建一个孤立节点</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insert_node</span><span class="hljs-params">(<span class="hljs-keyword">value_t</span> val)</span> </span>{
        pool.<span class="hljs-built_in">push_back</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">node</span>(val, pool.<span class="hljs-built_in">size</span>()));
    }
    <span class="hljs-comment">// 尝试链接a, b边</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insert_edge</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span> </span>{ <span class="hljs-built_in">link</span>(pool[a], pool[b]); }

    <span class="hljs-comment">// 尝试删除a, b边</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">erase_edge</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span> </span>{ <span class="hljs-built_in">cut</span>(pool[a], pool[b]); }

    <span class="hljs-comment">// 修改点权</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">assign_node</span><span class="hljs-params">(<span class="hljs-keyword">int</span> u, <span class="hljs-keyword">value_t</span> x)</span> </span>{ pool[u]-&gt;<span class="hljs-built_in">change_value</span>(x); }

    <span class="hljs-comment">// 查询a, b之间的路径; 若a, b不连通, 则断言失败</span>
    <span class="hljs-function"><span class="hljs-keyword">value_t</span> <span class="hljs-title">query_path</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-built_in">query</span>(pool[a], pool[b]); }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">display_subtree</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a)</span> </span>{ pool[a]-&gt;<span class="hljs-built_in">display</span>(); }
};
</div></code></pre>
<h3 id="线段树">线段树</h3>
<h4 id="先进的模板化线段树">先进的模板化线段树</h4>
<pre><code class="language-cpp"><div><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">segtree_data_store</span> {</span>
    int64 addv = <span class="hljs-number">0</span>;
    int64 mulv = <span class="hljs-number">1</span>;
    int64 sum = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">int</span> len = <span class="hljs-number">1</span>;

    <span class="hljs-built_in">segtree_data_store</span>() {}
    <span class="hljs-built_in">segtree_data_store</span>(<span class="hljs-keyword">int</span> val) : <span class="hljs-built_in">sum</span>(val) {}

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">push_down</span><span class="hljs-params">(segtree_data_store&amp; lson, segtree_data_store&amp; rson)</span> </span>{
        <span class="hljs-keyword">if</span> (mulv != <span class="hljs-number">1</span>) {
            lson.mulv *= mulv;
            rson.mulv *= mulv;
            lson.addv *= mulv;
            rson.addv *= mulv;
            lson.sum *= mulv;
            rson.sum *= mulv;
            mulv = <span class="hljs-number">1</span>;
        }
        <span class="hljs-keyword">if</span> (addv != <span class="hljs-number">0</span>) {
            lson.addv += addv;
            rson.addv += addv;
            lson.sum += addv * (len - len / <span class="hljs-number">2</span>);
            rson.sum += addv * (len / <span class="hljs-number">2</span>);
            addv = <span class="hljs-number">0</span>;
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">push_up</span><span class="hljs-params">(segtree_data_store&amp; lson, segtree_data_store&amp; rson)</span> </span>{
        sum = lson.sum + rson.sum;
        len = lson.len + rson.len;
    }
};

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">segtree_query_sum</span> {</span>
    int64 sum = <span class="hljs-number">0</span>;
    <span class="hljs-built_in">segtree_query_sum</span>() {}
    <span class="hljs-built_in">segtree_query_sum</span>(segtree_data_store&amp; seg) : <span class="hljs-built_in">sum</span>(seg.sum) {}
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">merge_left</span><span class="hljs-params">(segtree_query_sum lson)</span> </span>{ sum += lson.sum; }
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">merge_right</span><span class="hljs-params">(segtree_query_sum rson)</span> </span>{ sum += rson.sum; }
};

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">segtree_update_mul</span> {</span>
    int64 val = <span class="hljs-number">0</span>;
    <span class="hljs-built_in">segtree_update_mul</span>(int64 mul) : <span class="hljs-built_in">val</span>(mul) {}
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">apply</span><span class="hljs-params">(segtree_data_store&amp; seg)</span> <span class="hljs-keyword">const</span> </span>{
        seg.mulv *= val;
        seg.addv *= val;
        seg.sum *= val;
    }
};

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">segtree_update_add</span> {</span>
    int64 val = <span class="hljs-number">0</span>;
    <span class="hljs-built_in">segtree_update_add</span>(int64 add) : <span class="hljs-built_in">val</span>(add) {}
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">apply</span><span class="hljs-params">(segtree_data_store&amp; seg)</span> <span class="hljs-keyword">const</span> </span>{
        seg.addv += val;
        seg.sum += val * <span class="hljs-built_in">int64</span>(seg.len);
    }
};

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">segtree</span> {</span>
   <span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">segtree</span>(<span class="hljs-keyword">int</span> n) : <span class="hljs-built_in">n</span>(n), <span class="hljs-built_in">s</span>((n &lt;&lt; <span class="hljs-number">2</span>) + <span class="hljs-number">1</span>) { <span class="hljs-built_in">build</span>(<span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>); }
    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> TBaseData&gt;
    <span class="hljs-built_in">segtree</span>(<span class="hljs-keyword">int</span> n, TBaseData* data) : <span class="hljs-built_in">n</span>(n), <span class="hljs-built_in">s</span>((n &lt;&lt; <span class="hljs-number">2</span>) + <span class="hljs-number">1</span>) {
        <span class="hljs-built_in">build</span>(data, <span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">int</span> n;

    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> TUpdate&gt;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-keyword">int</span> L, <span class="hljs-keyword">int</span> R, <span class="hljs-keyword">const</span> TUpdate&amp; data)</span> </span>{
        <span class="hljs-built_in">update</span>(L, R, data, <span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> TQuery&gt;
    <span class="hljs-function">TQuery <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-keyword">int</span> L, <span class="hljs-keyword">int</span> R)</span> </span>{
        <span class="hljs-keyword">return</span> query&lt;TQuery&gt;(L, R, <span class="hljs-number">1</span>, n, <span class="hljs-number">1</span>);
    }

   <span class="hljs-keyword">protected</span>:
    vector&lt;segtree_data_store&gt; s;

<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> LSON l, mid, rt &lt;&lt; 1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> RSON mid + 1, r, rt &lt;&lt; 1 | 1</span>

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">build</span><span class="hljs-params">(<span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> rt)</span> </span>{
        <span class="hljs-keyword">if</span> (l == r) <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">int</span> mid = (l + r) &gt;&gt; <span class="hljs-number">1</span>;
        <span class="hljs-built_in">build</span>(LSON);
        <span class="hljs-built_in">build</span>(RSON);
        s[rt].<span class="hljs-built_in">push_up</span>(s[rt &lt;&lt; <span class="hljs-number">1</span>], s[rt &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span>]);
    }

    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> TBaseData&gt;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">build</span><span class="hljs-params">(TBaseData* data, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> rt)</span> </span>{
        <span class="hljs-keyword">if</span> (l == r) {
            s[rt] = data[l];
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">int</span> mid = (l + r) &gt;&gt; <span class="hljs-number">1</span>;
        <span class="hljs-built_in">build</span>(data, LSON);
        <span class="hljs-built_in">build</span>(data, RSON);
        s[rt].<span class="hljs-built_in">push_up</span>(s[rt &lt;&lt; <span class="hljs-number">1</span>], s[rt &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span>]);
    }

    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> TUpdate&gt;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-keyword">int</span> L, <span class="hljs-keyword">int</span> R, <span class="hljs-keyword">const</span> TUpdate&amp; data, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> rt)</span> </span>{
        <span class="hljs-keyword">if</span> (L &lt;= l &amp;&amp; r &lt;= R) {
            data.<span class="hljs-built_in">apply</span>(s[rt]);
            <span class="hljs-keyword">return</span>;
        }
        s[rt].<span class="hljs-built_in">push_down</span>(s[rt &lt;&lt; <span class="hljs-number">1</span>], s[rt &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span>]);
        <span class="hljs-keyword">int</span> mid = (l + r) &gt;&gt; <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (L &lt;= mid) <span class="hljs-built_in">update</span>(L, R, data, LSON);
        <span class="hljs-keyword">if</span> (R &gt; mid) <span class="hljs-built_in">update</span>(L, R, data, RSON);
        s[rt].<span class="hljs-built_in">push_up</span>(s[rt &lt;&lt; <span class="hljs-number">1</span>], s[rt &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span>]);
    }

    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> TQuery&gt;
    <span class="hljs-function">TQuery <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-keyword">int</span> L, <span class="hljs-keyword">int</span> R, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> rt)</span> </span>{
        <span class="hljs-keyword">if</span> (L &lt;= l &amp;&amp; r &lt;= R) {
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">TQuery</span>(s[rt]);
        }
        s[rt].<span class="hljs-built_in">push_down</span>(s[rt &lt;&lt; <span class="hljs-number">1</span>], s[rt &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span>]);
        <span class="hljs-keyword">int</span> mid = (l + r) &gt;&gt; <span class="hljs-number">1</span>;
        TQuery res;
        <span class="hljs-keyword">if</span> (L &lt;= mid) res.<span class="hljs-built_in">merge_left</span>(query&lt;TQuery&gt;(L, R, LSON));
        <span class="hljs-keyword">if</span> (R &gt; mid) res.<span class="hljs-built_in">merge_right</span>(query&lt;TQuery&gt;(L, R, RSON));
        <span class="hljs-keyword">return</span> res;
    }

<span class="hljs-meta">#<span class="hljs-meta-keyword">undef</span> LSON</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">undef</span> RSON</span>
};
</div></code></pre>
<h3 id="不那么先进的线段树">不那么先进的线段树</h3>
<pre><code class="language-cpp"><div><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> <span class="hljs-keyword">value_t</span>&gt;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">segtree</span> {</span>
   <span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">segtree</span>() {}
    <span class="hljs-built_in">segtree</span>(<span class="hljs-keyword">int</span> cnt) {
        <span class="hljs-keyword">this</span>-&gt;cnt = cnt;
        <span class="hljs-built_in">memset</span>(sum, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> sum);
        <span class="hljs-built_in">memset</span>(lazy, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> lazy);
    }
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> </span>{ <span class="hljs-built_in">build_from_cin</span>(<span class="hljs-number">1</span>, cnt, <span class="hljs-number">1</span>); }
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(<span class="hljs-keyword">value_t</span> *num, <span class="hljs-keyword">int</span> *rnk)</span> </span>{
        <span class="hljs-keyword">this</span>-&gt;num = num;
        <span class="hljs-keyword">this</span>-&gt;rnk = rnk;
        <span class="hljs-built_in">build</span>(<span class="hljs-number">1</span>, cnt, <span class="hljs-number">1</span>);
    }
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">add_range</span><span class="hljs-params">(<span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">value_t</span> val)</span> </span>{ <span class="hljs-built_in">update</span>(l, r, val, <span class="hljs-number">1</span>, cnt, <span class="hljs-number">1</span>); }
    <span class="hljs-function"><span class="hljs-keyword">value_t</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r)</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-built_in">query</span>(l, r, <span class="hljs-number">1</span>, cnt, <span class="hljs-number">1</span>); }

   <span class="hljs-keyword">private</span>:
    <span class="hljs-keyword">value_t</span> lazy[MAXN &lt;&lt; <span class="hljs-number">2</span>];
    <span class="hljs-keyword">value_t</span> sum[MAXN &lt;&lt; <span class="hljs-number">2</span>];
    <span class="hljs-keyword">int</span> cnt;

    <span class="hljs-keyword">value_t</span> *num;
    <span class="hljs-keyword">int</span> *rnk;

<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> lson l, m, rt &lt;&lt; 1</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> rson m + 1, r, rt &lt;&lt; 1 | 1</span>

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">push_up</span><span class="hljs-params">(<span class="hljs-keyword">int</span> rt)</span> </span>{ sum[rt] = sum[rt &lt;&lt; <span class="hljs-number">1</span>] + sum[rt &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span>]; }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">push_down</span><span class="hljs-params">(<span class="hljs-keyword">int</span> rt, <span class="hljs-keyword">int</span> m)</span> </span>{
        <span class="hljs-keyword">if</span> (lazy[rt]) {
            lazy[rt &lt;&lt; <span class="hljs-number">1</span>] += lazy[rt];
            lazy[rt &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span>] += lazy[rt];
            sum[rt &lt;&lt; <span class="hljs-number">1</span>] += (m - (m &gt;&gt; <span class="hljs-number">1</span>)) * lazy[rt];
            sum[rt &lt;&lt; <span class="hljs-number">1</span> | <span class="hljs-number">1</span>] += (m &gt;&gt; <span class="hljs-number">1</span>) * lazy[rt];
            lazy[rt] = <span class="hljs-number">0</span>;
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">build_from_cin</span><span class="hljs-params">(<span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> rt)</span> </span>{
        lazy[rt] = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span> (l == r) {
            cin &gt;&gt; sum[rt];
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">int</span> m = (l + r) &gt;&gt; <span class="hljs-number">1</span>;
        <span class="hljs-built_in">build_from_cin</span>(lson);
        <span class="hljs-built_in">build_from_cin</span>(rson);
        <span class="hljs-built_in">push_up</span>(rt);
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">build</span><span class="hljs-params">(<span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> rt)</span> </span>{
        lazy[rt] = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span> (l == r) {
            sum[rt] = num[rnk[rt]];
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">int</span> m = (l + r) &gt;&gt; <span class="hljs-number">1</span>;
        <span class="hljs-built_in">build</span>(lson);
        <span class="hljs-built_in">build</span>(rson);
        <span class="hljs-built_in">push_up</span>(rt);
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-keyword">int</span> L, <span class="hljs-keyword">int</span> R, <span class="hljs-keyword">value_t</span> c, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> rt)</span> </span>{
        <span class="hljs-keyword">if</span> (L &lt;= l &amp;&amp; R &gt;= r) {
            lazy[rt] += c;
            sum[rt] += (<span class="hljs-keyword">value_t</span>)c * (r - l + <span class="hljs-number">1</span>);
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-built_in">push_down</span>(rt, r - l + <span class="hljs-number">1</span>);
        <span class="hljs-keyword">int</span> m = (l + r) &gt;&gt; <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (L &lt;= m) <span class="hljs-built_in">update</span>(L, R, c, lson);
        <span class="hljs-keyword">if</span> (R &gt; m) <span class="hljs-built_in">update</span>(L, R, c, rson);
        <span class="hljs-built_in">push_up</span>(rt);
    }

    <span class="hljs-function"><span class="hljs-keyword">value_t</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-keyword">int</span> L, <span class="hljs-keyword">int</span> R, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> rt)</span> </span>{
        <span class="hljs-keyword">if</span> (L &lt;= l &amp;&amp; R &gt;= r) <span class="hljs-keyword">return</span> sum[rt];
        <span class="hljs-built_in">push_down</span>(rt, r - l + <span class="hljs-number">1</span>);
        <span class="hljs-keyword">int</span> m = (l + r) &gt;&gt; <span class="hljs-number">1</span>;
        <span class="hljs-keyword">value_t</span> ret = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span> (L &lt;= m) ret += <span class="hljs-built_in">query</span>(L, R, lson);
        <span class="hljs-keyword">if</span> (R &gt; m) ret += <span class="hljs-built_in">query</span>(L, R, rson);
        <span class="hljs-keyword">return</span> ret;
    }

<span class="hljs-meta">#<span class="hljs-meta-keyword">undef</span> lson</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">undef</span> rson</span>
};
</div></code></pre>
<h3 id="st-表">ST 表</h3>
<pre><code class="language-cpp"><div><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-keyword">typename</span> TMerge&gt;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">spharse_table</span> {</span>
   <span class="hljs-keyword">protected</span>:
    T st[MAXN][<span class="hljs-number">22</span>];
    <span class="hljs-comment">// st[i][j]:从i开始,长度为1&lt;&lt;j的区间的最大值</span>
   <span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">spharse_table</span>(<span class="hljs-keyword">int</span> n, <span class="hljs-keyword">const</span> T* a) {
        <span class="hljs-built_in">memset</span>(st, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> st);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) {
            st[i][<span class="hljs-number">0</span>] = a[i];
        }
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; (<span class="hljs-number">1</span> &lt;&lt; j) &lt;= n; j++) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i + (<span class="hljs-number">1</span> &lt;&lt; j) - <span class="hljs-number">1</span> &lt;= n; i++) {
                st[i][j] =
                    <span class="hljs-built_in">TMerge</span>()(st[i][j - <span class="hljs-number">1</span>], st[i + (<span class="hljs-number">1</span> &lt;&lt; (j - <span class="hljs-number">1</span>))][j - <span class="hljs-number">1</span>]);
                <span class="hljs-comment">//递推:每一节的最大值等于前半截和后半截的最大值</span>
            }
        }
    }

    <span class="hljs-function">T <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r)</span> </span>{
        <span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> ((<span class="hljs-number">1</span> &lt;&lt; (k + <span class="hljs-number">1</span>)) &lt;= r - l + <span class="hljs-number">1</span>) {
            k++;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">TMerge</span>()(st[l][k], st[r - (<span class="hljs-number">1</span> &lt;&lt; k) + <span class="hljs-number">1</span>][k]);
        <span class="hljs-comment">//前后等长两节区间,区间可重复</span>
    }
};
</div></code></pre>
<h3 id="splay">Splay</h3>
<pre><code class="language-cpp"><div><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">splay_seq</span> {</span>
   <span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">splay_seq</span>(<span class="hljs-keyword">int</span> n = <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) {
            <span class="hljs-built_in">insert</span>(root, i, i);
            <span class="hljs-built_in">splay</span>(root, i);
        }
    }
    <span class="hljs-built_in">splay_seq</span>(vector&lt;T&gt;&amp; vec) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; vec.<span class="hljs-built_in">size</span>(); i++) {
            <span class="hljs-built_in">insert</span>(root, i + <span class="hljs-number">1</span>, vec[i]);
            <span class="hljs-built_in">splay</span>(root, i + <span class="hljs-number">1</span>);
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dispose</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (root != <span class="hljs-literal">nullptr</span>) {
            <span class="hljs-comment">// clog &lt;&lt; &quot;Disposed!&quot; &lt;&lt; endl;</span>
            root-&gt;<span class="hljs-built_in">dispose</span>();
            <span class="hljs-keyword">delete</span> root;
        }
        root = <span class="hljs-literal">nullptr</span>;
    }
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">append</span><span class="hljs-params">(T val)</span> </span>{
        <span class="hljs-built_in">insert</span>(root, <span class="hljs-built_in">size</span>() + <span class="hljs-number">1</span>, val);
        <span class="hljs-built_in">splay</span>(root, <span class="hljs-built_in">size</span>());
    }
    <span class="hljs-function"><span class="hljs-keyword">size_t</span> <span class="hljs-title">size</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> (root == <span class="hljs-literal">nullptr</span>) ? <span class="hljs-number">0</span> : root-&gt;size; }
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">merge</span><span class="hljs-params">(splay_seq&amp; right)</span> </span>{
        <span class="hljs-keyword">if</span> (root == <span class="hljs-literal">nullptr</span>) {
            root = right.root;
            right.root = <span class="hljs-literal">nullptr</span>;
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-built_in">splay</span>(root, <span class="hljs-built_in">size</span>());
        root-&gt;ch[<span class="hljs-number">1</span>] = right.root;
        root-&gt;<span class="hljs-built_in">maintain</span>();
        right.root = <span class="hljs-literal">nullptr</span>;
    }
    <span class="hljs-function">splay_seq <span class="hljs-title">split</span><span class="hljs-params">(<span class="hljs-keyword">int</span> k)</span> </span>{
        <span class="hljs-keyword">if</span> (k &gt; <span class="hljs-built_in">size</span>()) <span class="hljs-keyword">return</span> <span class="hljs-built_in">splay_seq</span>();
        <span class="hljs-keyword">if</span> (k == <span class="hljs-number">0</span>) {
            <span class="hljs-function">splay_seq <span class="hljs-title">r</span><span class="hljs-params">(root)</span></span>;
            root = <span class="hljs-literal">nullptr</span>;
            <span class="hljs-keyword">return</span> r;
        }
        <span class="hljs-built_in">splay</span>(root, k);
        <span class="hljs-function">splay_seq <span class="hljs-title">r</span><span class="hljs-params">(root-&gt;ch[<span class="hljs-number">1</span>])</span></span>;
        root-&gt;ch[<span class="hljs-number">1</span>] = <span class="hljs-literal">nullptr</span>;
        root-&gt;<span class="hljs-built_in">maintain</span>();
        <span class="hljs-keyword">return</span> r;
    }
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">flip</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (root != <span class="hljs-literal">nullptr</span>) root-&gt;flip = !root-&gt;flip;
    }
    <span class="hljs-function">vector&lt;T&gt; <span class="hljs-title">to_vec</span><span class="hljs-params">()</span> </span>{
        vector&lt;T&gt; ret;
        <span class="hljs-built_in">to_vec</span>(root, ret);
        <span class="hljs-keyword">return</span> ret;
    }

   <span class="hljs-keyword">protected</span>:
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span> {</span>
        node* ch[<span class="hljs-number">2</span>];
        <span class="hljs-keyword">int</span> id;
        T val;
        <span class="hljs-keyword">int</span> size = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">bool</span> flip = <span class="hljs-literal">false</span>;
        <span class="hljs-built_in">node</span>(<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> ID = <span class="hljs-number">0</span>, <span class="hljs-keyword">const</span> T&amp; v = <span class="hljs-number">0</span>) : <span class="hljs-built_in">id</span>(ID), <span class="hljs-built_in">val</span>(v) {
            ch[<span class="hljs-number">0</span>] = ch[<span class="hljs-number">1</span>] = <span class="hljs-literal">nullptr</span>;
        }
        <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">where</span><span class="hljs-params">(<span class="hljs-keyword">int</span> k)</span> </span>{
            <span class="hljs-keyword">int</span> rsize = k - ((ch[<span class="hljs-number">0</span>] == <span class="hljs-literal">nullptr</span>) ? <span class="hljs-number">0</span> : ch[<span class="hljs-number">0</span>]-&gt;size);
            <span class="hljs-keyword">if</span> (rsize == <span class="hljs-number">1</span>)
                <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
            <span class="hljs-keyword">else</span>
                <span class="hljs-keyword">return</span> rsize &gt; <span class="hljs-number">0</span>;
        }
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">maintain</span><span class="hljs-params">()</span> </span>{
            size = <span class="hljs-number">1</span>;
            <span class="hljs-keyword">if</span> (ch[<span class="hljs-number">0</span>] != <span class="hljs-literal">nullptr</span>) size += ch[<span class="hljs-number">0</span>]-&gt;size;
            <span class="hljs-keyword">if</span> (ch[<span class="hljs-number">1</span>] != <span class="hljs-literal">nullptr</span>) size += ch[<span class="hljs-number">1</span>]-&gt;size;
        }
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">pushdown</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">if</span> (flip) {
                <span class="hljs-comment">// clog &lt;&lt; &quot;Push down &quot; &lt;&lt; id &lt;&lt; endl;</span>
                <span class="hljs-built_in">swap</span>(ch[<span class="hljs-number">0</span>], ch[<span class="hljs-number">1</span>]);
                <span class="hljs-keyword">if</span> (ch[<span class="hljs-number">0</span>] != <span class="hljs-literal">nullptr</span>) ch[<span class="hljs-number">0</span>]-&gt;flip = !ch[<span class="hljs-number">0</span>]-&gt;flip;
                <span class="hljs-keyword">if</span> (ch[<span class="hljs-number">1</span>] != <span class="hljs-literal">nullptr</span>) ch[<span class="hljs-number">1</span>]-&gt;flip = !ch[<span class="hljs-number">1</span>]-&gt;flip;
                flip = <span class="hljs-literal">false</span>;
            }
        }
        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dispose</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">if</span> (ch[<span class="hljs-number">0</span>] != <span class="hljs-literal">nullptr</span>) {
                ch[<span class="hljs-number">0</span>]-&gt;<span class="hljs-built_in">dispose</span>();
                <span class="hljs-keyword">delete</span> ch[<span class="hljs-number">0</span>];
                ch[<span class="hljs-number">0</span>] = <span class="hljs-literal">nullptr</span>;
            }
            <span class="hljs-keyword">if</span> (ch[<span class="hljs-number">1</span>] != <span class="hljs-literal">nullptr</span>) {
                ch[<span class="hljs-number">1</span>]-&gt;<span class="hljs-built_in">dispose</span>();
                <span class="hljs-keyword">delete</span> ch[<span class="hljs-number">1</span>];
                ch[<span class="hljs-number">1</span>] = <span class="hljs-literal">nullptr</span>;
            }
        }
    };
    <span class="hljs-built_in">splay_seq</span>(node* n) { root = n; }
    node* root = <span class="hljs-literal">nullptr</span>;

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">nodesiz</span><span class="hljs-params">(node* n)</span> </span>{ <span class="hljs-keyword">return</span> n == <span class="hljs-literal">nullptr</span> ? <span class="hljs-number">0</span> : n-&gt;size; }

    <span class="hljs-comment">// d = 0 : 左， d = 1 : 右</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">rotate</span><span class="hljs-params">(node*&amp; rt, <span class="hljs-keyword">int</span> d)</span> </span>{
        node* nr = rt-&gt;ch[d ^ <span class="hljs-number">1</span>];
        nr-&gt;<span class="hljs-built_in">pushdown</span>();
        rt-&gt;ch[d ^ <span class="hljs-number">1</span>] = nr-&gt;ch[d];
        nr-&gt;ch[d] = rt;
        rt-&gt;<span class="hljs-built_in">maintain</span>();
        nr-&gt;<span class="hljs-built_in">maintain</span>();
        rt = nr;
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insert</span><span class="hljs-params">(node*&amp; rt, <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span>&amp; id, <span class="hljs-keyword">const</span> T&amp; val)</span> </span>{
        <span class="hljs-keyword">if</span> (rt == <span class="hljs-literal">nullptr</span>)
            rt = <span class="hljs-keyword">new</span> <span class="hljs-built_in">node</span>(id, val);
        <span class="hljs-keyword">else</span>
            <span class="hljs-built_in">insert</span>(rt-&gt;ch[id &gt; rt-&gt;id], id, val);
        rt-&gt;<span class="hljs-built_in">maintain</span>();
    }

    <span class="hljs-comment">// 把子树中排名为k的旋转到根</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">splay</span><span class="hljs-params">(node*&amp; rt, <span class="hljs-keyword">int</span> k)</span> </span>{
        <span class="hljs-keyword">if</span> (rt == <span class="hljs-literal">nullptr</span>) <span class="hljs-keyword">return</span>;
        rt-&gt;<span class="hljs-built_in">pushdown</span>();
        <span class="hljs-keyword">int</span> d = rt-&gt;<span class="hljs-built_in">where</span>(k);
        <span class="hljs-keyword">if</span> (d == <span class="hljs-number">1</span>) k -= <span class="hljs-built_in">nodesiz</span>(rt-&gt;ch[<span class="hljs-number">0</span>]) + <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (d != <span class="hljs-number">-1</span>) {
            rt-&gt;ch[d]-&gt;<span class="hljs-built_in">pushdown</span>();
            <span class="hljs-keyword">int</span> d2 = rt-&gt;ch[d]-&gt;<span class="hljs-built_in">where</span>(k);
            <span class="hljs-keyword">int</span> k2 = (d2 == <span class="hljs-number">0</span> ? k : k - <span class="hljs-built_in">nodesiz</span>(rt-&gt;ch[d]-&gt;ch[<span class="hljs-number">0</span>]) - <span class="hljs-number">1</span>);
            <span class="hljs-keyword">if</span> (d2 != <span class="hljs-number">-1</span>) {
                <span class="hljs-built_in">splay</span>(rt-&gt;ch[d]-&gt;ch[d2], k2);
                <span class="hljs-keyword">if</span> (d == d2)
                    <span class="hljs-built_in">rotate</span>(rt, d ^ <span class="hljs-number">1</span>);
                <span class="hljs-keyword">else</span>
                    <span class="hljs-built_in">rotate</span>(rt-&gt;ch[d], d);
            }
            <span class="hljs-built_in">rotate</span>(rt, d ^ <span class="hljs-number">1</span>);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">to_vec</span><span class="hljs-params">(node* rt, vector&lt;T&gt;&amp; vec)</span> </span>{
        <span class="hljs-keyword">if</span> (rt != <span class="hljs-literal">nullptr</span>) {
            rt-&gt;<span class="hljs-built_in">pushdown</span>();
            <span class="hljs-built_in">to_vec</span>(rt-&gt;ch[<span class="hljs-number">0</span>], vec);
            vec.<span class="hljs-built_in">push_back</span>(rt-&gt;val);
            <span class="hljs-built_in">to_vec</span>(rt-&gt;ch[<span class="hljs-number">1</span>], vec);
        }
    }

   <span class="hljs-keyword">private</span>:
    splay_seq&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-keyword">const</span> splay_seq&amp; s) = <span class="hljs-keyword">delete</span>;
};
</div></code></pre>
<h3 id="树链剖分">树链剖分</h3>
<pre><code class="language-cpp"><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">tls</span> :</span> <span class="hljs-keyword">public</span> lfs {
   <span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">tls</span>(<span class="hljs-keyword">int</span> n, <span class="hljs-keyword">int</span> root = <span class="hljs-number">1</span>)
        : <span class="hljs-built_in">lfs</span>(n, (n - <span class="hljs-number">1</span>) * <span class="hljs-number">2</span>),
          <span class="hljs-built_in">root</span>(root),
          <span class="hljs-built_in">tree</span>(<span class="hljs-number">1</span>),
          <span class="hljs-built_in">size</span>(n + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),
          <span class="hljs-built_in">top</span>(n + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),
          <span class="hljs-built_in">son</span>(n + <span class="hljs-number">1</span>, <span class="hljs-number">-1</span>),
          <span class="hljs-built_in">dep</span>(n + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),
          <span class="hljs-built_in">tid</span>(n + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),
          <span class="hljs-built_in">rnk</span>(n + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),
          <span class="hljs-built_in">fa</span>(n + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>) {}

    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> TBaseData&gt;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(TBaseData* num)</span> </span>{
        <span class="hljs-built_in">dfs1</span>(root, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        <span class="hljs-built_in">dfs2</span>(root, root);
        <span class="hljs-function">vector&lt;TBaseData&gt; <span class="hljs-title">data</span><span class="hljs-params">(n + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>)</span></span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) {
            data[i] = num[rnk[i]];
        }
        tree = <span class="hljs-built_in">segtree</span>(n, data.<span class="hljs-built_in">data</span>());
    }

    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> TUpdate&gt;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y, <span class="hljs-keyword">const</span> TUpdate&amp; data)</span> </span>{
        <span class="hljs-keyword">while</span> (top[x] != top[y]) {
            <span class="hljs-keyword">if</span> (dep[top[x]] &lt; dep[top[y]]) <span class="hljs-built_in">swap</span>(x, y);
            tree.<span class="hljs-built_in">update</span>(tid[top[x]], tid[x], data);
            x = fa[top[x]];
        }
        <span class="hljs-keyword">if</span> (dep[x] &gt; dep[y]) <span class="hljs-built_in">swap</span>(x, y);
        tree.<span class="hljs-built_in">update</span>(tid[x], tid[y], data);
    }

    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> TQuery&gt;
    <span class="hljs-function">TQuery <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>{
        <span class="hljs-keyword">return</span> tree.query&lt;TQuery&gt;(tid[x], tid[x]);
    }

    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> TQuery&gt;
    <span class="hljs-function">TQuery <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>{
        TQuery x_to_lca;
        TQuery lca_to_y;
        <span class="hljs-keyword">while</span> (top[x] != top[y]) {
            <span class="hljs-keyword">if</span> (dep[top[x]] &gt;= dep[top[y]]) {
                TQuery seg = tree.query&lt;TQuery&gt;(tid[top[x]], tid[x]);
                seg.<span class="hljs-built_in">flip</span>();
                x_to_lca.<span class="hljs-built_in">merge_right</span>(seg);
                x = fa[top[x]];
            } <span class="hljs-keyword">else</span> {
                TQuery seg = tree.query&lt;TQuery&gt;(tid[top[y]], tid[y]);
                lca_to_y.<span class="hljs-built_in">merge_left</span>(seg);
                y = fa[top[y]];
            }
        }
        <span class="hljs-keyword">if</span> (dep[x] &gt;= dep[y]) {
            TQuery seg = tree.query&lt;TQuery&gt;(tid[y], tid[x]);
            seg.<span class="hljs-built_in">flip</span>();
            x_to_lca.<span class="hljs-built_in">merge_right</span>(seg);
            x_to_lca.<span class="hljs-built_in">merge_right</span>(lca_to_y);
            <span class="hljs-keyword">return</span> x_to_lca;
        } <span class="hljs-keyword">else</span> {
            TQuery seg = tree.query&lt;TQuery&gt;(tid[x], tid[y]);
            x_to_lca.<span class="hljs-built_in">merge_right</span>(seg);
            x_to_lca.<span class="hljs-built_in">merge_right</span>(lca_to_y);
            <span class="hljs-keyword">return</span> x_to_lca;
        }
    }

    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> TUpdate&gt;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">update_subtree</span><span class="hljs-params">(<span class="hljs-keyword">int</span> u, <span class="hljs-keyword">const</span> TUpdate&amp; data)</span> </span>{
        tree.<span class="hljs-built_in">update</span>(tid[u], tid[u] + size[u] - <span class="hljs-number">1</span>, data);
    }

    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> TQuery&gt;
    <span class="hljs-function">TQuery <span class="hljs-title">query_subtree</span><span class="hljs-params">(<span class="hljs-keyword">int</span> u)</span> </span>{
        <span class="hljs-keyword">return</span> tree.query&lt;TQuery&gt;(tid[u], tid[u] + size[u] - <span class="hljs-number">1</span>);
    }

   <span class="hljs-keyword">private</span>:
    <span class="hljs-keyword">int</span> root;
    segtree tree;
    <span class="hljs-keyword">int</span> tim = <span class="hljs-number">0</span>;
    vector&lt;<span class="hljs-keyword">int</span>&gt; size, top, son, dep, tid, rnk, fa;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dfs1</span><span class="hljs-params">(<span class="hljs-keyword">int</span> u, <span class="hljs-keyword">int</span> fa, <span class="hljs-keyword">int</span> d)</span> </span>{
        dep[u] = d;
        <span class="hljs-keyword">this</span>-&gt;fa[u] = fa;
        size[u] = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = head[u]; i != <span class="hljs-number">-1</span>; i = e[i].next) {
            <span class="hljs-keyword">int</span> v = e[i].to;
            <span class="hljs-keyword">if</span> (v != fa) {
                <span class="hljs-built_in">dfs1</span>(v, u, d + <span class="hljs-number">1</span>);
                size[u] += size[v];
                <span class="hljs-keyword">if</span> (son[u] == <span class="hljs-number">-1</span> || size[v] &gt; size[son[u]]) son[u] = v;
            }
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dfs2</span><span class="hljs-params">(<span class="hljs-keyword">int</span> u, <span class="hljs-keyword">int</span> tp)</span> </span>{
        top[u] = tp;
        tid[u] = ++tim;
        rnk[tid[u]] = u;
        <span class="hljs-keyword">if</span> (son[u] == <span class="hljs-number">-1</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-built_in">dfs2</span>(son[u], tp);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = head[u]; i != <span class="hljs-number">-1</span>; i = e[i].next) {
            <span class="hljs-keyword">int</span> v = e[i].to;
            <span class="hljs-keyword">if</span> (v != son[u] &amp;&amp; v != fa[u]) <span class="hljs-built_in">dfs2</span>(v, v);
        }
    }
};
</div></code></pre>
<h3 id="treap">Treap</h3>
<pre><code class="language-cpp"><div><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-keyword">bool</span> is_multi = <span class="hljs-literal">false</span>, T INF = <span class="hljs-number">0x3f3f3f3f</span>&gt;
class treap {
   <span class="hljs-keyword">protected</span>:
    struct node {
        node* ch[<span class="hljs-number">2</span>];
        <span class="hljs-keyword">int</span> r, s;
        T val;
        <span class="hljs-keyword">int</span> count = <span class="hljs-number">1</span>; 
        <span class="hljs-comment">//返回新节点应该放在那棵子树里</span>
        <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">where</span><span class="hljs-params">(T x)</span> </span>{
            <span class="hljs-keyword">if</span>(is_multi){
                <span class="hljs-keyword">return</span> x &lt; val ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span> (x == val) {
                    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">return</span> x &lt; val ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>;
                }
            }
        }

        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">mt</span><span class="hljs-params">()</span> </span>{
            s = count;
            <span class="hljs-keyword">if</span> (ch[<span class="hljs-number">0</span>] != <span class="hljs-literal">nullptr</span>) {
                s += ch[<span class="hljs-number">0</span>]-&gt;s;
            }
            <span class="hljs-keyword">if</span> (ch[<span class="hljs-number">1</span>] != <span class="hljs-literal">nullptr</span>) {
                s += ch[<span class="hljs-number">1</span>]-&gt;s;
            }
        }

        <span class="hljs-built_in">node</span>() { ch[<span class="hljs-number">0</span>] = ch[<span class="hljs-number">1</span>] = <span class="hljs-literal">nullptr</span>; }

        <span class="hljs-built_in">node</span>(T x) {
            ch[<span class="hljs-number">0</span>] = ch[<span class="hljs-number">1</span>] = <span class="hljs-literal">nullptr</span>;
            val = x;
            r = <span class="hljs-built_in">rand</span>();
        }

        <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dispose</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">if</span> (ch[<span class="hljs-number">0</span>] != <span class="hljs-literal">nullptr</span>) {
                ch[<span class="hljs-number">0</span>]-&gt;<span class="hljs-built_in">dispose</span>();
                <span class="hljs-keyword">delete</span> ch[<span class="hljs-number">0</span>];
                ch[<span class="hljs-number">0</span>] = <span class="hljs-literal">nullptr</span>;
            }
            <span class="hljs-keyword">if</span> (ch[<span class="hljs-number">1</span>] != <span class="hljs-literal">nullptr</span>) {
                ch[<span class="hljs-number">1</span>]-&gt;<span class="hljs-built_in">dispose</span>();
                <span class="hljs-keyword">delete</span> ch[<span class="hljs-number">1</span>];
                ch[<span class="hljs-number">1</span>] = <span class="hljs-literal">nullptr</span>;
            }
        }
    };

    node* root;
    <span class="hljs-keyword">int</span> cnt;
    <span class="hljs-comment">// d=0:left,d=1:right</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">rotate</span><span class="hljs-params">(node*&amp; rt, <span class="hljs-keyword">int</span> d)</span> </span>{
        node* nr = rt-&gt;ch[d ^ <span class="hljs-number">1</span>];
        rt-&gt;ch[d ^ <span class="hljs-number">1</span>] = nr-&gt;ch[d];
        nr-&gt;ch[d] = rt;
        rt-&gt;<span class="hljs-built_in">mt</span>();
        nr-&gt;<span class="hljs-built_in">mt</span>();
        rt = nr;
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insert</span><span class="hljs-params">(node*&amp; rt, T x)</span> </span>{
        <span class="hljs-keyword">if</span> (rt == <span class="hljs-literal">nullptr</span>) {
            rt = <span class="hljs-keyword">new</span> <span class="hljs-built_in">node</span>(x);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rt-&gt;val == x) {
        	rt-&gt;count++;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">int</span> d = rt-&gt;<span class="hljs-built_in">where</span>(x);
            <span class="hljs-built_in">insert</span>(rt-&gt;ch[d], x);
            <span class="hljs-keyword">if</span> (rt-&gt;ch[d]-&gt;r &gt; rt-&gt;r) {
                <span class="hljs-built_in">rotate</span>(rt, d ^ <span class="hljs-number">1</span>);
            }
        }
        rt-&gt;<span class="hljs-built_in">mt</span>();
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">remove</span><span class="hljs-params">(node*&amp; rt, T x)</span> </span>{
        <span class="hljs-keyword">int</span> d = rt-&gt;<span class="hljs-built_in">where</span>(x);
        node* u = rt;
        <span class="hljs-keyword">if</span> (rt-&gt;val != x) {
            <span class="hljs-built_in">remove</span>(rt-&gt;ch[d], x);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rt-&gt;count &gt; <span class="hljs-number">1</span>) {
        	rt-&gt;count--;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rt-&gt;ch[<span class="hljs-number">0</span>] == <span class="hljs-literal">nullptr</span>) {
            rt = rt-&gt;ch[<span class="hljs-number">1</span>];
            <span class="hljs-keyword">delete</span> u;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rt-&gt;ch[<span class="hljs-number">1</span>] == <span class="hljs-literal">nullptr</span>) {
            rt = rt-&gt;ch[<span class="hljs-number">0</span>];
            <span class="hljs-keyword">delete</span> u;
        } <span class="hljs-keyword">else</span> {
            d = (rt-&gt;ch[<span class="hljs-number">0</span>]-&gt;r &gt; rt-&gt;ch[<span class="hljs-number">1</span>]-&gt;r) ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>;
            <span class="hljs-built_in">rotate</span>(rt, d);
            <span class="hljs-built_in">remove</span>(rt-&gt;ch[d], x);
        }
        <span class="hljs-keyword">if</span> (rt != <span class="hljs-literal">nullptr</span>) {
            rt-&gt;<span class="hljs-built_in">mt</span>();
        }
    }

    <span class="hljs-function">node* <span class="hljs-title">find</span><span class="hljs-params">(node* rt, T x)</span> </span>{
        <span class="hljs-keyword">while</span> (rt != <span class="hljs-literal">nullptr</span>) {
            <span class="hljs-keyword">int</span> d = rt-&gt;<span class="hljs-built_in">where</span>(x);
            <span class="hljs-keyword">if</span> (rt-&gt;val == x) {
                <span class="hljs-keyword">return</span> rt;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-built_in">assert</span>(rt != rt-&gt;ch[d]);
                rt = rt-&gt;ch[d];
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;
    }

    <span class="hljs-function">T <span class="hljs-title">kth</span><span class="hljs-params">(node* rt, <span class="hljs-keyword">int</span> k)</span> </span>{
        <span class="hljs-keyword">if</span> (rt == <span class="hljs-literal">nullptr</span> || k &lt; <span class="hljs-number">0</span> || k &gt; rt-&gt;s) {
            <span class="hljs-comment">// clog &lt;&lt; &quot;Oops!&quot; &lt;&lt; endl;</span>
            <span class="hljs-keyword">return</span> INF;
        }
        <span class="hljs-keyword">int</span> s = (rt-&gt;ch[<span class="hljs-number">0</span>] == <span class="hljs-literal">nullptr</span>) ? <span class="hljs-number">0</span> : rt-&gt;ch[<span class="hljs-number">0</span>]-&gt;s;
        <span class="hljs-keyword">if</span> (k &gt;= s + <span class="hljs-number">1</span> &amp;&amp; k &lt;= s + rt-&gt;count) {
            <span class="hljs-keyword">return</span> rt-&gt;val;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (k &lt;= s) {
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">kth</span>(rt-&gt;ch[<span class="hljs-number">0</span>], k);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">kth</span>(rt-&gt;ch[<span class="hljs-number">1</span>], k - s - rt-&gt;count);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">rank</span><span class="hljs-params">(node* rt, T x)</span> </span>{
        <span class="hljs-keyword">int</span> s = (rt-&gt;ch[<span class="hljs-number">0</span>] == <span class="hljs-literal">nullptr</span>) ? <span class="hljs-number">0</span> : rt-&gt;ch[<span class="hljs-number">0</span>]-&gt;s;
        <span class="hljs-keyword">if</span> (rt-&gt;val == x) {
            <span class="hljs-keyword">return</span> s + <span class="hljs-number">1</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rt-&gt;val &gt; x) {
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">rank</span>(rt-&gt;ch[<span class="hljs-number">0</span>], x);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">rank</span>(rt-&gt;ch[<span class="hljs-number">1</span>], x) + s + rt-&gt;count;
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">prev</span><span class="hljs-params">(node* rt, T x, T&amp; result)</span> </span>{
        <span class="hljs-keyword">if</span> (rt == <span class="hljs-literal">nullptr</span>) {
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">if</span> (rt-&gt;val &lt; x) {
            result = <span class="hljs-built_in">max</span>(result, rt-&gt;val);
            <span class="hljs-built_in">prev</span>(rt-&gt;ch[<span class="hljs-number">1</span>], x, result);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-built_in">prev</span>(rt-&gt;ch[<span class="hljs-number">0</span>], x, result);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">succ</span><span class="hljs-params">(node* rt, T x, T&amp; result)</span> </span>{
        <span class="hljs-keyword">if</span> (rt == <span class="hljs-literal">nullptr</span>) {
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">if</span> (rt-&gt;val &gt; x) {
            result = <span class="hljs-built_in">min</span>(result, rt-&gt;val);
            <span class="hljs-built_in">succ</span>(rt-&gt;ch[<span class="hljs-number">0</span>], x, result);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-built_in">succ</span>(rt-&gt;ch[<span class="hljs-number">1</span>], x, result);
        }
    }

   <span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">treap</span>() {
        root = <span class="hljs-literal">nullptr</span>;
        cnt = <span class="hljs-number">0</span>;
    }

    ~<span class="hljs-built_in">treap</span>() {
        <span class="hljs-keyword">if</span> (root != <span class="hljs-literal">nullptr</span>) {
            root-&gt;<span class="hljs-built_in">dispose</span>();
        }
        <span class="hljs-keyword">delete</span> root;
        root = <span class="hljs-literal">nullptr</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">insert</span><span class="hljs-params">(T x)</span> </span>{
        <span class="hljs-keyword">if</span> (!is_multi) {
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">find</span>(root, x) != <span class="hljs-literal">nullptr</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
        }
        cnt++;
        <span class="hljs-built_in">insert</span>(root, x);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">erase</span><span class="hljs-params">(T x)</span> </span>{
        node* cur = <span class="hljs-built_in">find</span>(root, x);
        <span class="hljs-keyword">if</span> (cur != <span class="hljs-literal">nullptr</span>) {
            cnt--;
            <span class="hljs-built_in">remove</span>(root, x);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">find</span><span class="hljs-params">(T x)</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-built_in">find</span>(root, x) != <span class="hljs-literal">nullptr</span>; }

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">size</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> cnt; }

    <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">empty</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> cnt == <span class="hljs-number">0</span>; }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (root != <span class="hljs-literal">nullptr</span>) {
            root-&gt;<span class="hljs-built_in">dispose</span>();
        }
        <span class="hljs-keyword">delete</span> root;
        root = <span class="hljs-literal">nullptr</span>;
        cnt = <span class="hljs-number">0</span>;
    }

    <span class="hljs-function">T <span class="hljs-title">kth</span><span class="hljs-params">(<span class="hljs-keyword">int</span> k)</span> </span>{
        <span class="hljs-keyword">if</span> (k &gt; cnt) {
            <span class="hljs-keyword">return</span> INF;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">kth</span>(root, k);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">rank</span><span class="hljs-params">(T x)</span> </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">find</span>(root, x) == <span class="hljs-literal">nullptr</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">rank</span>(root, x);
    }

    <span class="hljs-function">T <span class="hljs-title">succ</span><span class="hljs-params">(T x)</span></span>{
        T result = INF;
        <span class="hljs-built_in">succ</span>(root, x, result);
        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-function">T <span class="hljs-title">prev</span><span class="hljs-params">(T x)</span></span>{
        T result = -INF;
        <span class="hljs-built_in">prev</span>(root, x, result);
        <span class="hljs-keyword">return</span> result;
    }
};
</div></code></pre>
<h2 id="图论">图论</h2>
<h3 id="边双连通分量与染色">边双连通分量与染色</h3>
<pre><code class="language-cpp"><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">bcc</span> :</span> <span class="hljs-keyword">public</span> lfs {
   <span class="hljs-keyword">protected</span>:
    <span class="hljs-keyword">int</span> dfn[MAXN];
    <span class="hljs-keyword">int</span> low[MAXN];
    <span class="hljs-keyword">int</span> tim;
    <span class="hljs-keyword">int</span> color[MAXN];  <span class="hljs-comment">//  处理bcc数组时防重复用</span>
    stack&lt;pair&lt;<span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>&gt;&gt; s;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-keyword">int</span> u, <span class="hljs-keyword">int</span> fa)</span> </span>{
        dfn[u] = low[u] = ++tim;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = head[u]; i != <span class="hljs-number">-1</span>; i = e[i].next) {
            <span class="hljs-keyword">int</span> v = e[i].to;
            <span class="hljs-keyword">if</span> (v == fa) <span class="hljs-keyword">continue</span>;
            <span class="hljs-keyword">if</span> (dfn[v] == <span class="hljs-number">0</span>) {
                s.<span class="hljs-built_in">push</span>(<span class="hljs-built_in">make_pair</span>(u, v));
                <span class="hljs-built_in">dfs</span>(v, u);
                low[u] = <span class="hljs-built_in">min</span>(low[u], low[v]);
                <span class="hljs-keyword">if</span> (low[v] &gt;= dfn[u]) {
                    vector&lt;<span class="hljs-keyword">int</span>&gt; cur;
                    bcccnt++;
                    pair&lt;<span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>&gt; now;
                    <span class="hljs-keyword">do</span> {
                        now = s.<span class="hljs-built_in">top</span>();
                        s.<span class="hljs-built_in">pop</span>();
                        <span class="hljs-keyword">if</span> (color[now.first] != bcccnt) {
                            cur.<span class="hljs-built_in">push_back</span>(now.first);
                            color[now.first] = bcccnt;
                            belong[now.first].<span class="hljs-built_in">push_back</span>(bcccnt);
                        }
                        <span class="hljs-keyword">if</span> (color[now.second] != bcccnt) {
                            cur.<span class="hljs-built_in">push_back</span>(now.second);
                            color[now.second] = bcccnt;
                            belong[now.second].<span class="hljs-built_in">push_back</span>(bcccnt);
                        }
                    } <span class="hljs-keyword">while</span> (!(now.first == u &amp;&amp; now.second == v));
                    bccs.<span class="hljs-built_in">push_back</span>(cur);
                }
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dfn[v] &lt; dfn[u]) {
                s.<span class="hljs-built_in">push</span>(<span class="hljs-built_in">make_pair</span>(u, v));
                low[u] = <span class="hljs-built_in">min</span>(low[u], dfn[v]);
            }
        }
    }

   <span class="hljs-keyword">public</span>:
    vector&lt;<span class="hljs-keyword">int</span>&gt; belong[MAXN];
    <span class="hljs-keyword">int</span> bcccnt;
    vector&lt;vector&lt;<span class="hljs-keyword">int</span>&gt;&gt; bccs;

    <span class="hljs-built_in">bcc</span>(<span class="hljs-keyword">int</span> n) : <span class="hljs-built_in">lfs</span>(n) {
        <span class="hljs-built_in">memset</span>(dfn, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> dfn);
        <span class="hljs-built_in">memset</span>(low, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> low);
        <span class="hljs-built_in">memset</span>(color, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> color);
        tim = bcccnt = <span class="hljs-number">0</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">pre</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) {
            <span class="hljs-keyword">if</span> (dfn[i] == <span class="hljs-number">0</span>) <span class="hljs-built_in">dfs</span>(i, <span class="hljs-number">-1</span>);
        }
    }
};
</div></code></pre>
<h3 id="点双连通分量和割点">点双连通分量和割点</h3>
<pre><code class="language-cpp"><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">cut_vertex</span> :</span> <span class="hljs-keyword">public</span> lfs {
   <span class="hljs-keyword">protected</span>:
    <span class="hljs-keyword">int</span> dfn[MAXN], low[MAXN];
    <span class="hljs-keyword">int</span> tim;
    <span class="hljs-keyword">int</span> scc_count = <span class="hljs-number">0</span>;
    stack&lt;<span class="hljs-keyword">int</span>&gt; s;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">tarjan</span><span class="hljs-params">(<span class="hljs-keyword">int</span> u, <span class="hljs-keyword">int</span> fa)</span> </span>{
        s.<span class="hljs-built_in">push</span>(u);
        <span class="hljs-keyword">int</span> cc = <span class="hljs-number">0</span>;
        dfn[u] = low[u] = tim++;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = head[u]; i != <span class="hljs-number">-1</span>; i = e[i].next) {
            <span class="hljs-keyword">int</span> v = e[i].to;
            <span class="hljs-keyword">if</span> (dfn[v] == <span class="hljs-number">-1</span>) {
                <span class="hljs-built_in">tarjan</span>(v, u);
                low[u] = <span class="hljs-built_in">min</span>(low[u], low[v]);
                <span class="hljs-keyword">if</span> (low[v] &gt;= dfn[u]) {
                    cc++;
                    <span class="hljs-keyword">if</span> (fa != <span class="hljs-number">-1</span> || cc &gt; <span class="hljs-number">1</span>) {
                        is_cut_vertex[u] = <span class="hljs-literal">true</span>;
                    }
                    scc_count++;
                    <span class="hljs-keyword">while</span> (!s.<span class="hljs-built_in">empty</span>()) {
                        <span class="hljs-keyword">int</span> cur = s.<span class="hljs-built_in">top</span>();
                        s.<span class="hljs-built_in">pop</span>();
                        belong_to[cur].<span class="hljs-built_in">push_back</span>(scc_count);
                        <span class="hljs-keyword">if</span> (cur == v) <span class="hljs-keyword">break</span>;
                    }
                    belong_to[u].<span class="hljs-built_in">push_back</span>(scc_count);
                }
            } <span class="hljs-keyword">else</span> {
                low[u] = <span class="hljs-built_in">min</span>(low[u], dfn[v]);
            }
        }
    }

   <span class="hljs-keyword">public</span>:
    vector&lt;<span class="hljs-keyword">int</span>&gt; belong_to[MAXN];
    <span class="hljs-keyword">bool</span> is_cut_vertex[MAXN];
    <span class="hljs-built_in">cut_vertex</span>(<span class="hljs-keyword">int</span> n) : <span class="hljs-built_in">lfs</span>(n) {}

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">pre</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-built_in">memset</span>(dfn, <span class="hljs-number">-1</span>, <span class="hljs-keyword">sizeof</span> dfn);
        <span class="hljs-built_in">memset</span>(is_cut_vertex, <span class="hljs-literal">false</span>, <span class="hljs-keyword">sizeof</span> is_cut_vertex);
        tim = <span class="hljs-number">1</span>;

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) {
            <span class="hljs-keyword">if</span> (dfn[i] == <span class="hljs-number">-1</span>) {
                <span class="hljs-built_in">tarjan</span>(i, <span class="hljs-number">-1</span>);
            }
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">shrink_point</span><span class="hljs-params">(lfs* graph, vector&lt;<span class="hljs-keyword">int</span>&gt;&amp; mapping)</span> </span>{
        mapping = vector&lt;<span class="hljs-keyword">int</span>&gt;(n + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);
        <span class="hljs-keyword">int</span> cut_vertex_id = scc_count;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) {
            <span class="hljs-keyword">if</span> (is_cut_vertex[i]) {
                cut_vertex_id++;
                mapping[i] = cut_vertex_id;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; scc : belong_to[i]) {
                    graph-&gt;<span class="hljs-built_in">addde</span>(cut_vertex_id, scc, <span class="hljs-number">1</span>);
                }
            } <span class="hljs-keyword">else</span> {
                mapping[i] = belong_to[i][<span class="hljs-number">0</span>];
            }
        }
    }
};
</div></code></pre>
<h3 id="dinic-网络流">Dinic 网络流</h3>
<pre><code class="language-cpp"><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">dinic</span> :</span> <span class="hljs-keyword">public</span> network_flow {
   <span class="hljs-keyword">private</span>:
    <span class="hljs-keyword">int</span> dis[MAXN];  <span class="hljs-comment">//起点到i的距离</span>
    <span class="hljs-keyword">int</span> cur[MAXN];  <span class="hljs-comment">//当前弧</span>
    <span class="hljs-keyword">bool</span> vis[MAXN];

    <span class="hljs-keyword">int</span> s, t;

    <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">bfs</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-built_in">memset</span>(vis, <span class="hljs-literal">false</span>, <span class="hljs-keyword">sizeof</span> vis);
        queue&lt;<span class="hljs-keyword">int</span>&gt; q;
        q.<span class="hljs-built_in">push</span>(s);
        dis[s] = <span class="hljs-number">0</span>;
        vis[s] = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">while</span> (!q.<span class="hljs-built_in">empty</span>()) {
            <span class="hljs-keyword">int</span> u = q.<span class="hljs-built_in">front</span>();
            q.<span class="hljs-built_in">pop</span>();
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i : g[u]) {
                edge&amp; now = e[i];
                <span class="hljs-keyword">if</span> (!vis[now.to] &amp;&amp; now.cap &gt; now.flow) {
                    vis[now.to] = <span class="hljs-literal">true</span>;
                    dis[now.to] = dis[u] + <span class="hljs-number">1</span>;
                    q.<span class="hljs-built_in">push</span>(now.to);
                }
            }
        }
        <span class="hljs-keyword">return</span> vis[t];
    }

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-keyword">int</span> u, <span class="hljs-keyword">int</span> a)</span> </span>{
        <span class="hljs-keyword">if</span> (u == t || a == <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> a;
        }
        <span class="hljs-keyword">int</span> flow = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (; cur[u] &lt; g[u].<span class="hljs-built_in">size</span>(); cur[u]++) {
            edge&amp; now = e[g[u][cur[u]]];
            <span class="hljs-keyword">if</span> (dis[u] + <span class="hljs-number">1</span> == dis[now.to]) {
                <span class="hljs-keyword">int</span> f = <span class="hljs-built_in">dfs</span>(now.to, <span class="hljs-built_in">min</span>(a, now.cap - now.flow));
                <span class="hljs-keyword">if</span> (f &gt; <span class="hljs-number">0</span>) {
                    now.flow += f;
                    e[g[u][cur[u]] ^ <span class="hljs-number">1</span>].flow -= f;
                    flow += f;
                    a -= f;
                    <span class="hljs-keyword">if</span> (a == <span class="hljs-number">0</span>) {
                        <span class="hljs-keyword">break</span>;
                    }
                }
            }
        }
        <span class="hljs-keyword">return</span> flow;
    }

   <span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">dinic</span>(<span class="hljs-keyword">int</span> n) : <span class="hljs-built_in">network_flow</span>(n) {
        <span class="hljs-built_in">memset</span>(dis, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> dis);
        <span class="hljs-built_in">memset</span>(cur, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> cur);
        <span class="hljs-built_in">memset</span>(vis, <span class="hljs-literal">false</span>, <span class="hljs-keyword">sizeof</span> vis);
    }

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">maxflow</span><span class="hljs-params">(<span class="hljs-keyword">int</span> s, <span class="hljs-keyword">int</span> t)</span> </span>{
        <span class="hljs-keyword">this</span>-&gt;s = s;
        <span class="hljs-keyword">this</span>-&gt;t = t;
        <span class="hljs-keyword">int</span> flow = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (<span class="hljs-built_in">bfs</span>()) {
            <span class="hljs-built_in">memset</span>(cur, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> cur);
            flow += <span class="hljs-built_in">dfs</span>(s, INF);
        }
        <span class="hljs-keyword">return</span> flow;
    }
};
</div></code></pre>
<h3 id="ek-网络流">EK 网络流</h3>
<pre><code class="language-cpp"><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">edmonds_karp</span> :</span> <span class="hljs-keyword">public</span> network_flow {
   <span class="hljs-keyword">private</span>:
    <span class="hljs-keyword">int</span> a[MAXN];   <span class="hljs-comment">//起点到i的可改进量</span>
    <span class="hljs-keyword">int</span> fa[MAXN];  <span class="hljs-comment">//最短路树上的入边</span>
   <span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">edmonds_karp</span>(<span class="hljs-keyword">int</span> n) : <span class="hljs-built_in">network_flow</span>(n) {
        <span class="hljs-built_in">memset</span>(a, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> a);
        <span class="hljs-built_in">memset</span>(fa, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> fa);
    }

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">maxflow</span><span class="hljs-params">(<span class="hljs-keyword">int</span> s, <span class="hljs-keyword">int</span> t)</span> </span>{
        <span class="hljs-keyword">int</span> flow = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            <span class="hljs-built_in">memset</span>(a, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> a);
            queue&lt;<span class="hljs-keyword">int</span>&gt; q;
            q.<span class="hljs-built_in">push</span>(s);
            a[s] = INF;
            <span class="hljs-keyword">while</span> (!q.<span class="hljs-built_in">empty</span>()) {
                <span class="hljs-keyword">int</span> u = q.<span class="hljs-built_in">front</span>();
                q.<span class="hljs-built_in">pop</span>();
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i : g[u]) {
                    edge&amp; now = e[i];
                    <span class="hljs-keyword">if</span> (a[now.to] == <span class="hljs-number">0</span> &amp;&amp; now.cap &gt; now.flow) {
                        fa[now.to] = i;
                        a[now.to] = <span class="hljs-built_in">min</span>(a[u], now.cap - now.flow);
                        q.<span class="hljs-built_in">push</span>(now.to);
                    }
                }
                <span class="hljs-keyword">if</span> (a[t] &gt; <span class="hljs-number">0</span>) {  <span class="hljs-comment">//剪枝：已经找到了一条</span>
                    <span class="hljs-keyword">break</span>;
                }
            }
            <span class="hljs-keyword">if</span> (a[t] == <span class="hljs-number">0</span>) {  <span class="hljs-comment">//没有增广路了</span>
                <span class="hljs-keyword">break</span>;
            }
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> u = t; u != s; u = e[fa[u]].from) {
                e[fa[u]].flow += a[t];
                e[fa[u] ^ <span class="hljs-number">1</span>].flow -= a[t];
            }
            flow += a[t];
        }
        <span class="hljs-keyword">return</span> flow;
    }
};
</div></code></pre>
<h3 id="kruscal-最小生成树">Kruscal 最小生成树</h3>
<pre><code class="language-cpp"><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">kruskal</span> {</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">edge</span> {</span>
        <span class="hljs-keyword">int</span> to, from;
        <span class="hljs-keyword">int</span> dis;
        <span class="hljs-built_in">edge</span>(<span class="hljs-keyword">int</span> to = <span class="hljs-number">0</span>, <span class="hljs-keyword">int</span> from = <span class="hljs-number">0</span>, <span class="hljs-keyword">int</span> dis = <span class="hljs-number">0</span>) : <span class="hljs-built_in">to</span>(to), <span class="hljs-built_in">from</span>(from), <span class="hljs-built_in">dis</span>(dis) {}
    } e[MAXM * <span class="hljs-number">2</span>];

    <span class="hljs-keyword">int</span> ecnt;
    <span class="hljs-keyword">int</span> n;
    <span class="hljs-keyword">int</span> fa[MAXN];
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">find</span><span class="hljs-params">(<span class="hljs-keyword">int</span> u)</span> </span>{ <span class="hljs-keyword">return</span> (fa[u] == u) ? u : fa[u] = <span class="hljs-built_in">find</span>(fa[u]); }

    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">cmp</span><span class="hljs-params">(<span class="hljs-keyword">const</span> edge&amp; a, <span class="hljs-keyword">const</span> edge&amp; b)</span> </span>{ <span class="hljs-keyword">return</span> a.dis &lt; b.dis; }

   <span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">kruskal</span>(<span class="hljs-keyword">int</span> n) {
        <span class="hljs-keyword">this</span>-&gt;n = n;
        ecnt = <span class="hljs-number">0</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">adde</span><span class="hljs-params">(<span class="hljs-keyword">int</span> to, <span class="hljs-keyword">int</span> from, <span class="hljs-keyword">int</span> dis)</span> </span>{ e[++ecnt] = <span class="hljs-built_in">edge</span>(to, from, dis); }

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">solve</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-built_in">sort</span>(e + <span class="hljs-number">1</span>, e + ecnt + <span class="hljs-number">1</span>, cmp);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) {
            fa[i] = i;
        }
        <span class="hljs-keyword">int</span> cnt = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">int</span> pos = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">int</span> ans = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (cnt &lt; n &amp;&amp; pos &lt;= ecnt) {
            edge now = e[++pos];
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">find</span>(now.from) != <span class="hljs-built_in">find</span>(now.to)) {
                ans += now.dis;
                cnt++;
                fa[<span class="hljs-built_in">find</span>(now.from)] = <span class="hljs-built_in">find</span>(fa[now.to]);
            }
        }
        <span class="hljs-keyword">return</span> ans;
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">create_tree</span><span class="hljs-params">(lfs* tree)</span> </span>{
        <span class="hljs-built_in">sort</span>(e + <span class="hljs-number">1</span>, e + ecnt + <span class="hljs-number">1</span>, cmp);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) {
            fa[i] = i;
        }
        <span class="hljs-keyword">int</span> cnt = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">int</span> pos = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">int</span> ans = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (cnt &lt; n &amp;&amp; pos &lt;= ecnt) {
            edge now = e[++pos];
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">find</span>(now.from) != <span class="hljs-built_in">find</span>(now.to)) {
                tree-&gt;<span class="hljs-built_in">addde</span>(now.from, now.to, now.dis);
                cnt++;
                fa[<span class="hljs-built_in">find</span>(now.from)] = <span class="hljs-built_in">find</span>(fa[now.to]);
            }
        }
    }
};
</div></code></pre>
<h3 id="倍增-lca">倍增 LCA</h3>
<pre><code class="language-cpp"><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">lca</span> :</span> <span class="hljs-keyword">public</span> lfs {
   <span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">int</span> dep[MAXN];
    <span class="hljs-built_in">lca</span>(<span class="hljs-keyword">int</span> n) : <span class="hljs-built_in">lfs</span>(n) { <span class="hljs-built_in">memset</span>(dep, <span class="hljs-number">-1</span>, <span class="hljs-keyword">sizeof</span> dep); }
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">pre</span><span class="hljs-params">(<span class="hljs-keyword">int</span> rt = <span class="hljs-number">1</span>)</span> </span>{ <span class="hljs-built_in">dfs</span>(rt, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>); }
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">querylca</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span> </span>{
        <span class="hljs-keyword">if</span> (dep[a] &gt; dep[b]) <span class="hljs-built_in">swap</span>(a, b);
        <span class="hljs-keyword">int</span> h = dep[b] - dep[a];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">20</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
            <span class="hljs-keyword">if</span> (h &amp; (<span class="hljs-number">1</span> &lt;&lt; i)) {
                b = f[b][i];
            }
        }
        <span class="hljs-keyword">if</span> (a == b) <span class="hljs-keyword">return</span> a;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">20</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
            <span class="hljs-keyword">if</span> (f[a][i] == f[b][i]) <span class="hljs-keyword">continue</span>;
            a = f[a][i];
            b = f[b][i];
        }
        <span class="hljs-keyword">return</span> f[a][<span class="hljs-number">0</span>];
    }

   <span class="hljs-keyword">protected</span>:
    <span class="hljs-keyword">int</span> f[MAXN][<span class="hljs-number">22</span>];

   <span class="hljs-keyword">private</span>:
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dfs</span><span class="hljs-params">(<span class="hljs-keyword">int</span> u, <span class="hljs-keyword">int</span> d, <span class="hljs-keyword">int</span> fa)</span> </span>{
        dep[u] = d;
        f[u][<span class="hljs-number">0</span>] = fa;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">21</span>; i++) {
            f[u][i] = f[f[u][i - <span class="hljs-number">1</span>]][i - <span class="hljs-number">1</span>];
        }
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = head[u]; i != <span class="hljs-number">-1</span>; i = e[i].next) {
            <span class="hljs-keyword">int</span> v = e[i].to;
            <span class="hljs-keyword">if</span> (dep[v] == <span class="hljs-number">-1</span>) {
                <span class="hljs-built_in">dfs</span>(v, d + <span class="hljs-number">1</span>, u);
            }
        }
    }
};
</div></code></pre>
<h3 id="链式前向星">链式前向星</h3>
<pre><code class="language-cpp"><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">lfs</span> {</span>
   <span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">lfs</span>(<span class="hljs-keyword">int</span> n) : <span class="hljs-built_in">n</span>(n), <span class="hljs-built_in">head</span>(n + <span class="hljs-number">1</span>, <span class="hljs-number">-1</span>) {}
    <span class="hljs-built_in">lfs</span>(<span class="hljs-keyword">int</span> n, <span class="hljs-keyword">int</span> m) : <span class="hljs-built_in">lfs</span>(n) { e.<span class="hljs-built_in">reserve</span>(m); }
    <span class="hljs-keyword">int</span> n;

    vector&lt;<span class="hljs-keyword">int</span>&gt; head;
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">edge</span> {</span>
        <span class="hljs-keyword">int</span> to;
        <span class="hljs-keyword">int</span> next;
        <span class="hljs-keyword">int</span> w;
    };
    vector&lt;edge&gt; e;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">adde</span><span class="hljs-params">(<span class="hljs-keyword">int</span> u, <span class="hljs-keyword">int</span> v, <span class="hljs-keyword">int</span> w = <span class="hljs-number">1</span>)</span> </span>{
        e.<span class="hljs-built_in">push_back</span>(edge{.to = v, .next = head[u], .w = w});
        head[u] = e.<span class="hljs-built_in">size</span>() - <span class="hljs-number">1</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">addde</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b, <span class="hljs-keyword">int</span> w = <span class="hljs-number">1</span>)</span> </span>{
        <span class="hljs-built_in">adde</span>(a, b, w);
        <span class="hljs-built_in">adde</span>(b, a, w);
    }
};
</div></code></pre>
<h3 id="最小费用最大流">最小费用最大流</h3>
<pre><code class="language-cpp"><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">mcmf</span> {</span>
   <span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">mcmf</span>(<span class="hljs-keyword">int</span> n) {
        <span class="hljs-keyword">this</span>-&gt;n = n;
        <span class="hljs-built_in">memset</span>(head, <span class="hljs-number">-1</span>, <span class="hljs-keyword">sizeof</span> head);
        <span class="hljs-built_in">memset</span>(e, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> e);
    }
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">adde</span><span class="hljs-params">(<span class="hljs-keyword">int</span> from, <span class="hljs-keyword">int</span> to, <span class="hljs-keyword">int</span> flow, <span class="hljs-keyword">int</span> cost)</span> </span>{
        _adde(from, to, flow, cost);
        _adde(to, from, <span class="hljs-number">0</span>, -cost);
    }

    <span class="hljs-keyword">int</span> max_flow = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">int</span> min_cost = <span class="hljs-number">0</span>;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">solve</span><span class="hljs-params">(<span class="hljs-keyword">int</span> s, <span class="hljs-keyword">int</span> t)</span> </span>{
        <span class="hljs-comment">// 每次只增广最短路</span>
        <span class="hljs-keyword">while</span> (<span class="hljs-built_in">spfa</span>(s, t)) {
            max_flow += flow[t];
            min_cost += flow[t] * cost[t];
            <span class="hljs-keyword">int</span> u = t;
            <span class="hljs-keyword">while</span> (u != s) {
                e[in_edge[u]].flow -= flow[t];
                e[in_edge[u] ^ <span class="hljs-number">1</span>].flow += flow[t];
                u = e[in_edge[u]].from;
            }
        }
    }

   <span class="hljs-keyword">protected</span>:
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">edge</span> {</span>
        <span class="hljs-keyword">int</span> from, to, next;
        <span class="hljs-keyword">int</span> flow, cost;
    } e[MAXN * <span class="hljs-number">2</span>];
    <span class="hljs-keyword">int</span> head[MAXN];
    <span class="hljs-keyword">int</span> ecnt = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">int</span> n;

    <span class="hljs-keyword">void</span> _adde(<span class="hljs-keyword">int</span> from, <span class="hljs-keyword">int</span> to, <span class="hljs-keyword">int</span> flow, <span class="hljs-keyword">int</span> cost) {
        e[ecnt].from = from;
        e[ecnt].to = to;
        e[ecnt].flow = flow;
        e[ecnt].cost = cost;
        e[ecnt].next = head[from];
        head[from] = ecnt++;
    }

    <span class="hljs-keyword">int</span> cost[MAXN];     <span class="hljs-comment">// 最小花费</span>
    <span class="hljs-keyword">int</span> in_edge[MAXN];  <span class="hljs-comment">// 进入节点的边</span>
    <span class="hljs-keyword">int</span> flow[MAXN];     <span class="hljs-comment">// 源点至此流量</span>

    <span class="hljs-keyword">bool</span> ins[MAXN];

    <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">spfa</span><span class="hljs-params">(<span class="hljs-keyword">int</span> s, <span class="hljs-keyword">int</span> t)</span> </span>{
        <span class="hljs-built_in">memset</span>(cost, INF, <span class="hljs-keyword">sizeof</span> cost);
        <span class="hljs-built_in">memset</span>(flow, INF, <span class="hljs-keyword">sizeof</span> flow);
        <span class="hljs-built_in">memset</span>(ins, <span class="hljs-literal">false</span>, <span class="hljs-keyword">sizeof</span> ins);
        <span class="hljs-built_in">memset</span>(in_edge, <span class="hljs-number">-1</span>, <span class="hljs-keyword">sizeof</span> in_edge);

        queue&lt;<span class="hljs-keyword">int</span>&gt; q;
        q.<span class="hljs-built_in">push</span>(s);
        ins[s] = <span class="hljs-literal">true</span>;
        cost[s] = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (!q.<span class="hljs-built_in">empty</span>()) {
            <span class="hljs-keyword">int</span> u = q.<span class="hljs-built_in">front</span>();
            q.<span class="hljs-built_in">pop</span>();
            ins[u] = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = head[u]; i != <span class="hljs-number">-1</span>; i = e[i].next) {
                <span class="hljs-keyword">int</span> v = e[i].to;
                <span class="hljs-keyword">if</span> (e[i].flow &gt; <span class="hljs-number">0</span> &amp;&amp; cost[v] &gt; cost[u] + e[i].cost) {
                    cost[v] = cost[u] + e[i].cost;
                    in_edge[v] = i;
                    flow[v] = <span class="hljs-built_in">min</span>(flow[u], e[i].flow);
                    <span class="hljs-keyword">if</span> (!ins[v]) {
                        q.<span class="hljs-built_in">push</span>(v);
                        ins[v] = <span class="hljs-literal">true</span>;
                    }
                }
            }
        }
        <span class="hljs-keyword">return</span> in_edge[t] != <span class="hljs-number">-1</span>;
    }
};
</div></code></pre>
<h3 id="网络流基类">网络流基类</h3>
<pre><code class="language-cpp"><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">network_flow</span> {</span>
   <span class="hljs-keyword">protected</span>:
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">edge</span> {</span>
        <span class="hljs-keyword">int</span> from, to;
        <span class="hljs-keyword">int</span> cap, flow;
        <span class="hljs-built_in">edge</span>(<span class="hljs-keyword">int</span> u, <span class="hljs-keyword">int</span> v, <span class="hljs-keyword">int</span> c, <span class="hljs-keyword">int</span> f = <span class="hljs-number">0</span>)
            : <span class="hljs-built_in">from</span>(u), <span class="hljs-built_in">to</span>(v), <span class="hljs-built_in">cap</span>(c), <span class="hljs-built_in">flow</span>(f){};
    };
    <span class="hljs-keyword">int</span> n, m;
    vector&lt;edge&gt; e;
    vector&lt;<span class="hljs-keyword">int</span>&gt; g[MAXN];

   <span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">network_flow</span>() {
        n = <span class="hljs-number">0</span>;
        m = <span class="hljs-number">0</span>;
    }

    <span class="hljs-built_in">network_flow</span>(<span class="hljs-keyword">int</span> n) {
        <span class="hljs-keyword">this</span>-&gt;n = n;
        m = <span class="hljs-number">0</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">adde</span><span class="hljs-params">(<span class="hljs-keyword">int</span> from, <span class="hljs-keyword">int</span> to, <span class="hljs-keyword">int</span> cap)</span> </span>{
        e.<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">edge</span>(from, to, cap));
        g[from].<span class="hljs-built_in">push_back</span>(e.<span class="hljs-built_in">size</span>() - <span class="hljs-number">1</span>);
        e.<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">edge</span>(to, from, <span class="hljs-number">0</span>));
        g[to].<span class="hljs-built_in">push_back</span>(e.<span class="hljs-built_in">size</span>() - <span class="hljs-number">1</span>);
        m += <span class="hljs-number">2</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">clear_flow</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">for</span> (edge&amp; i : e) {
            i.flow = <span class="hljs-number">0</span>;
        }
    }
};
</div></code></pre>
<h3 id="有向图强连通分量">有向图强连通分量</h3>
<pre><code class="language-cpp"><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">scc</span> :</span> <span class="hljs-keyword">public</span> lfs {
   <span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">int</span> scccnt;
    <span class="hljs-keyword">int</span> belong[MAXN];

    <span class="hljs-built_in">scc</span>(<span class="hljs-keyword">int</span> n) : <span class="hljs-built_in">lfs</span>(n) {
        <span class="hljs-built_in">memset</span>(dfn, <span class="hljs-number">-1</span>, <span class="hljs-keyword">sizeof</span> dfn);
        <span class="hljs-built_in">memset</span>(low, <span class="hljs-number">-1</span>, <span class="hljs-keyword">sizeof</span> low);
        <span class="hljs-built_in">memset</span>(ins, <span class="hljs-literal">false</span>, <span class="hljs-keyword">sizeof</span> ins);
        <span class="hljs-built_in">memset</span>(belong, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> belong);
        tim = <span class="hljs-number">1</span>;
        scccnt = <span class="hljs-number">0</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">solve</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) {
            <span class="hljs-keyword">if</span> (dfn[i] == <span class="hljs-number">-1</span>) {
                <span class="hljs-built_in">tarjan</span>(i);
            }
        }
    }

    <span class="hljs-comment">//缩点，先调用solve</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">create_new</span><span class="hljs-params">(lfs* map)</span> </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = head[i]; j != <span class="hljs-number">-1</span>; j = e[j].next) {
                <span class="hljs-keyword">int</span> u = belong[i];
                <span class="hljs-keyword">int</span> v = belong[e[j].to];
                <span class="hljs-keyword">if</span> (u != v) {
                    map-&gt;<span class="hljs-built_in">adde</span>(u, v, e[j].w);
                }
            }
        }
    }

   <span class="hljs-keyword">protected</span>:
    stack&lt;<span class="hljs-keyword">int</span>&gt; s;
    <span class="hljs-keyword">bool</span> ins[MAXN];
    <span class="hljs-keyword">int</span> mina[MAXN];
    <span class="hljs-keyword">int</span> low[MAXN], dfn[MAXN];
    <span class="hljs-keyword">int</span> tim;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">tarjan</span><span class="hljs-params">(<span class="hljs-keyword">int</span> u)</span> </span>{
        dfn[u] = low[u] = tim++;
        s.<span class="hljs-built_in">push</span>(u);
        ins[u] = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = head[u]; i != <span class="hljs-number">-1</span>; i = e[i].next) {
            <span class="hljs-keyword">int</span> v = e[i].to;
            <span class="hljs-keyword">if</span> (dfn[v] == <span class="hljs-number">-1</span>) {
                <span class="hljs-built_in">tarjan</span>(v);
                low[u] = <span class="hljs-built_in">min</span>(low[u], low[v]);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span> (ins[v]) {
                    low[u] = <span class="hljs-built_in">min</span>(low[u], dfn[v]);
                }
            }
        }
        <span class="hljs-keyword">if</span> (dfn[u] == low[u]) {
            scccnt++;
            <span class="hljs-keyword">int</span> v = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">while</span> (v != u) {
                v = s.<span class="hljs-built_in">top</span>();
                s.<span class="hljs-built_in">pop</span>();
                ins[v] = <span class="hljs-literal">false</span>;
                belong[v] = scccnt;
            }
        }
    }
};
</div></code></pre>
<h3 id="最短路">最短路</h3>
<h4 id="dijkstra">Dijkstra</h4>
<pre><code class="language-cpp"><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">dijkstra</span> :</span> <span class="hljs-keyword">public</span> lfs {
   <span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">dijkstra</span>(<span class="hljs-keyword">int</span> n) : <span class="hljs-built_in">lfs</span>(n) { <span class="hljs-built_in">memset</span>(dis, INF, <span class="hljs-keyword">sizeof</span> dis); }
    <span class="hljs-keyword">int</span> dis[MAXN];
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">solve</span><span class="hljs-params">(<span class="hljs-keyword">int</span> s)</span> </span>{
        priority_queue&lt;pair&lt;<span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>&gt;, vector&lt;pair&lt;<span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>&gt;&gt;,
                       greater&lt;pair&lt;<span class="hljs-keyword">int</span>, <span class="hljs-keyword">int</span>&gt;&gt;&gt;
            q;
        dis[s] = <span class="hljs-number">0</span>;
        q.<span class="hljs-built_in">push</span>({<span class="hljs-number">0</span>, s});
        <span class="hljs-keyword">while</span> (!q.<span class="hljs-built_in">empty</span>()) {
            <span class="hljs-keyword">auto</span> x = q.<span class="hljs-built_in">top</span>();
            q.<span class="hljs-built_in">pop</span>();
            <span class="hljs-keyword">int</span> u = x.second;
            <span class="hljs-keyword">if</span> (dis[u] &lt; x.first) <span class="hljs-keyword">continue</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = head[u]; i != <span class="hljs-number">-1</span>; i = e[i].next) {
                <span class="hljs-keyword">int</span> v = e[i].to;
                <span class="hljs-keyword">if</span> (dis[u] + e[i].w &lt; dis[v]) {
                    dis[v] = dis[u] + e[i].w;
                    q.<span class="hljs-built_in">push</span>({dis[v], v});
                }
            }
        }
    }
};
</div></code></pre>
<h4 id="spfa">SPFA</h4>
<pre><code class="language-cpp"><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">spfa</span> :</span> <span class="hljs-keyword">public</span> lfs {
   <span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">spfa</span>(<span class="hljs-keyword">int</span> n) : <span class="hljs-built_in">lfs</span>(n) { <span class="hljs-built_in">memset</span>(dis, INF, <span class="hljs-keyword">sizeof</span> dis); }
    <span class="hljs-keyword">int</span> dis[MAXN];
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">solve</span><span class="hljs-params">(<span class="hljs-keyword">int</span> s)</span> </span>{
        <span class="hljs-built_in">memset</span>(ins, <span class="hljs-literal">false</span>, <span class="hljs-keyword">sizeof</span> ins);
        <span class="hljs-built_in">memset</span>(dis, INF, <span class="hljs-keyword">sizeof</span> dis);
        queue&lt;<span class="hljs-keyword">int</span>&gt; q;
        q.<span class="hljs-built_in">push</span>(s);
        ins[s] = <span class="hljs-literal">true</span>;
        dis[s] = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (!q.<span class="hljs-built_in">empty</span>()) {
            <span class="hljs-keyword">int</span> now = q.<span class="hljs-built_in">front</span>();
            q.<span class="hljs-built_in">pop</span>();
            ins[now] = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = head[now]; i != <span class="hljs-number">-1</span>; i = e[i].next) {
                <span class="hljs-keyword">int</span> v = e[i].to;
                <span class="hljs-keyword">int</span> w = e[i].w;
                <span class="hljs-keyword">if</span> (dis[now] + w &lt; dis[v]) {
                    dis[v] = dis[now] + w;
                    <span class="hljs-keyword">if</span> (!ins[v]) {
                        q.<span class="hljs-built_in">push</span>(v);
                        ins[v] = <span class="hljs-literal">true</span>;
                    }
                }
            }
        }
    }

   <span class="hljs-keyword">private</span>:
    <span class="hljs-keyword">bool</span> ins[MAXN];
};
</div></code></pre>
<h3 id="拓扑排序">拓扑排序</h3>
<pre><code class="language-cpp"><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">toposort</span> :</span> <span class="hljs-keyword">public</span> lfs {
 <span class="hljs-keyword">public</span>:
 	<span class="hljs-built_in">toposort</span>(<span class="hljs-keyword">int</span> n) : <span class="hljs-built_in">lfs</span>(n) {}
    <span class="hljs-keyword">int</span> in[MAXN];
    vector&lt;<span class="hljs-keyword">int</span>&gt; ans;
    <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">operator</span><span class="hljs-params">()</span><span class="hljs-params">()</span> </span>{
    	<span class="hljs-built_in">memset</span>(in, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> in);
    	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) {
    		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = head[i]; j != <span class="hljs-number">-1</span>; j = e[j].next) {
    			in[e[j].to]++;
    		}
    	}
    	queue&lt;<span class="hljs-keyword">int</span>&gt; q;
    	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) {
    		<span class="hljs-keyword">if</span> (in[i] == <span class="hljs-number">0</span>) {
    			q.<span class="hljs-built_in">push</span>(i);
    		}
    	}
    	<span class="hljs-keyword">while</span> (!q.<span class="hljs-built_in">empty</span>()) {
    		<span class="hljs-keyword">int</span> u = q.<span class="hljs-built_in">front</span>();
    		q.<span class="hljs-built_in">pop</span>();
    		ans.<span class="hljs-built_in">push_back</span>(u);
    		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = head[u]; i != <span class="hljs-number">-1</span>; i = e[i].next) {
    			<span class="hljs-keyword">int</span> v = e[i].to;
    			in[v]--;
    			<span class="hljs-keyword">if</span> (in[v] == <span class="hljs-number">0</span>) {
    				q.<span class="hljs-built_in">push</span>(v);
    			}
    		}
    	}
    	<span class="hljs-keyword">return</span> ans.<span class="hljs-built_in">size</span>() == n;
    }
};
</div></code></pre>
<h3 id="矩阵树定理">矩阵树定理</h3>
<p>定义图的 Laplacian 矩阵 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>∈</mo><msup><mi>Z</mi><mrow><mi>n</mi><mo>×</mo><mi>n</mi></mrow></msup></mrow><annotation encoding="application/x-tex">L\in Z^{n\times n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7713em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7713em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span>,</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>L</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>deg</mtext><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>i</mi><mo>=</mo><mi>j</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><msub><mi>m</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo separator="true">,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>i</mi><mo mathvariant="normal">≠</mo><mi>j</mi></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">L_{ij}=
\begin{cases}
\textrm{deg}(i),  &amp; i=j \\
-m_{ij}, &amp; i\neq j
\end{cases}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord textrm">deg</span></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mpunct">,</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord">−</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mpunct">,</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em;"><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>deg</mtext><mo stretchy="false">(</mo><mi>i</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\textrm{deg}(i)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord textrm">deg</span></span><span class="mopen">(</span><span class="mord mathnormal">i</span><span class="mclose">)</span></span></span></span> 是节点 i 的度数, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">m_{ij}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> 是节点 u 和 v 的边数.</p>
<p><img src="https://s2.loli.net/2022/04/22/chFxqy8ZplIvDgr.png" alt="image.png"></p>
<p>例如, 上图的 Laplacian 矩阵是</p>
<p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>L</mi><mo>=</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.16em" columnalign="center center center center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>3</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>2</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>3</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>4</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>3</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">L=
\begin{pmatrix}
3  &amp; 0  &amp; -1 &amp; 0  &amp; -1 &amp; -1 \\
0  &amp; 2  &amp; 0  &amp; 0  &amp; -1 &amp; -1 \\
-1 &amp; 0  &amp; 3  &amp; -1 &amp; -1 &amp; 0  \\
0  &amp; 0  &amp; -1 &amp; 1  &amp; 0  &amp; 0  \\
-1 &amp; -1 &amp; -1 &amp; 0  &amp; 4  &amp; -1 \\
-1 &amp; -1 &amp; 0  &amp; 0  &amp; -1 &amp; 3  \\
\end{pmatrix}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:7.2001em;vertical-align:-3.35em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.85em;"><span style="top:-2.911em;"><span class="pstrut" style="height:5.6161em;"></span><span class="delimsizinginner delim-size4"><span>⎝</span></span></span><span style="top:-4.058em;"><span class="pstrut" style="height:5.6161em;"></span><span style="height:3.6161em;width:0.875em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.875em' height='3.6161em' style='width:0.875em' viewBox='0 0 875 3616' preserveAspectRatio='xMinYMin'><path d='M291 0 H417 V3616 H291z M291 0 H417 V3616 H291z'/></svg></span></span><span style="top:-8.3111em;"><span class="pstrut" style="height:5.6161em;"></span><span class="delimsizinginner delim-size4"><span>⎛</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.35em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.85em;"><span style="top:-6.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span></span></span><span style="top:-4.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span style="top:-0.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.85em;"><span style="top:-6.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-4.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span style="top:-0.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.85em;"><span style="top:-6.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span style="top:-4.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span style="top:-1.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span style="top:-0.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.85em;"><span style="top:-6.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-4.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-1.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-0.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.85em;"><span style="top:-6.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span style="top:-4.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">4</span></span></span><span style="top:-0.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.85em;"><span style="top:-6.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span style="top:-4.81em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-1.21em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">−</span><span class="mord">1</span></span></span><span style="top:-0.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.35em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.85em;"><span style="top:-2.911em;"><span class="pstrut" style="height:5.6161em;"></span><span class="delimsizinginner delim-size4"><span>⎠</span></span></span><span style="top:-4.058em;"><span class="pstrut" style="height:5.6161em;"></span><span style="height:3.6161em;width:0.875em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.875em' height='3.6161em' style='width:0.875em' viewBox='0 0 875 3616' preserveAspectRatio='xMinYMin'><path d='M457 0 H583 V3616 H457z M457 0 H583 V3616 H457z'/></svg></span></span><span style="top:-8.3111em;"><span class="pstrut" style="height:5.6161em;"></span><span class="delimsizinginner delim-size4"><span>⎞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.35em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>则图的生成树个数为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>det</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>L</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\det(L_0)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">det</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>, 其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">L_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span></span></span></span> 去掉 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 行 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 列, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">i</span></span></span></span> 任取 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>≤</mo><mi>i</mi><mo>≤</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">1 \leq i \leq n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7804em;vertical-align:-0.136em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7955em;vertical-align:-0.136em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>.</p>
<h3 id="最小树形图">最小树形图</h3>
<p>最小树形图是有向图上，从给定的根节点出发到达所有节点的一颗生成树。</p>
<pre><code class="language-cpp"><div><span class="hljs-keyword">int</span> g[MAXN][MAXN];
<span class="hljs-keyword">bool</span> remove_tag[MAXN];  <span class="hljs-comment">// 缩环时删点标记</span>
<span class="hljs-keyword">int</span> fa[MAXN];           <span class="hljs-comment">// 每轮，每个点的最小前驱节点</span>
<span class="hljs-keyword">bool</span> vis[MAXN];         <span class="hljs-comment">// 找环的标记</span>

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">directional_spawning_tree</span><span class="hljs-params">(<span class="hljs-keyword">int</span> root, <span class="hljs-keyword">int</span> n)</span> </span>{
    <span class="hljs-keyword">int</span> ans = <span class="hljs-number">0</span>;
    <span class="hljs-built_in">memset</span>(remove_tag, <span class="hljs-literal">false</span>, <span class="hljs-keyword">sizeof</span> remove_tag);
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-comment">// 找每个点的最小前驱边</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> u = <span class="hljs-number">1</span>; u &lt;= n; u++) {
            <span class="hljs-keyword">if</span> (remove_tag[u] || u == root) <span class="hljs-keyword">continue</span>;
            <span class="hljs-keyword">int</span> min_val = INF;
            <span class="hljs-keyword">int</span> min_node = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) {
                <span class="hljs-keyword">if</span> (remove_tag[i]) <span class="hljs-keyword">continue</span>;
                <span class="hljs-keyword">if</span> (g[i][u] &lt; min_val) {
                    min_val = g[i][u];
                    min_node = i;
                }
            }
            <span class="hljs-comment">// 如果没有前驱，则无解</span>
            <span class="hljs-keyword">if</span> (min_node == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
            fa[u] = min_node;
        }

        <span class="hljs-comment">// 判断是否有环</span>
        <span class="hljs-keyword">bool</span> has_loop = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">int</span> loop_head = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) {
            <span class="hljs-keyword">if</span> (remove_tag[i] || i == root) <span class="hljs-keyword">continue</span>;
            <span class="hljs-built_in">memset</span>(vis, <span class="hljs-literal">false</span>, <span class="hljs-keyword">sizeof</span> vis);
            vis[root] = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">int</span> u = i;
            <span class="hljs-keyword">while</span> (!vis[u]) {
                vis[u] = <span class="hljs-literal">true</span>;
                u = fa[u];
            }
            <span class="hljs-keyword">if</span> (u != root) {
                has_loop = <span class="hljs-literal">true</span>;
                loop_head = u;
                <span class="hljs-keyword">break</span>;
            }
        }

        <span class="hljs-keyword">if</span> (!has_loop) {
            <span class="hljs-comment">// 没有环，则算法结束</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) {
                <span class="hljs-keyword">if</span> (remove_tag[i] || i == root) <span class="hljs-keyword">continue</span>;
                ans += g[fa[i]][i];
            }
            <span class="hljs-keyword">return</span> ans;
        }

        <span class="hljs-comment">// cout &lt;&lt; loop_head &lt;&lt; endl;</span>

        <span class="hljs-comment">// 进行缩环操作</span>
        <span class="hljs-comment">// 统计环上的权值</span>
        <span class="hljs-keyword">int</span> u = loop_head;
        <span class="hljs-keyword">do</span> {
            ans += g[fa[u]][u];
            u = fa[u];
        } <span class="hljs-keyword">while</span> (u != loop_head);

        <span class="hljs-comment">// 然后处理环上所有入边的权值，入边权值减去环上边的权值</span>
        <span class="hljs-comment">// 这样缩环后再判断找最小前驱边时，选到入环的边就决定了断环的位置</span>
        u = loop_head;
        <span class="hljs-keyword">do</span> {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) {
                <span class="hljs-keyword">if</span> (remove_tag[i]) <span class="hljs-keyword">continue</span>;
                <span class="hljs-keyword">if</span> (i != fa[u] &amp;&amp; g[i][u] != INF) {
                    g[i][u] -= g[fa[u]][u];
                }
            }
            u = fa[u];
        } <span class="hljs-keyword">while</span> (u != loop_head);

        <span class="hljs-comment">// 缩点，转移权值</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++) {
            <span class="hljs-keyword">if</span> (remove_tag[i] || i == loop_head) <span class="hljs-keyword">continue</span>;
            <span class="hljs-keyword">int</span> u = fa[loop_head];
            <span class="hljs-keyword">do</span> {
                g[loop_head][i] = <span class="hljs-built_in">min</span>(g[loop_head][i], g[u][i]);
                g[i][loop_head] = <span class="hljs-built_in">min</span>(g[i][loop_head], g[i][u]);
                u = fa[u];
            } <span class="hljs-keyword">while</span> (u != loop_head);
        }

        <span class="hljs-comment">// 把环上其他的点都标记删除</span>
        u = fa[loop_head];
        <span class="hljs-keyword">do</span> {
            remove_tag[u] = <span class="hljs-literal">true</span>;
            u = fa[u];
        } <span class="hljs-keyword">while</span> (u != loop_head);
    }
}
</div></code></pre>
<h3 id="全局最小割">全局最小割</h3>
<p>任意两点间最小割</p>
<pre><code class="language-cpp"><div><span class="hljs-keyword">int</span> g[MAXN][MAXN];
<span class="hljs-keyword">int</span> w[MAXN]; <span class="hljs-comment">// w[i] 已选定集合中所有点到 i 的直接连边边权总和</span>
<span class="hljs-keyword">int</span> fa[MAXN]; <span class="hljs-comment">// 处理合并操作后，删掉其中一个点</span>
<span class="hljs-keyword">bool</span> ins[MAXN];

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">int</span> n, m;
    <span class="hljs-keyword">while</span> (cin &gt;&gt; n &gt;&gt; m) {
        <span class="hljs-built_in">memset</span>(g, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> g);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= m; i++) {
            <span class="hljs-keyword">int</span> u = <span class="hljs-built_in">read</span>();
            <span class="hljs-keyword">int</span> v = <span class="hljs-built_in">read</span>();
            <span class="hljs-keyword">int</span> c = <span class="hljs-built_in">read</span>();
            g[u][v] += c;
            g[v][u] += c;
        }
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) {
            fa[i] = i;
        }
        <span class="hljs-keyword">int</span> ans = INF;
        <span class="hljs-keyword">int</span> remain = n;
        <span class="hljs-keyword">while</span> (remain &gt; <span class="hljs-number">1</span>) {
            <span class="hljs-built_in">memset</span>(w, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> w);
            <span class="hljs-built_in">memset</span>(ins, <span class="hljs-literal">false</span>, <span class="hljs-keyword">sizeof</span> ins);
            ins[<span class="hljs-number">0</span>] = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">int</span> u = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">int</span> v = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; remain; i++) {
                u = v;
                v = <span class="hljs-number">-1</span>;
                <span class="hljs-keyword">int</span> cut_v = <span class="hljs-number">-1</span>;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt; remain; j++) {
                    <span class="hljs-keyword">if</span> (!ins[j]) {
                        w[j] += g[fa[j]][fa[u]];
                        <span class="hljs-keyword">if</span> (w[j] &gt; cut_v) {
                            cut_v = w[j];
                            v = j;
                        }
                    }
                }
                ins[v] = <span class="hljs-literal">true</span>;
            }
            ans = <span class="hljs-built_in">min</span>(ans, w[v]);

            <span class="hljs-comment">// 类似并查集的合并操作</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; remain; i++) {
                <span class="hljs-keyword">if</span> (i == v) <span class="hljs-keyword">continue</span>;
                g[fa[i]][fa[<span class="hljs-number">0</span>]] += g[fa[i]][fa[v]];
                g[fa[<span class="hljs-number">0</span>]][fa[i]] += g[fa[v]][fa[i]];
            }
            remain--;
            fa[v] = fa[remain]; <span class="hljs-comment">// 相当于是把 v 删掉了</span>
        }

        <span class="hljs-built_in">write</span>(ans);
        <span class="hljs-built_in">putchar</span>(<span class="hljs-string">&#x27;\n&#x27;</span>);
    }
}
</div></code></pre>
<h2 id="数学">数学</h2>
<h3 id="组合数">组合数</h3>
<h4 id="组合数递推">组合数递推</h4>
<pre><code class="language-cpp"><div><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> MAXC = <span class="hljs-number">50</span>;

<span class="hljs-keyword">int</span> C[MAXC][MAXC];

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init_cnum</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; MAXC; i++) {
        C[i][<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt; MAXC; j++) {
            C[i][j] = C[i - <span class="hljs-number">1</span>][j] + C[i][j - <span class="hljs-number">1</span>];
        }
    }
    <span class="hljs-keyword">return</span>;
}
</div></code></pre>
<h4 id="卢卡斯定理">卢卡斯定理</h4>
<p>模意义下的大组合数</p>
<pre><code class="language-cpp"><div><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T, <span class="hljs-keyword">size_t</span> N&gt;
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">lucas_t</span> {</span>
   <span class="hljs-keyword">private</span>:
	<span class="hljs-function">T <span class="hljs-title">pow</span><span class="hljs-params">(T a, T b, T mod)</span> </span>{
    	T res = <span class="hljs-number">1</span>;
    	<span class="hljs-keyword">while</span> (b) {
        	<span class="hljs-keyword">if</span> (b &amp; <span class="hljs-number">1</span>) res = res * a % mod;
        	a = a * a % mod;
        	b /= <span class="hljs-number">2</span>;
    	}
    	<span class="hljs-keyword">return</span> res;
	}
   	
   <span class="hljs-keyword">public</span>:
   	<span class="hljs-function">T <span class="hljs-title">c</span><span class="hljs-params">(T n, T m, T mod)</span> </span>{
   		<span class="hljs-keyword">if</span> (n &lt; m) {
   			<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
   		} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (m &gt; n - m) {
   			m = n - m;
   		}
   		T a = <span class="hljs-number">1</span>, b = <span class="hljs-number">1</span>;
   		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; m; i++) {
   			a = a * (n - i) % mod;
   			b = b * (i + <span class="hljs-number">1</span>) % mod;
   		}
   		<span class="hljs-keyword">return</span> a * <span class="hljs-built_in">pow</span>(b, mod - <span class="hljs-number">2</span>, mod) % mod;
   	}
   	
	<span class="hljs-function">T <span class="hljs-title">operator</span><span class="hljs-params">()</span><span class="hljs-params">(T n, T m, T mod)</span> </span>{
		<span class="hljs-keyword">if</span> (m == <span class="hljs-number">0</span>) {
			<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
		} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (m &gt; n) {
			<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
		}	
		<span class="hljs-keyword">return</span> (*<span class="hljs-keyword">this</span>)(n / mod, m / mod, mod) * <span class="hljs-built_in">c</span>(n % mod, m % mod, mod) % mod;
	} 	
};
</div></code></pre>
<h3 id="exgcd">Exgcd</h3>
<pre><code class="language-cpp"><div><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-function">T <span class="hljs-title">exgcd</span><span class="hljs-params">(T a, T b, T &amp;x, T &amp;y)</span> </span>{
    <span class="hljs-keyword">if</span> (!b) {
        x = <span class="hljs-number">1</span>;
        y = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">return</span> a;
    }
    T g = <span class="hljs-built_in">exgcd</span>(b, a % b, x, y);
    T tmp = x;
    x = y;
    y = tmp - a / b * y;
    <span class="hljs-keyword">return</span> g;
}

<span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-function">T <span class="hljs-title">inv1</span><span class="hljs-params">(T a, T mod)</span> </span>{
    T x, y;
    T d = <span class="hljs-built_in">exgcd</span>(a, mod, x, y);
    <span class="hljs-keyword">if</span> (d == <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> (x % mod + mod) % mod;
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
}
</div></code></pre>
<h3 id="高斯消元相关">高斯消元相关</h3>
<h4 id="解线性方程组">解线性方程组</h4>
<pre><code class="language-cpp"><div><span class="hljs-keyword">const</span> <span class="hljs-keyword">double</span> EPS = <span class="hljs-number">1e-8</span>;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">dcmp</span><span class="hljs-params">(<span class="hljs-keyword">double</span> x, <span class="hljs-keyword">double</span> y)</span> </span>{
	<span class="hljs-keyword">double</span> c = x - y;
	<span class="hljs-keyword">if</span> (c &gt; EPS) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
	<span class="hljs-keyword">if</span> (c &lt; -EPS) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">gauss</span><span class="hljs-params">(<span class="hljs-keyword">const</span> vector&lt;vector&lt;T&gt;&gt;&amp; in, vector&lt;T&gt;&amp; out)</span> </span>{
	vector&lt;vector&lt;T&gt;&gt; <span class="hljs-built_in">a</span>(in);
	<span class="hljs-keyword">size_t</span> n = in.<span class="hljs-built_in">size</span>();
	<span class="hljs-comment">// i 枚举列 </span>
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) {
		<span class="hljs-comment">// 选定当前列的最大系数项 </span>
		<span class="hljs-keyword">size_t</span> mxid = i;
		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> j = i + <span class="hljs-number">1</span>; j &lt; n; j++) {
			<span class="hljs-keyword">if</span> (<span class="hljs-built_in">dcmp</span>(<span class="hljs-built_in">fabs</span>(a[j][i]), <span class="hljs-built_in">fabs</span>(a[mxid][i])) == <span class="hljs-number">1</span>) {
				mxid = j;
			}
		}
		<span class="hljs-comment">// 提到当前排 </span>
		<span class="hljs-built_in">swap</span>(a[i], a[mxid]);
		<span class="hljs-keyword">if</span> (a[i][i] == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> j = <span class="hljs-number">0</span>; j &lt; n; j++) {
			<span class="hljs-keyword">if</span> (j == i) <span class="hljs-keyword">continue</span>;
			T mi = a[j][i] / a[i][i];
			<span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> k = i + <span class="hljs-number">1</span>; k &lt;= n; k++) {
				a[j][k] -= a[i][k] * mi;
			}
		} 
	}
	
	out = vector&lt;T&gt;(n, <span class="hljs-number">0</span>);
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">size_t</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) {
		out[i] = a[i][n] / a[i][i];
	}
	<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</div></code></pre>
<h4 id="行列式">行列式</h4>
<pre><code class="language-cpp"><div><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-function">T <span class="hljs-title">det</span><span class="hljs-params">(vector&lt;vector&lt;T&gt;&gt; a, T mod, <span class="hljs-keyword">int</span> n = <span class="hljs-number">-1</span>)</span> </span>{
    T symbol = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">if</span> (n == <span class="hljs-number">-1</span>) n = a.<span class="hljs-built_in">size</span>();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = i + <span class="hljs-number">1</span>; j &lt; n; j++) {
            <span class="hljs-keyword">while</span> (a[i][i] != <span class="hljs-number">0</span>) {
                T d = a[j][i] / a[i][i] % mod;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = i; k &lt; n; k++) {
                    a[j][k] -= a[i][k] * d % mod;
                    a[j][k] = (a[j][k] % mod + mod) % mod;
                }
                <span class="hljs-built_in">swap</span>(a[i], a[j]);
                symbol = -symbol;
            }
            <span class="hljs-built_in">swap</span>(a[i], a[j]);
            symbol = -symbol;
        }
    }

    T ans = symbol;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) {
        ans *= a[i][i];
        ans %= mod;
    }
    <span class="hljs-keyword">return</span> (ans + mod) % mod;
}
</div></code></pre>
<h3 id="多项式">多项式</h3>
<pre><code class="language-cpp"><div><span class="hljs-keyword">namespace</span> polynomial
{
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">double</span> PI = <span class="hljs-built_in">acos</span>(<span class="hljs-number">-1</span>);

    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">point</span>
    {</span>
        T x, y;
        <span class="hljs-built_in">point</span>() : <span class="hljs-built_in">x</span>(<span class="hljs-number">0</span>), <span class="hljs-built_in">y</span>(<span class="hljs-number">0</span>) {}
        <span class="hljs-built_in">point</span>(T X, T Y) : <span class="hljs-built_in">x</span>(X), <span class="hljs-built_in">y</span>(Y) {}
    };
    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;
    point&lt;T&gt; <span class="hljs-keyword">operator</span>+(<span class="hljs-keyword">const</span> point&lt;T&gt; &amp;a, <span class="hljs-keyword">const</span> point&lt;T&gt; &amp;b)
    {
        <span class="hljs-keyword">return</span> point&lt;T&gt;(a.x + b.x, a.y + b.y);
    }
    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;
    point&lt;T&gt; <span class="hljs-keyword">operator</span>-(<span class="hljs-keyword">const</span> point&lt;T&gt; &amp;a, <span class="hljs-keyword">const</span> point&lt;T&gt; &amp;b)
    {
        <span class="hljs-keyword">return</span> point&lt;T&gt;(a.x - b.x, a.y - b.y);
    }
    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;
    <span class="hljs-function">point&lt;T&gt; <span class="hljs-title">cross</span><span class="hljs-params">(<span class="hljs-keyword">const</span> point&lt;T&gt; &amp;a, <span class="hljs-keyword">const</span> point&lt;T&gt; &amp;b)</span>
    </span>{
        <span class="hljs-keyword">return</span> point&lt;T&gt;(a.x * b.x - a.y * b.y, a.x * b.y + a.y * b.x);
    }

    <span class="hljs-keyword">typedef</span> point&lt;<span class="hljs-keyword">double</span>&gt; complex;
    <span class="hljs-keyword">inline</span> complex <span class="hljs-keyword">operator</span>*(<span class="hljs-keyword">const</span> complex &amp;a, <span class="hljs-keyword">const</span> complex &amp;b) { <span class="hljs-keyword">return</span> <span class="hljs-built_in">cross</span>(a, b); }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">fft</span><span class="hljs-params">(complex *f, <span class="hljs-keyword">int</span> limit, <span class="hljs-keyword">int</span> reverse, <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> *r)</span>
    </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; limit; i++)
        {
            <span class="hljs-keyword">if</span> (i &lt; r[i])
                <span class="hljs-built_in">swap</span>(f[i], f[r[i]]);
        }
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt; limit; j &lt;&lt;= <span class="hljs-number">1</span>)
        {
            <span class="hljs-function">complex <span class="hljs-title">omega</span><span class="hljs-params">(cos(PI / j), reverse * sin(PI / j))</span></span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k &lt; limit; k += (j &lt;&lt; <span class="hljs-number">1</span>))
            {
                <span class="hljs-function">complex <span class="hljs-title">cur</span><span class="hljs-params">(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>)</span></span>;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> l = <span class="hljs-number">0</span>; l &lt; j; l++, cur = cur * omega)
                {
                    complex nx = f[k + l], ny = cur * f[k + j + l];
                    f[k + l] = nx + ny;
                    f[k + j + l] = nx - ny;
                }
            }
        }
    }

    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T = <span class="hljs-keyword">int</span>&gt;
    T *<span class="hljs-built_in">multiplicate_coefficient</span>(complex *a, <span class="hljs-keyword">int</span> n, complex *b, <span class="hljs-keyword">int</span> m)
    {
        <span class="hljs-keyword">int</span> lim = <span class="hljs-number">1</span>, l = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (lim &lt;= n + m)
        {
            lim &lt;&lt;= <span class="hljs-number">1</span>;
            l++;
        }
        <span class="hljs-keyword">int</span> *r = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[lim + <span class="hljs-number">10</span>];
        <span class="hljs-built_in">memset</span>(r, <span class="hljs-number">0</span>, (lim + <span class="hljs-number">10</span>) * <span class="hljs-built_in"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword">int</span>));
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; lim; i++)
        {
            r[i] = (r[i &gt;&gt; <span class="hljs-number">1</span>] &gt;&gt; <span class="hljs-number">1</span>) | ((i &amp; <span class="hljs-number">1</span>) &lt;&lt; (l - <span class="hljs-number">1</span>));
        }
        <span class="hljs-built_in">fft</span>(a, lim, <span class="hljs-number">1</span>, r);
        <span class="hljs-built_in">fft</span>(b, lim, <span class="hljs-number">1</span>, r);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt;= lim; i++)
        {
            a[i] = a[i] * b[i];
        }
        <span class="hljs-built_in">fft</span>(a, lim, <span class="hljs-number">-1</span>, r);
        <span class="hljs-keyword">delete</span>[] r;
        T *ans = <span class="hljs-keyword">new</span> T[n + m + <span class="hljs-number">1</span>];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt;= n + m; i++)
        {
            ans[i] = (T)(a[i].x / lim + <span class="hljs-number">0.5</span>);
        }
        <span class="hljs-keyword">return</span> ans;
    }

    <span class="hljs-keyword">const</span> int64 P = <span class="hljs-number">998244353</span>;
    <span class="hljs-keyword">const</span> int64 G = <span class="hljs-number">3</span>;

    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;
    <span class="hljs-function">T <span class="hljs-title">pow_mod</span><span class="hljs-params">(T a, T b, T MOD)</span>
    </span>{
        T res = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">while</span> (b)
        {
            <span class="hljs-keyword">if</span> (b &amp; <span class="hljs-number">1</span>)
                res = res * a % MOD;
            a = a * a % MOD;
            b /= <span class="hljs-number">2</span>;
        }
        <span class="hljs-keyword">return</span> res;
    }

    int64 inv = <span class="hljs-built_in">pow_mod</span>(G, P - <span class="hljs-number">2</span>, P);

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">ntt</span><span class="hljs-params">(int64 *f, <span class="hljs-keyword">int</span> limit, <span class="hljs-keyword">bool</span> reverse, <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> *r)</span>
    </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; limit; i++)
        {
            <span class="hljs-keyword">if</span> (i &lt; r[i])
                <span class="hljs-built_in">swap</span>(f[i], f[r[i]]);
        }
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt; limit; j &lt;&lt;= <span class="hljs-number">1</span>)
        {
            int64 omega =
                reverse ? <span class="hljs-built_in">pow_mod</span>(G, (P - <span class="hljs-number">1</span>) / (j &lt;&lt; <span class="hljs-number">1</span>), P) : <span class="hljs-built_in">pow_mod</span>(inv, (P - <span class="hljs-number">1</span>) / (j &lt;&lt; <span class="hljs-number">1</span>), P);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k &lt; limit; k += (j &lt;&lt; <span class="hljs-number">1</span>))
            {
                int64 cur = <span class="hljs-number">1</span>;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> l = <span class="hljs-number">0</span>; l &lt; j; l++)
                {
                    int64 nx = f[k + l], ny = (cur * f[k + j + l]) % P;
                    f[k + l] = (nx + ny) % P;
                    f[k + j + l] = (nx - ny + P) % P;
                    cur = (cur * omega) % P;
                }
            }
        }
    }

    <span class="hljs-comment">// template &lt;typename T = int64&gt;</span>
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">multiplicate_coefficient</span><span class="hljs-params">(int64 *a, <span class="hljs-keyword">int</span> n, int64 *b, <span class="hljs-keyword">int</span> m)</span>
    </span>{
        <span class="hljs-keyword">int</span> lim = <span class="hljs-number">1</span>, l = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (lim &lt;= n + m)
        {
            lim &lt;&lt;= <span class="hljs-number">1</span>;
            l++;
        }

        <span class="hljs-keyword">int</span> *r = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[lim + <span class="hljs-number">10</span>];
        <span class="hljs-built_in">memset</span>(r, <span class="hljs-number">0</span>, (lim + <span class="hljs-number">10</span>) * <span class="hljs-built_in"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword">int</span>));
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; lim; i++)
        {
            r[i] = (r[i &gt;&gt; <span class="hljs-number">1</span>] &gt;&gt; <span class="hljs-number">1</span>) | ((i &amp; <span class="hljs-number">1</span>) &lt;&lt; (l - <span class="hljs-number">1</span>));
        }
        <span class="hljs-built_in">ntt</span>(a, lim, <span class="hljs-literal">false</span>, r);
        <span class="hljs-built_in">ntt</span>(b, lim, <span class="hljs-literal">false</span>, r);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt;= lim; i++)
        {
            a[i] = a[i] * b[i];
        }
        <span class="hljs-built_in">ntt</span>(a, lim, <span class="hljs-literal">true</span>, r);
        int64 inv = pow_mod&lt;int64&gt;(lim, P - <span class="hljs-number">2</span>, P);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt;= lim; i++)
        {
            a[i] = a[i] * inv % P;
        }
        <span class="hljs-keyword">delete</span>[] r;
    }
};
</div></code></pre>
<h3 id="质数">质数</h3>
<h4 id="线性筛">线性筛</h4>
<pre><code class="language-cpp"><div><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> MAXA = <span class="hljs-number">5e6</span> + <span class="hljs-number">10</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> AMXA = <span class="hljs-number">5e6</span>;

<span class="hljs-keyword">int</span> prime[MAXA];
<span class="hljs-keyword">bool</span> isntp[MAXA];
<span class="hljs-keyword">int</span> prime_cnt;

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">make_prime</span><span class="hljs-params">()</span> </span>{
    prime_cnt = <span class="hljs-number">0</span>;
    <span class="hljs-built_in">memset</span>(isntp, <span class="hljs-literal">false</span>, <span class="hljs-built_in"><span class="hljs-keyword">sizeof</span></span>(isntp));
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">2</span>; i &lt;= AMXA; ++i) {
        <span class="hljs-keyword">if</span> (!isntp[i]) {
            prime[prime_cnt++] = i;
        }
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; prime_cnt; ++j) {
            <span class="hljs-keyword">if</span> (i * prime[j] &gt; AMXA) {
                <span class="hljs-keyword">break</span>;
            }
            isntp[i * prime[j]] = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (i % prime[j] == <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">break</span>;
            }
        }
    }
}
</div></code></pre>
<h4 id="欧拉-phi-函数">欧拉 Phi 函数</h4>
<pre><code class="language-cpp"><div><span class="hljs-keyword">int</span> phi[MAXA];

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init_phi</span><span class="hljs-params">()</span> </span>{
    phi[<span class="hljs-number">1</span>] = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">2</span>; i &lt;= AMXA; i++) {
        <span class="hljs-keyword">if</span> (!isntp[i]) {
            prime[++prime_cnt] = i;
            phi[i] = i - <span class="hljs-number">1</span>;
        }
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt;= prime_cnt &amp;&amp; i * prime[j] &lt;= AMXA; j++) {
            isntp[i * prime[j]] = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (i % prime[j] == <span class="hljs-number">0</span>) {
                phi[i * prime[j]] = phi[i] * prime[j];
                <span class="hljs-keyword">break</span>;
            } <span class="hljs-keyword">else</span> {
                phi[i * prime[j]] = phi[i] * (prime[j] - <span class="hljs-number">1</span>);
            }
        }
    }
}
</div></code></pre>
<h4 id="mr-素数测试">MR 素数测试</h4>
<pre><code class="language-cpp"><div><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">mr</span><span class="hljs-params">(int64 x, int64 b)</span> </span>{
    int64 d = x - <span class="hljs-number">1</span>;
    int64 p = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">while</span> ((d &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">0</span>) {
        d &gt;&gt;= <span class="hljs-number">1</span>;
        p++;
    }
    int64 cur = <span class="hljs-built_in">pow_mod</span>(b, d, x);
    <span class="hljs-keyword">if</span> (cur == <span class="hljs-number">1</span> || cur == x - <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= p; i++) {
        cur = cur * cur % x;
        <span class="hljs-keyword">if</span> (cur == x - <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">is_prime</span><span class="hljs-params">(int64 x)</span> </span>{
    <span class="hljs-keyword">if</span> (x == <span class="hljs-number">46856248255981ll</span> || x &lt; <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">if</span> (x == <span class="hljs-number">2</span> || x == <span class="hljs-number">3</span> || x == <span class="hljs-number">7</span> || x == <span class="hljs-number">61</span> || x == <span class="hljs-number">24251</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">mr</span>(x, <span class="hljs-number">2</span>) &amp;&amp; <span class="hljs-built_in">mr</span>(x, <span class="hljs-number">3</span>) &amp;&amp; <span class="hljs-built_in">mr</span>(x, <span class="hljs-number">7</span>) &amp;&amp; <span class="hljs-built_in">mr</span>(x, <span class="hljs-number">61</span>) &amp;&amp; <span class="hljs-built_in">mr</span>(x, <span class="hljs-number">24251</span>);
}
</div></code></pre>
<h2 id="其他">其他</h2>
<h3 id="ac-自动机">AC 自动机</h3>
<pre><code class="language-cpp"><div><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> MAXS = <span class="hljs-number">2e6</span> + <span class="hljs-number">10</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> MAXT = <span class="hljs-number">2e5</span> + <span class="hljs-number">10</span>;

<span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T = <span class="hljs-keyword">char</span>, <span class="hljs-keyword">size_t</span> sigma_size = <span class="hljs-number">26</span>, T insert_offset = <span class="hljs-string">&#x27;a&#x27;</span>&gt;
class ac {
   <span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">ac</span>() {
        trie[<span class="hljs-number">0</span>] = null = <span class="hljs-keyword">new</span> <span class="hljs-built_in">trie_node</span>();
        trie[<span class="hljs-number">1</span>] = root = <span class="hljs-keyword">new</span> <span class="hljs-built_in">trie_node</span>(null);
        <span class="hljs-built_in">memset</span>(endpoint, <span class="hljs-number">-1</span>, <span class="hljs-keyword">sizeof</span> endpoint);
        <span class="hljs-built_in">memset</span>(ans, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> ans);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; sigma_size; i++) {
            null-&gt;ch[i] = root;
        }
        null-&gt;fail = null;
    }

    ~<span class="hljs-built_in">ac</span>() {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt;= node_cnt; i++) <span class="hljs-keyword">delete</span> trie[i];
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insert</span><span class="hljs-params">(<span class="hljs-keyword">const</span> T* t, <span class="hljs-keyword">int</span> id)</span> </span>{
        trie_node* u = root;
        <span class="hljs-keyword">while</span> (*t != <span class="hljs-string">&#x27;\0&#x27;</span>) {
            <span class="hljs-keyword">int</span> v = *t - insert_offset;
            <span class="hljs-keyword">if</span> (u-&gt;ch[v] == null) {
                u-&gt;ch[v] = trie[++node_cnt] = <span class="hljs-keyword">new</span> <span class="hljs-built_in">trie_node</span>(null);
            }
            u = u-&gt;ch[v];
            t++;
        }
        <span class="hljs-keyword">if</span> (u-&gt;id == <span class="hljs-number">0</span>) u-&gt;id = id;
        endpoint[id] = u-&gt;id;
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">get_fail</span><span class="hljs-params">()</span> </span>{
        queue&lt;trie_node*&gt; q;
        q.<span class="hljs-built_in">push</span>(root);
        <span class="hljs-keyword">while</span> (!q.<span class="hljs-built_in">empty</span>()) {
            trie_node* u = q.<span class="hljs-built_in">front</span>();
            q.<span class="hljs-built_in">pop</span>();
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; sigma_size; i++) {
                <span class="hljs-keyword">if</span> (u-&gt;ch[i] == null) {
                    u-&gt;ch[i] = u-&gt;fail-&gt;ch[i];
                } <span class="hljs-keyword">else</span> {
                    u-&gt;ch[i]-&gt;fail = u-&gt;fail-&gt;ch[i];
                    u-&gt;ch[i]-&gt;fail-&gt;in++;
                    q.<span class="hljs-built_in">push</span>(u-&gt;ch[i]);
                }
            }
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-keyword">const</span> T* s)</span> </span>{
        trie_node* u = root;
        <span class="hljs-keyword">while</span> (*s != <span class="hljs-string">&#x27;\0&#x27;</span>) {
            u = u-&gt;ch[*s - insert_offset];
            u-&gt;hit++;
            s++;
        }

        queue&lt;trie_node*&gt; q;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= node_cnt; i++) {
            <span class="hljs-keyword">if</span> (trie[i]-&gt;in == <span class="hljs-number">0</span>) q.<span class="hljs-built_in">push</span>(trie[i]);
        }
        <span class="hljs-keyword">while</span> (!q.<span class="hljs-built_in">empty</span>()) {
            trie_node* u = q.<span class="hljs-built_in">front</span>();
            q.<span class="hljs-built_in">pop</span>();
            ans[u-&gt;id] = u-&gt;hit;
            u-&gt;fail-&gt;hit += u-&gt;hit;
            u-&gt;fail-&gt;in--;
            <span class="hljs-keyword">if</span> (u-&gt;fail-&gt;in == <span class="hljs-number">0</span>) q.<span class="hljs-built_in">push</span>(u-&gt;fail);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">get_ans</span><span class="hljs-params">(<span class="hljs-keyword">int</span> id)</span> </span>{ <span class="hljs-keyword">return</span> ans[endpoint[id]]; }

   <span class="hljs-keyword">protected</span>:
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">trie_node</span> {</span>
        trie_node* ch[sigma_size];
        trie_node* fail;
        <span class="hljs-keyword">int</span> in;
        <span class="hljs-keyword">int</span> id, hit;
        <span class="hljs-built_in">trie_node</span>(trie_node* def = <span class="hljs-literal">nullptr</span>) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; sigma_size; i++) {
                ch[i] = def;
            }
            fail = def;
            hit = id = in = <span class="hljs-number">0</span>;
        }
    };
    trie_node* trie[MAXT];
    trie_node* root;
    trie_node* null;
    <span class="hljs-keyword">int</span> node_cnt = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">int</span> endpoint[MAXT];
    <span class="hljs-keyword">int</span> ans[MAXT];
};
</div></code></pre>
<h3 id="io-优化">IO 优化</h3>
<pre><code class="language-cpp"><div><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> getchar()                                                              \
    (frS == frT &amp;&amp;                                                             \
             (frT = (frS = frBB) + fread(frBB, 1, 1 &lt;&lt; 15, stdin), frS == frT) \
         ? EOF                                                                 \
         : *frS++)</span>
<span class="hljs-keyword">char</span> frBB[<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">15</span>], *frS = frBB, *frT = frBB;

<span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T = <span class="hljs-keyword">int</span>&gt;
T <span class="hljs-built_in">read</span>() {
    T x = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">bool</span> negative = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">char</span> ch = <span class="hljs-string">&#x27;\0&#x27;</span>;
    <span class="hljs-keyword">while</span> (!<span class="hljs-built_in">isdigit</span>(ch))
    {
        negative |= (ch == <span class="hljs-string">&#x27;-&#x27;</span>);
        ch = <span class="hljs-built_in">getchar</span>();
    }
    <span class="hljs-keyword">while</span> (<span class="hljs-built_in">isdigit</span>(ch)) {
        x *= <span class="hljs-number">10</span>;
        x += ch - <span class="hljs-string">&#x27;0&#x27;</span>;
        ch = <span class="hljs-built_in">getchar</span>();
    }
    <span class="hljs-keyword">return</span> negative ? -x : x;
}

<span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">dbread</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">double</span> X = <span class="hljs-number">0</span>, Y = <span class="hljs-number">1.0</span>;
    <span class="hljs-keyword">int</span> w = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">char</span> ch = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">while</span> (!<span class="hljs-built_in">isdigit</span>(ch)) {
        w |= ch == <span class="hljs-string">&#x27;-&#x27;</span>;
        ch = <span class="hljs-built_in">getchar</span>();
    }
    <span class="hljs-keyword">while</span> (<span class="hljs-built_in">isdigit</span>(ch)) X = X * <span class="hljs-number">10</span> + (ch ^ <span class="hljs-number">48</span>), ch = <span class="hljs-built_in">getchar</span>();
    ch = <span class="hljs-built_in">getchar</span>();  <span class="hljs-comment">//读入小数点</span>
    <span class="hljs-keyword">while</span> (<span class="hljs-built_in">isdigit</span>(ch)) X += (Y /= <span class="hljs-number">10</span>) * (ch ^ <span class="hljs-number">48</span>), ch = <span class="hljs-built_in">getchar</span>();
    <span class="hljs-keyword">return</span> w ? -X : X;
}

<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">void</span> <span class="hljs-title">write</span><span class="hljs-params">(T x)</span> </span>{
    <span class="hljs-keyword">if</span> (x &lt; <span class="hljs-number">0</span>) <span class="hljs-built_in">putchar</span>(<span class="hljs-string">&#x27;-&#x27;</span>), x = -x;
    <span class="hljs-keyword">if</span> (x &gt; <span class="hljs-number">9</span>) <span class="hljs-built_in">write</span>(x / <span class="hljs-number">10</span>);
    <span class="hljs-built_in">putchar</span>(x % <span class="hljs-number">10</span> + <span class="hljs-string">&#x27;0&#x27;</span>);
}
</div></code></pre>
<h3 id="kmp">KMP</h3>
<pre><code class="language-cpp"><div><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> MAXM = <span class="hljs-number">1e4</span> + <span class="hljs-number">10</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> MAXN = <span class="hljs-number">1e6</span> + <span class="hljs-number">10</span>;

<span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> <span class="hljs-keyword">value_t</span> = <span class="hljs-keyword">char</span>&gt;
struct kmp {
   <span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// S:源串    T:模式串</span>
    <span class="hljs-keyword">int</span> <span class="hljs-built_in"><span class="hljs-keyword">operator</span></span>()(<span class="hljs-keyword">const</span> <span class="hljs-keyword">value_t</span> *S, <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> n, <span class="hljs-keyword">const</span> <span class="hljs-keyword">value_t</span> *T,
                   <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> m) {
        <span class="hljs-built_in">getnext</span>(T, m);
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">search</span>(S, n, T, m);
    }

   <span class="hljs-keyword">private</span>:
    <span class="hljs-keyword">int</span> next[MAXM];
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">getnext</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">value_t</span> *T, <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> m)</span> </span>{
        <span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>, k = <span class="hljs-number">-1</span>;  <span class="hljs-comment">// j前缀，p后缀</span>
        next[<span class="hljs-number">0</span>] = <span class="hljs-number">-1</span>;
        <span class="hljs-keyword">while</span> (j &lt; m - <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">if</span> (k == <span class="hljs-number">-1</span> || T[j] == T[k]) {
                j++;
                k++;
                <span class="hljs-keyword">if</span> (T[j] != T[k]) {
                    next[j] = k;
                } <span class="hljs-keyword">else</span> {
                    next[j] = next[k];
                }
            } <span class="hljs-keyword">else</span> {
                k = next[k];
            }
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">search</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">value_t</span> *S, <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> n, <span class="hljs-keyword">const</span> <span class="hljs-keyword">value_t</span> *T, <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> m)</span> </span>{
        <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>, j = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (i &lt; n &amp;&amp; j &lt; m) {
            <span class="hljs-keyword">if</span> (j == <span class="hljs-number">-1</span> || S[i] == T[j]) {
                i++;
                j++;
            } <span class="hljs-keyword">else</span> {
                j = next[j];
            }
        }
        <span class="hljs-keyword">if</span> (j == m) {
            <span class="hljs-keyword">return</span> i - j;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">count</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">value_t</span> *S, <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> n, <span class="hljs-keyword">const</span> <span class="hljs-keyword">value_t</span> *T, <span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> m)</span> </span>{
        <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>, j = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">int</span> ans = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (i &lt; n &amp;&amp; j &lt; m) {
            <span class="hljs-keyword">if</span> (j == <span class="hljs-number">-1</span> || S[i] == T[j]) {
                i++;
                j++;
            } <span class="hljs-keyword">else</span> {
                j = next[j];
            }
            <span class="hljs-keyword">if</span> (j == m) {
                ans++;
                j = <span class="hljs-number">0</span>;
            }
        }
        <span class="hljs-keyword">return</span> ans;
    }
};
</div></code></pre>
<h4 id="exkmp">EXKMP</h4>
<pre><code class="language-cpp"><div><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> INF = <span class="hljs-number">0x3f3f3f3f</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> MAXN = <span class="hljs-number">2e7</span> + <span class="hljs-number">10</span>;

<span class="hljs-keyword">namespace</span> exkmp {
<span class="hljs-keyword">int</span> next[MAXN];
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">getnext</span><span class="hljs-params">(<span class="hljs-keyword">const</span> string&amp; str)</span> </span>{
    <span class="hljs-keyword">int</span> len = str.<span class="hljs-built_in">length</span>();
    next[<span class="hljs-number">0</span>] = len;  <span class="hljs-comment">// 根据定义</span>
    <span class="hljs-comment">// 枚举求 next[1]</span>
    next[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">while</span> (next[<span class="hljs-number">1</span>] &lt; len - <span class="hljs-number">1</span> &amp;&amp; str[next[<span class="hljs-number">1</span>]] == str[next[<span class="hljs-number">1</span>] + <span class="hljs-number">1</span>]) {
        next[<span class="hljs-number">1</span>]++;
    }
    <span class="hljs-keyword">int</span> k = <span class="hljs-number">1</span>;  <span class="hljs-comment">// 最远位置处，相同前后缀的后缀的起始下标</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">2</span>; i &lt; len; i++) {
        <span class="hljs-keyword">int</span> p = k + next[k] - <span class="hljs-number">1</span>;  <span class="hljs-comment">// 能最远找到的下标</span>
        <span class="hljs-keyword">if</span> (i + next[i - k] &lt;= p) {
            next[i] = next[i - k];
        } <span class="hljs-keyword">else</span> {
            next[i] = <span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, p - i + <span class="hljs-number">1</span>);
            <span class="hljs-keyword">while</span> (i + next[i] &lt; len &amp;&amp; str[i + next[i]] == str[next[i]]) {
                next[i]++;
            }
            k = i;
        }
    }
}

<span class="hljs-keyword">int</span> ext[MAXN];
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">getext</span><span class="hljs-params">(<span class="hljs-keyword">const</span> string&amp; a, <span class="hljs-keyword">const</span> string&amp; b)</span> </span>{
    <span class="hljs-keyword">int</span> alen = a.<span class="hljs-built_in">length</span>();
    <span class="hljs-keyword">int</span> blen = b.<span class="hljs-built_in">length</span>();
    ext[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">while</span> (ext[<span class="hljs-number">0</span>] &lt; alen &amp;&amp; ext[<span class="hljs-number">0</span>] &lt; blen &amp;&amp; a[ext[<span class="hljs-number">0</span>]] == b[ext[<span class="hljs-number">0</span>]]) {
        ext[<span class="hljs-number">0</span>]++;
    }
    <span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; alen; i++) {
        <span class="hljs-keyword">int</span> p = k + ext[k] - <span class="hljs-number">1</span>;  <span class="hljs-comment">// 能最远找到的下标</span>
        <span class="hljs-keyword">if</span> (i + next[i - k] &lt;= p) {
            ext[i] = next[i - k];
        } <span class="hljs-keyword">else</span> {
            ext[i] = <span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, p - i + <span class="hljs-number">1</span>);
            <span class="hljs-keyword">while</span> (i + ext[i] &lt; alen &amp;&amp; ext[i] &lt; blen &amp;&amp;
                   a[i + ext[i]] == b[ext[i]]) {
                ext[i]++;
            }
            k = i;
        }
    }
}
}  <span class="hljs-comment">// namespace exkmp</span>
</div></code></pre>
<h3 id="马拉车">马拉车</h3>
<pre><code class="language-cpp"><div><span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> BLANK = <span class="hljs-number">-1</span>;

<span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">manacher</span><span class="hljs-params">(T* a, <span class="hljs-keyword">size_t</span> len)</span> </span>{
    T* s = <span class="hljs-keyword">new</span> T[len * <span class="hljs-number">2</span> + <span class="hljs-number">10</span>];
    <span class="hljs-keyword">int</span>* p = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[len * <span class="hljs-number">2</span> + <span class="hljs-number">10</span>];
    <span class="hljs-built_in">memset</span>(s, <span class="hljs-number">0</span>, (len * <span class="hljs-number">2</span> + <span class="hljs-number">10</span>) * <span class="hljs-built_in"><span class="hljs-keyword">sizeof</span></span>(T));
    <span class="hljs-built_in">memset</span>(p, <span class="hljs-number">0</span>, (len * <span class="hljs-number">2</span> + <span class="hljs-number">10</span>) * <span class="hljs-built_in"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword">int</span>));
    
    s[<span class="hljs-number">0</span>] = s[<span class="hljs-number">1</span>] = BLANK;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; len;i++) {
        s[i * <span class="hljs-number">2</span> + <span class="hljs-number">2</span>] = a[i];
        s[i * <span class="hljs-number">2</span> + <span class="hljs-number">3</span>] = BLANK;
    }
    len = len * <span class="hljs-number">2</span> + <span class="hljs-number">2</span>;
    s[len] = <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">int</span> mxpos = <span class="hljs-number">0</span>, mxaxis = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; len; i++) {
        <span class="hljs-keyword">if</span> (i &lt; mxpos) {
            p[i] = <span class="hljs-built_in">min</span>(p[mxaxis * <span class="hljs-number">2</span> - i], p[mxaxis] + mxaxis - i);
        } <span class="hljs-keyword">else</span> {
            p[i] = <span class="hljs-number">1</span>;
        }
        <span class="hljs-keyword">while</span> (s[i + p[i]] == s[i - p[i]]) {
            p[i]++;
        }
        <span class="hljs-keyword">if</span> (p[i] + i &gt; mxpos) {
            mxpos = p[i] + i;
            mxaxis = i;
        }
    }
    
    <span class="hljs-keyword">int</span> ans = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) {
        ans = <span class="hljs-built_in">max</span>(ans, p[i]);
    }
    
    <span class="hljs-keyword">delete</span>[] s;
    <span class="hljs-keyword">delete</span>[] p;
    <span class="hljs-keyword">return</span> ans - <span class="hljs-number">1</span>;
}
</div></code></pre>
<h3 id="归并排序">归并排序</h3>
<pre><code class="language-cpp"><div><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">merge_sort</span><span class="hljs-params">(T* a, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span>&amp; ans, T* tmp)</span> </span>{
    <span class="hljs-keyword">if</span> (l == r) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">int</span> mid = (l + r) &gt;&gt; <span class="hljs-number">1</span>;
    <span class="hljs-built_in">merge_sort</span>(a, l, mid);
    <span class="hljs-built_in">merge_sort</span>(a, mid + <span class="hljs-number">1</span>, r);
    <span class="hljs-keyword">int</span> i = l, j = mid + <span class="hljs-number">1</span>;
    <span class="hljs-keyword">int</span> k = l;
    <span class="hljs-keyword">while</span> (i &lt;= mid &amp;&amp; j &lt;= r) {
        <span class="hljs-keyword">if</span> (a[i] &lt;= a[j]) {
            tmp[k++] = a[i++];
        } <span class="hljs-keyword">else</span> {
            tmp[k++] = a[j++];
            ans += mid - i + <span class="hljs-number">1</span>;
        }
    }
    <span class="hljs-keyword">while</span> (i &lt;= mid) {
        tmp[k++] = a[i++];
    }
    <span class="hljs-keyword">while</span> (j &lt;= r) {
        tmp[k++] = a[j++];
    }
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = l; i &lt;= r; i++) {
        a[i] = tmp[i];
    }
}

<span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; 
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">merge_sort</span><span class="hljs-params">(T* a, <span class="hljs-keyword">int</span> n)</span> </span>{
    <span class="hljs-keyword">auto</span> tmp = <span class="hljs-keyword">new</span> T[n + <span class="hljs-number">10</span>];
    <span class="hljs-keyword">int</span> ans = <span class="hljs-number">0</span>;
    <span class="hljs-built_in">merge_sort</span>(a, <span class="hljs-number">1</span>, n, ans, tmp);
    <span class="hljs-keyword">delete</span>[] tmp;
    <span class="hljs-keyword">return</span> ans;
}
</div></code></pre>
<h3 id="莫队">莫队</h3>
<h4 id="普通莫队">普通莫队</h4>
<pre><code class="language-cpp"><div><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> TAns&gt;
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">segment</span> {</span>
    <span class="hljs-keyword">int</span> id;
    <span class="hljs-keyword">int</span> l, r;
    TAns ans;
};

<span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> TAns&gt;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">offline_segments</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n, vector&lt;segment&lt;TAns&gt;&gt;&amp; segments,
                      function&lt;<span class="hljs-keyword">void</span>(<span class="hljs-keyword">int</span>, TAns&amp;)&gt; add,
                      function&lt;<span class="hljs-keyword">void</span>(<span class="hljs-keyword">int</span>, TAns&amp;)&gt; del)</span> </span>{
    <span class="hljs-keyword">int</span> block_size = <span class="hljs-built_in">ceil</span>(<span class="hljs-built_in">sqrt</span>(n));
    <span class="hljs-built_in">sort</span>(segments.<span class="hljs-built_in">begin</span>(), segments.<span class="hljs-built_in">end</span>(),
         [&amp;](<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span>&amp; a, <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span>&amp; b) -&gt; <span class="hljs-keyword">bool</span> {
             <span class="hljs-keyword">if</span> (a.l / block_size != b.l / block_size) {
                 <span class="hljs-keyword">return</span> a.l / block_size &lt; b.l / block_size;
             } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((a.l / block_size) &amp; <span class="hljs-number">1</span>) {
                 <span class="hljs-keyword">return</span> a.r &lt; b.r;
             } <span class="hljs-keyword">else</span> {
                 <span class="hljs-keyword">return</span> a.r &gt; b.r;
             }
         });

    <span class="hljs-keyword">int</span> l = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">int</span> r = <span class="hljs-number">1</span>;
    TAns ans = <span class="hljs-number">0</span>;
    <span class="hljs-built_in">add</span>(<span class="hljs-number">1</span>, ans);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; seg : segments) {
        <span class="hljs-keyword">while</span> (l &gt; seg.l) <span class="hljs-built_in">add</span>(--l, ans);
        <span class="hljs-keyword">while</span> (r &lt; seg.r) <span class="hljs-built_in">add</span>(++r, ans);
        <span class="hljs-keyword">while</span> (l &lt; seg.l) <span class="hljs-built_in">del</span>(l++, ans);
        <span class="hljs-keyword">while</span> (r &gt; seg.r) <span class="hljs-built_in">del</span>(r--, ans);
        seg.ans = ans;
    }
}
</div></code></pre>
<h4 id="不删除莫队">不删除莫队</h4>
<pre><code class="language-cpp"><div><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> TQuery, <span class="hljs-keyword">typename</span> TAns&gt;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">offline_segments</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n, vector&lt;TQuery&gt;&amp; queries,
                      function&lt;<span class="hljs-keyword">void</span>(TQuery&amp;)&gt; direct_process,
                      function&lt;<span class="hljs-keyword">void</span>(<span class="hljs-keyword">int</span>, TAns&amp;)&gt; add, function&lt;<span class="hljs-keyword">void</span>(<span class="hljs-keyword">int</span>)&gt; del,
                      TAns ans_reset)</span> </span>{
    <span class="hljs-comment">// 划分分块</span>
    <span class="hljs-keyword">int</span> block_size = <span class="hljs-built_in">sqrt</span>(n);
    <span class="hljs-keyword">int</span> block_count = n / block_size;
    <span class="hljs-function">vector&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">block_l</span><span class="hljs-params">(block_count + <span class="hljs-number">2</span>)</span>, <span class="hljs-title">block_r</span><span class="hljs-params">(block_count + <span class="hljs-number">2</span>)</span></span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= block_count; i++) {
        block_l[i] = (i - <span class="hljs-number">1</span>) * block_size + <span class="hljs-number">1</span>;
        block_r[i] = i * block_size;
    }
    <span class="hljs-keyword">if</span> (block_r[block_count] &lt; n) {
        block_count++;
        block_l[block_count] = block_r[block_count - <span class="hljs-number">1</span>] + <span class="hljs-number">1</span>;
        block_r[block_count] = n;
    }
    <span class="hljs-function">vector&lt;<span class="hljs-keyword">int</span>&gt; <span class="hljs-title">block</span><span class="hljs-params">(n + <span class="hljs-number">1</span>)</span></span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= block_count; i++) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = block_l[i]; j &lt;= block_r[i]; j++) {
            block[j] = i;
        }
    }

    <span class="hljs-comment">// 排序询问</span>
    <span class="hljs-built_in">sort</span>(queries.<span class="hljs-built_in">begin</span>(), queries.<span class="hljs-built_in">end</span>(),
         [&amp;](<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> a, <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span> b) -&gt; <span class="hljs-keyword">bool</span> {
             <span class="hljs-keyword">if</span> (block[a.l] == block[b.l]) {
                 <span class="hljs-keyword">return</span> a.r &lt; b.r;
             } <span class="hljs-keyword">else</span> {
                 <span class="hljs-keyword">return</span> block[a.l] &lt; block[b.l];
             }
         });

    TAns ans = ans_reset;
    <span class="hljs-keyword">int</span> last_block = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">int</span> l = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">int</span> r = <span class="hljs-number">0</span>;
    <span class="hljs-comment">// 处理询问</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; q : queries) {
        <span class="hljs-keyword">if</span> (block[q.l] == block[q.r]) {
            <span class="hljs-built_in">direct_process</span>(q);
            <span class="hljs-keyword">continue</span>;
        }

        <span class="hljs-keyword">if</span> (block[q.l] != last_block) {
            <span class="hljs-keyword">while</span> (l &lt;= r) <span class="hljs-built_in">del</span>(l++);
            l = block_r[block[q.l]] + <span class="hljs-number">1</span>;
            r = block_r[block[q.l]];
            ans = ans_reset;
            last_block = block[q.l];
        }
        <span class="hljs-keyword">while</span> (r &lt; q.r) <span class="hljs-built_in">add</span>(++r, ans);

        <span class="hljs-keyword">int</span> l_tmp = l;
        TAns ans_tmp = ans;
        <span class="hljs-keyword">while</span> (l_tmp &gt; q.l) <span class="hljs-built_in">add</span>(--l_tmp, ans_tmp);
        q.ans = ans_tmp;

        <span class="hljs-keyword">while</span> (l_tmp &lt; l) <span class="hljs-built_in">del</span>(l_tmp++);
    }
}
</div></code></pre>
<h4 id="树上莫队">树上莫队</h4>
<pre><code class="language-cpp"><div><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">offline_tree_path</span> {</span>
   <span class="hljs-keyword">public</span>:
    lfs&amp; g;

    <span class="hljs-built_in">offline_tree_path</span>(lfs&amp; graph, <span class="hljs-keyword">int</span> root = <span class="hljs-number">1</span>)
        : <span class="hljs-built_in">g</span>(graph),
          <span class="hljs-built_in">size</span>(g.n + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),
          <span class="hljs-built_in">top</span>(g.n + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),
          <span class="hljs-built_in">son</span>(g.n + <span class="hljs-number">1</span>, <span class="hljs-number">-1</span>),
          <span class="hljs-built_in">dep</span>(g.n + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),
          <span class="hljs-built_in">fa</span>(g.n + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),
          <span class="hljs-built_in">enter</span>(g.n + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>),
          <span class="hljs-built_in">leave</span>(g.n + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>) {
        eular.<span class="hljs-built_in">reserve</span>(g.n * <span class="hljs-number">2</span>);
        eular.<span class="hljs-built_in">push_back</span>(<span class="hljs-number">0</span>);
        <span class="hljs-built_in">dfs1</span>(root, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        <span class="hljs-built_in">dfs2</span>(root, root);
    }

    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">query_lca</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>{
        <span class="hljs-keyword">while</span> (top[x] != top[y]) {
            <span class="hljs-keyword">if</span> (dep[top[x]] &lt; dep[top[y]]) <span class="hljs-built_in">swap</span>(x, y);
            x = fa[top[x]];
        }
        <span class="hljs-keyword">if</span> (dep[x] &gt; dep[y]) <span class="hljs-built_in">swap</span>(x, y);
        <span class="hljs-keyword">return</span> x;
    }

    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> TAns&gt;
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">query</span> {</span>
        <span class="hljs-keyword">int</span> id = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">int</span> x = <span class="hljs-number">0</span>, y = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">int</span> l = <span class="hljs-number">0</span>, r = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">int</span> lca = <span class="hljs-number">0</span>;
        TAns ans = <span class="hljs-number">0</span>;
    };

    <span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> TQuery, <span class="hljs-keyword">typename</span> TAns&gt;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">solve</span><span class="hljs-params">(vector&lt;TQuery&gt;&amp; queries, function&lt;<span class="hljs-keyword">void</span>(<span class="hljs-keyword">int</span>, TAns&amp;)&gt; add,
               function&lt;<span class="hljs-keyword">void</span>(<span class="hljs-keyword">int</span>, TAns&amp;)&gt; del, TAns ans_reset = TAns())</span> </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; q : queries) {
            <span class="hljs-keyword">if</span> (enter[q.x] &gt; enter[q.y]) {
                <span class="hljs-built_in">swap</span>(q.x, q.y);
            }
            <span class="hljs-keyword">int</span> lca = <span class="hljs-built_in">query_lca</span>(q.x, q.y);
            <span class="hljs-keyword">if</span> (lca == q.x) {
                q.l = enter[q.x];
                q.r = enter[q.y];
            } <span class="hljs-keyword">else</span> {
                q.l = leave[q.x];
                q.r = enter[q.y];
                q.lca = lca;
            }
        }
        <span class="hljs-keyword">int</span> block_size = g.n * <span class="hljs-number">2</span> / <span class="hljs-built_in">sqrt</span>(queries.<span class="hljs-built_in">size</span>() * <span class="hljs-number">2</span> / <span class="hljs-number">3</span>);
        <span class="hljs-built_in">sort</span>(queries.<span class="hljs-built_in">begin</span>(), queries.<span class="hljs-built_in">end</span>(),
             [&amp;](<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span>&amp; a, <span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span>&amp; b) -&gt; <span class="hljs-keyword">bool</span> {
                 <span class="hljs-keyword">if</span> (a.l / block_size != b.l / block_size) {
                     <span class="hljs-keyword">return</span> a.l / block_size &lt; b.l / block_size;
                 } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((a.l / block_size) &amp; <span class="hljs-number">1</span>) {
                     <span class="hljs-keyword">return</span> a.r &lt; b.r;
                 } <span class="hljs-keyword">else</span> {
                     <span class="hljs-keyword">return</span> a.r &gt; b.r;
                 }
             });

                TAns ans = ans_reset;
        <span class="hljs-function">vector&lt;<span class="hljs-keyword">char</span>&gt; <span class="hljs-title">ins</span><span class="hljs-params">(g.n + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>)</span></span>;  <span class="hljs-comment">// Avoid vector&lt;bool&gt;</span>
        <span class="hljs-keyword">auto</span> update_point = [&amp;](<span class="hljs-keyword">int</span> u) {
            <span class="hljs-keyword">if</span> (ins[u]) {
                <span class="hljs-built_in">del</span>(u, ans);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-built_in">add</span>(u, ans);
            }
            ins[u] = !ins[u];
        };
        <span class="hljs-keyword">int</span> l = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">int</span> r = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; q : queries) {
            <span class="hljs-keyword">while</span> (l &gt; q.l) <span class="hljs-built_in">update_point</span>(eular[--l]);
            <span class="hljs-keyword">while</span> (r &lt; q.r) <span class="hljs-built_in">update_point</span>(eular[++r]);
            <span class="hljs-keyword">while</span> (l &lt; q.l) <span class="hljs-built_in">update_point</span>(eular[l++]);
            <span class="hljs-keyword">while</span> (r &gt; q.r) <span class="hljs-built_in">update_point</span>(eular[r--]);
            <span class="hljs-keyword">if</span> (q.lca != <span class="hljs-number">0</span>) {
                <span class="hljs-built_in">update_point</span>(q.lca);
            }
            q.ans = ans;
            <span class="hljs-keyword">if</span> (q.lca != <span class="hljs-number">0</span>) {
                <span class="hljs-built_in">update_point</span>(q.lca);
            }
        }
    }

   <span class="hljs-keyword">private</span>:
    vector&lt;<span class="hljs-keyword">int</span>&gt; size, top, son, dep, fa;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dfs1</span><span class="hljs-params">(<span class="hljs-keyword">int</span> u, <span class="hljs-keyword">int</span> fa, <span class="hljs-keyword">int</span> d)</span> </span>{
        dep[u] = d;
        <span class="hljs-keyword">this</span>-&gt;fa[u] = fa;
        size[u] = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = g.head[u]; i != <span class="hljs-number">-1</span>; i = g.e[i].next) {
            <span class="hljs-keyword">int</span> v = g.e[i].to;
            <span class="hljs-keyword">if</span> (v != fa) {
                <span class="hljs-built_in">dfs1</span>(v, u, d + <span class="hljs-number">1</span>);
                size[u] += size[v];
                <span class="hljs-keyword">if</span> (son[u] == <span class="hljs-number">-1</span> || size[v] &gt; size[son[u]]) son[u] = v;
            }
        }
    }

    vector&lt;<span class="hljs-keyword">int</span>&gt; enter, leave;
    vector&lt;<span class="hljs-keyword">int</span>&gt; eular;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">dfs2</span><span class="hljs-params">(<span class="hljs-keyword">int</span> u, <span class="hljs-keyword">int</span> tp)</span> </span>{
        top[u] = tp;
        eular.<span class="hljs-built_in">push_back</span>(u);
        enter[u] = eular.<span class="hljs-built_in">size</span>() - <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (son[u] != <span class="hljs-number">-1</span>) {
            <span class="hljs-built_in">dfs2</span>(son[u], tp);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = g.head[u]; i != <span class="hljs-number">-1</span>; i = g.e[i].next) {
                <span class="hljs-keyword">int</span> v = g.e[i].to;
                <span class="hljs-keyword">if</span> (v != son[u] &amp;&amp; v != fa[u]) <span class="hljs-built_in">dfs2</span>(v, v);
            }
        }
        eular.<span class="hljs-built_in">push_back</span>(u);
        leave[u] = eular.<span class="hljs-built_in">size</span>() - <span class="hljs-number">1</span>;
    }
};
</div></code></pre>
<h3 id="模拟退火">模拟退火</h3>
<pre><code class="language-cpp"><div><span class="hljs-keyword">const</span> <span class="hljs-keyword">double</span> TBEGIN = <span class="hljs-number">3000</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">double</span> EPS = <span class="hljs-number">1e-14</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">double</span> TEND = EPS;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">double</span> DELTAT = <span class="hljs-number">0.99</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">double</span> INF = <span class="hljs-number">1e18</span>;

<span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> TValue&gt;
<span class="hljs-function">TValue <span class="hljs-title">sa</span><span class="hljs-params">(function&lt;<span class="hljs-keyword">void</span>(function&lt;<span class="hljs-keyword">double</span>()&gt;)&gt; step, function&lt;TValue()&gt; f,
          function&lt;<span class="hljs-keyword">void</span>(<span class="hljs-keyword">bool</span>)&gt; update,
          <span class="hljs-keyword">decltype</span>(mt19937::default_seed) seed =
              chrono::steady_clock::now().time_since_epoch().count())</span> </span>{
    <span class="hljs-keyword">double</span> t = TBEGIN;
    <span class="hljs-keyword">double</span> ans = INF;
    <span class="hljs-function">mt19937 <span class="hljs-title">rd</span><span class="hljs-params">(seed)</span></span>;
    <span class="hljs-keyword">while</span> (t &gt; EPS) {
        <span class="hljs-function">uniform_real_distribution <span class="hljs-title">dis</span><span class="hljs-params">(<span class="hljs-number">0</span>, t)</span></span>;
        <span class="hljs-built_in">step</span>([&amp;]() -&gt; <span class="hljs-keyword">auto</span> { <span class="hljs-keyword">return</span> <span class="hljs-built_in">dis</span>(rd); });
        TValue cur = <span class="hljs-built_in">f</span>();
        <span class="hljs-keyword">if</span> (cur &lt; ans) {
            ans = cur;
            <span class="hljs-built_in">update</span>(<span class="hljs-literal">true</span>);
        } <span class="hljs-keyword">else</span> {
            bernoulli_distribution <span class="hljs-built_in">accept</span>(<span class="hljs-built_in">max</span>(<span class="hljs-number">1.0l</span>f, <span class="hljs-built_in">exp</span>((ans - nans) / t)));
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">accept</span>(rd)) {
                <span class="hljs-built_in">update</span>(<span class="hljs-literal">true</span>);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-built_in">update</span>(<span class="hljs-literal">false</span>);
            }
        }
        t *= DELTAT;
    }
    <span class="hljs-keyword">return</span> ans;
}
</div></code></pre>
<h3 id="后缀自动机">后缀自动机</h3>
<pre><code class="language-cpp"><div><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">char</span> <span class="hljs-keyword">value_t</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> SIGMA = <span class="hljs-number">26</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> OFFSET = <span class="hljs-string">&#x27;a&#x27;</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">sam</span> {</span>
   <span class="hljs-keyword">protected</span>:
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">state</span> {</span>
        state* ch[SIGMA];
        <span class="hljs-comment">// 定义w为这些字符串中最长的一个, 连接到对应于w的最长后缀的另一个</span>
        <span class="hljs-comment">// endpos 等价类的状态</span>
        state* link;
        <span class="hljs-keyword">int</span> len, size, id;
        <span class="hljs-built_in">state</span>(<span class="hljs-keyword">int</span> i, state* def = <span class="hljs-literal">nullptr</span>) : <span class="hljs-built_in">id</span>(i) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; SIGMA; i++) ch[i] = def;
            link = def;
            len = size = <span class="hljs-number">0</span>;
        }
    };
    state* null;
    state* last;  <span class="hljs-comment">//整个字符串对应的状态</span>
    state* root;
    state* states[MAXN * <span class="hljs-number">2</span>];
    <span class="hljs-keyword">int</span> state_cnt = <span class="hljs-number">0</span>;

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insert_char</span><span class="hljs-params">(<span class="hljs-keyword">value_t</span> val)</span> </span>{
        state* p = last;
        state* cur = states[state_cnt] = <span class="hljs-keyword">new</span> <span class="hljs-built_in">state</span>(state_cnt, null);
        state_cnt++;
        cur-&gt;size = <span class="hljs-number">1</span>;
        cur-&gt;len = p-&gt;len + <span class="hljs-number">1</span>;
        <span class="hljs-keyword">while</span> (p != null &amp;&amp; p-&gt;ch[val] == null) {
            p-&gt;ch[val] = cur;
            p = p-&gt;link;
        }
        <span class="hljs-keyword">if</span> (p == null)
            cur-&gt;link = root;
        <span class="hljs-keyword">else</span> {
            state* q = p-&gt;ch[val];
            <span class="hljs-keyword">if</span> (p-&gt;len + <span class="hljs-number">1</span> == q-&gt;len)
                cur-&gt;link = q;
            <span class="hljs-keyword">else</span> {
                state* clone = states[state_cnt] = <span class="hljs-keyword">new</span> <span class="hljs-built_in">state</span>(state_cnt, null);
                state_cnt++;
                clone-&gt;len = p-&gt;len + <span class="hljs-number">1</span>;
                <span class="hljs-built_in">memcpy</span>(clone-&gt;ch, q-&gt;ch, <span class="hljs-keyword">sizeof</span> state::ch);
                clone-&gt;link = q-&gt;link;
                <span class="hljs-keyword">while</span> (p != null &amp;&amp; p-&gt;ch[val] == q) {
                    p-&gt;ch[val] = clone;
                    p = p-&gt;link;
                }
                q-&gt;link = cur-&gt;link = clone;
            }
        }
        last = cur;
    }

   <span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">sam</span>(<span class="hljs-keyword">const</span> <span class="hljs-keyword">value_t</span>* str) {
        null = <span class="hljs-keyword">new</span> <span class="hljs-built_in">state</span>(<span class="hljs-number">-1</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; SIGMA; i++) null-&gt;ch[i] = null;
        null-&gt;link = null;
        <span class="hljs-built_in">memset</span>(states, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> states);
        last = root = states[state_cnt] = <span class="hljs-keyword">new</span> <span class="hljs-built_in">state</span>(state_cnt, null);
        state_cnt++;
        <span class="hljs-keyword">while</span> (*str != <span class="hljs-string">&#x27;\0&#x27;</span>) {
            <span class="hljs-built_in">insert_char</span>(*str - OFFSET);
            str++;
        }
    }

    ~<span class="hljs-built_in">sam</span>() {
        <span class="hljs-keyword">delete</span> null;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; state_cnt; i++) <span class="hljs-keyword">delete</span> states[i];
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">create_parent_tree</span><span class="hljs-params">(lfs* tree)</span> </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; state_cnt; i++) {
            tree-&gt;dp[i] = states[i]-&gt;size;
            tree-&gt;len[i] = states[i]-&gt;len;
            <span class="hljs-keyword">if</span> (states[i]-&gt;link != null) {
                tree-&gt;<span class="hljs-built_in">adde</span>(states[i]-&gt;link-&gt;id, states[i]-&gt;id);
            }
        }
    }
};

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">sam_noptr</span> {</span>
   <span class="hljs-keyword">protected</span>:
    <span class="hljs-keyword">typedef</span> <span class="hljs-keyword">int</span> ptr;
    ptr ch[MAXN * <span class="hljs-number">2</span>][SIGMA];
    ptr link[MAXN * <span class="hljs-number">2</span>];
    <span class="hljs-keyword">int</span> len[MAXN * <span class="hljs-number">2</span>];
    <span class="hljs-keyword">int</span> size[MAXN * <span class="hljs-number">2</span>];
    ptr null;
    ptr last, root;
    <span class="hljs-keyword">int</span> state_cnt;
    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insert_char</span><span class="hljs-params">(<span class="hljs-keyword">int</span> val)</span> </span>{
        ptr p = last;
        ptr cur = state_cnt++;
        size[cur] = <span class="hljs-number">1</span>;
        len[cur] = len[p] + <span class="hljs-number">1</span>;
        <span class="hljs-keyword">while</span> (p != null &amp;&amp; ch[p][val] == null) {
            ch[p][val] = cur;
            p = link[p];
        }
        <span class="hljs-keyword">if</span> (p == null) {
            link[cur] = root;
        } <span class="hljs-keyword">else</span> {
            ptr q = ch[p][val];
            <span class="hljs-keyword">if</span> (len[p] + <span class="hljs-number">1</span> == len[q]) {
                link[cur] = q;
            } <span class="hljs-keyword">else</span> {
                ptr clone = state_cnt++;
                len[clone] = len[p] + <span class="hljs-number">1</span>;
                <span class="hljs-built_in">memcpy</span>(ch[clone], ch[q], <span class="hljs-keyword">sizeof</span> ch[q]);
                link[clone] = link[q];
                <span class="hljs-keyword">while</span> (p != null &amp;&amp; ch[p][val] == q) {
                    ch[p][val] = clone;
                    p = link[p];
                }
                link[q] = link[cur] = clone;
            }
        }
        last = cur;
    }

   <span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">sam_noptr</span>(<span class="hljs-keyword">const</span> <span class="hljs-keyword">value_t</span>* str) {
        state_cnt = <span class="hljs-number">0</span>;
        <span class="hljs-built_in">memset</span>(ch, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> ch);
        <span class="hljs-built_in">memset</span>(link, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> link);
        <span class="hljs-built_in">memset</span>(len, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> len);
        <span class="hljs-built_in">memset</span>(size, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> size);
        null = state_cnt++;
        root = state_cnt++;
        link[root] = null;
        last = root;
        <span class="hljs-keyword">while</span> (*str != <span class="hljs-string">&#x27;\0&#x27;</span>) {
            <span class="hljs-built_in">insert_char</span>(*str - OFFSET);
            str++;
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">create_parent_tree</span><span class="hljs-params">(lfs* tree)</span> </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; state_cnt; i++) {
            tree-&gt;dp[i] = size[i];
            tree-&gt;len[i] = len[i];
            <span class="hljs-keyword">if</span> (link[i] != null) {
                <span class="hljs-comment">// clog &lt;&lt; &quot;Add e &quot; &lt;&lt; link[i] &lt;&lt; &#x27; &#x27; &lt;&lt; i &lt;&lt; endl;</span>
                tree-&gt;<span class="hljs-built_in">adde</span>(link[i], i);
            }
        }
    }
};
</div></code></pre>
<h3 id="后缀数组">后缀数组</h3>
<pre><code class="language-cpp"><div><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> INF = <span class="hljs-number">0x3f3f3f3f</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> MAXN = <span class="hljs-number">1e6</span> + <span class="hljs-number">10</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> SIGMA = <span class="hljs-number">26</span>;

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">suffix_array</span> {</span>
    <span class="hljs-keyword">int</span> sa[MAXN];     <span class="hljs-comment">// 排名为i的后缀的位置 sa[rnk[i]] = i</span>
    <span class="hljs-keyword">int</span> rnk[MAXN];     <span class="hljs-comment">// 后缀i的排名 rnk[sa[i]] = i</span>
    <span class="hljs-keyword">int</span> bucket[MAXN];  <span class="hljs-comment">// 元素i出现的次数</span>
    <span class="hljs-keyword">int</span> tp[MAXN];      <span class="hljs-comment">// 基数排序的第二关键字</span>

    <span class="hljs-keyword">int</span> <span class="hljs-keyword">operator</span>[](<span class="hljs-keyword">int</span> x) { <span class="hljs-keyword">return</span> sa[x]; }
    <span class="hljs-comment">// str 下标从1开始</span>
    <span class="hljs-built_in">suffix_array</span>(<span class="hljs-keyword">char</span>* str, <span class="hljs-keyword">int</span> len) {
        <span class="hljs-built_in">memset</span>(sa, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> sa);
        <span class="hljs-built_in">memset</span>(rnk, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> rnk);
        <span class="hljs-built_in">memset</span>(bucket, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> bucket);
        <span class="hljs-keyword">int</span> m = <span class="hljs-number">200</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= len; i++) {
            rnk[i] = str[i];
            bucket[rnk[i]]++;
        }
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= m; i++) {
            bucket[i] += bucket[i - <span class="hljs-number">1</span>];
        }
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = len; i &gt;= <span class="hljs-number">1</span>; i--) {
            sa[bucket[rnk[i]]--] = i;
        }
        <span class="hljs-keyword">int</span> k = <span class="hljs-number">1</span>, p;
        <span class="hljs-keyword">do</span> {
            <span class="hljs-keyword">int</span> cnt = <span class="hljs-number">0</span>;
            <span class="hljs-built_in">memset</span>(bucket, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span> bucket);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = len - k + <span class="hljs-number">1</span>; i &lt;= len; i++) {
                tp[++cnt] = i;
            }
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= len; i++) {
                <span class="hljs-keyword">if</span> (sa[i] &gt; k) tp[++cnt] = sa[i] - k;
            }
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= len; i++) {
                bucket[rnk[i]]++;
            }
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= m; i++) {
                bucket[i] += bucket[i - <span class="hljs-number">1</span>];
            }
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = len; i &gt;= <span class="hljs-number">1</span>; i--) {
                sa[bucket[rnk[tp[i]]]--] = tp[i];
            }
            p = <span class="hljs-number">1</span>;
            <span class="hljs-built_in">swap</span>(rnk, tp);
            rnk[sa[<span class="hljs-number">1</span>]] = <span class="hljs-number">1</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">2</span>; i &lt;= len; i++) {
                rnk[sa[i]] = (tp[sa[i]] == tp[sa[i - <span class="hljs-number">1</span>]] &amp;&amp;
                               tp[sa[i] + k] == tp[sa[i - <span class="hljs-number">1</span>] + k])
                                  ? p
                                  : ++p;
            } 
            k &lt;&lt;= <span class="hljs-number">1</span>;
            m = p;
        } <span class="hljs-keyword">while</span> (p &lt; len);
    }
};
</div></code></pre>
<h2 id="对拍">对拍</h2>
<h3 id="shell">Shell</h3>
<pre><code class="language-sh"><div>g++ example.cpp -o example.out
g++ example_std.cpp -o example_std.out
g++ example_dm.cpp -o example_dm.out
<span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>
    ./example_dm.out &gt; example.in
    ./example_std.out &lt; example.in &gt; example_std.ans
    ./example.out &lt; example.in &gt; example.ans
    <span class="hljs-keyword">if</span> diff example.ans example_std.ans; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;AC\n&quot;</span>
    <span class="hljs-keyword">else</span>
        <span class="hljs-built_in">printf</span> <span class="hljs-string">&quot;WA\n&quot;</span>
        <span class="hljs-built_in">exit</span> 0
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>
</div></code></pre>
<h3 id="powershell">PowerShell</h3>
<pre><code class="language-ps1"><div>g++ example.cpp <span class="hljs-literal">-o</span> example.exe -<span class="hljs-literal">-std</span>=gnu++<span class="hljs-number">17</span>
g++ example_std.cpp <span class="hljs-literal">-o</span> example_std.exe -<span class="hljs-literal">-std</span>=gnu++<span class="hljs-number">17</span>
g++ example_dm.cpp <span class="hljs-literal">-o</span> example_dm.exe -<span class="hljs-literal">-std</span>=gnu++<span class="hljs-number">17</span>
<span class="hljs-keyword">while</span>(<span class="hljs-variable">$true</span>) {
    ./example_dm.exe &gt; example.in
    <span class="hljs-string">&quot;Data maked.&quot;</span>
    <span class="hljs-built_in">Get-Content</span> example.in | ./example_std.exe &gt; example_std.out
    <span class="hljs-string">&quot;Std called.&quot;</span>
    <span class="hljs-built_in">Get-Content</span> example.in | ./example_std.exe &gt; example.out
    <span class="hljs-string">&quot;Program called.&quot;</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$LASTEXITCODE</span>) {
        <span class="hljs-string">&quot;RE!&quot;</span>
        <span class="hljs-keyword">break</span>
    }
    <span class="hljs-variable">$result</span> = <span class="hljs-built_in">Compare-Object</span> (<span class="hljs-built_in">Get-Content</span> example.out) (<span class="hljs-built_in">Get-Content</span> example_std.out)
    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span>) {
        <span class="hljs-built_in">Write-Host</span> <span class="hljs-variable">$result</span>
        <span class="hljs-keyword">break</span>
    }
}
</div></code></pre>

        <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
        
    </body>
    </html>